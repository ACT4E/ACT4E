% !TEX root = ../CategoricalCoDesign.tex

%\section{Thinking about how things connect to each other}
Currency categories illustrated how one can use category theory to think about things transforming into each other. In this section, we want to think about how things connect to each other.

\subsection{Distribution networks}

Consider the type of networks that arise for example in the context of electrical power grids. In a simplified model for a certain region or country, we may have the following kinds of components: power plants (places where electrical power is produced), high voltage transmission lines and nodes, transistor stations, low voltage transmission lines and nodes, and consumers (\text{e.g.} homes and businesses). 

\begin{figure}[h!]
\centering
%\includegraphics[width=0.7\linewidth]{pics/dist_net_1.png}
\includesag{30_net_1}
 \caption{}
\label{fig:power_nodes}
\end{figure}
To model the connectivity between the components of the power grid, we now draw arrows between components that are connected. We set the direction of the arrows to flow from energy production, via transmission components, to energy consumption, as depicted in \cref{fig:power_nodes_connected}. 
\begin{figure}[h!]
\centering
\includesag{30_net_2}
 %\includegraphics[width=0.7\linewidth]{pics/dist_net_2.png}
 \caption{}
\label{fig:power_nodes_connected}
\end{figure}


A possible question one asks about such a power distribution network is: which consumers are serviced by which power sources? For example, some power sources, such as a solar power plant, may fluctuate due to weather conditions, while other power sources, such as a nuclear power plant, may shut down every once in a while due to maintenance work. To see which consumers are connected to which power plants, we can following paths traced by sequences of arrows, as in Figure \cref{fig:power_paths}. There, two possible connectivity paths are depicted (in red and orange, respectively).


\begin{figure}[h!]
\centering
\includesag{30_net_3}
 %\includegraphics[width=0.7\linewidth]{pics/dist_net_4.png}
 \caption{}
\label{fig:power_paths}
\end{figure}


We also will want to know the overall connectivity structure of transmission lines. For example, some lines may go down during a storm, and we want to ensure enough redundancy in our system. In addition to the connections modeled in \cref{fig:power_nodes_connected}, we can also include, for example, information about the connectivity of high voltage nodes among themselves, as in \cref{fig:power_internodal}. 

\begin{figure}[h!]
\centering
%\includegraphics[width=0.5\linewidth]{pics/dist_net_3.png}
\includesag{30_net_4}
 \caption{}
\label{fig:power_internodal}
\end{figure}
The information encoded in \cref{fig:power_internodal} and \cref{fig:power_nodes_connected} can also be displayed as a single graph, see \cref{fig:power_graph},
\cref{fig:power_internodal}. 
\begin{figure}[h!]
\centering
 \includegraphics[width=0.5\linewidth]{pics/dist_net_6.png} 
 \caption{}
\label{fig:power_graph}
\end{figure}
If we ignore the directionality of the arrows, this is analogous to a depiction of type shown in \cref{fig:power_schema}, which is a schema of a power grid.\footnote{See \url{https://en.wikipedia.org/wiki/Electrical_grid} and \url{https://doi.org/10.1109/JSYST.2015.2427994}} 

\begin{figure}[h!]
\centering
 \includegraphics[width=0.5\linewidth]{pics/power_dist_network.png}
 \caption{A schematic view of a power grid.}
\label{fig:power_schema}
\end{figure}




\subsection{Relations}

A basic mathematical notion which underlies the above discussion is that of a \textbf{binary relation}. 


\begin{definition}[Binary relation]
A \emph{binary relation} from a set~$X$ to a set~$Y$ is a subset of the Cartesian product $X\times Y$. 
\end{definition}

\begin{remark}
We will often drop the word ``binary'' and simply use the name ``relation''.  
\end{remark}

If~$X$ and~$Y$ are finite sets, we can depict a relation~$R \subseteq X \times Y$ graphically as in \cref{fig:example_rel}. For each element~$\tup{x,y} \in X \times Y$, we draw an arrow from~$x$ to~$y$ if and only if~$\tup{x,y} \in R \subseteq X \times Y$. 

\begin{figure}[h!]
\centering
\includesag{30_rel_1}
%\includegraphics[width=0.5\linewidth]{pics/dist_net_7.png}
 \caption{\GZ{Add caption}}
\label{fig:example_rel}
\end{figure}

We can also depict this relation graphically as a subset of~$X \times Y$ in a ``coordinate system way'', as in \cref{fig:example_rel_coord}. The shaded grey area is the subset~$R$ defining the relation. 

\begin{comment}
\begin{figure}[h!]
\centering
 \includegraphics[width=0.5\linewidth]{pics/dist_net_8.png}
 \caption{}
\end{figure}
\end{comment}

\begin{figure}[h!]
\begin{center}
\includesag{30_rel_graph}
\end{center}
\caption{\GZ{Add caption}}
\label{fig:example_rel_coord}
\end{figure}

\begin{exercise}
Let~$X = Y = \{1, 2, 3, 4 \}$ and consider the relation~$R \subseteq X \times Y$ defined by 
\begin{equation}
R = \{ \tup{x,y} \in X \times Y \mid x \leq y \}. 
\end{equation}

Visualize the relation~$R$ via the method in [REF Figure] and [REF Figure] each. 
\end{exercise}

The visualization in \cref{fig:example_rel} hints at the fact that we can think of a relation~$R \subseteq X \times Y$ as a \emph{morphism} from~$X$ to~$Y$.

\begin{definition}[Category~$\Rel$] 
    The category~$\Rel$ of relations is given by:
    \begin{compactenum}
    \item \emph{Objects}: The objects of this category are all sets.
    \item \emph{Morphisms}: Given sets~$X, Y$, the homset~$\Rel(X,Y)$ consists of all
    relations~$R\subseteq X\times Y$.
    \item \emph{Identity morphisms}: Given a set~$X$, its identity morphism is
  	\begin{equation}
	1_X \coloneqq \{ \tup{x,y} \mid  x = y \}.
	\end{equation}
    \item \emph{Composition}: Given relations~$R \colon X\to Y$,~$S\colon Y\to Z$, their composition is given by
    \begin{equation}\label{RelCompRule}
    R \then S \coloneqq \{\tup{x,z} \mid  \exists y \in Y \colon \ \left(\tup{x,y} \in R\right) \wedge \left(\tup{y,z} \in S\right)\}.
    \end{equation}
\end{compactenum}
\end{definition}


To illustrate the composition rule in \cref{RelCompRule} for relations, let's consider a simple example, involving sets~$X$,~$Y$, and~$Z$, and relations~$R \colon X \to Y$ and $S \colon Y \to Z$, as depicted graphically below in \cref{fig:example_rel_composable}. 
\begin{figure}[h!]
\centering
\includesag{30_rel_2}
 %\includegraphics[width=0.5\linewidth]{pics/dist_net_9.png}
 \caption{}
\label{fig:example_rel_composable}
\end{figure}
Now, according to the rule in \cref{RelCompRule}, the composition~$R \then S \subseteq X \times Z$ will be such that~$\tup{x,z} \in R \then S$ if and only if there exists some~$y \in Y$ such that~$\tup{x,y} \in R$ and~$\tup{y,z} \in S$, which, graphically, means that for~$\tup{x,z}$ to be an element of the relation~$R \then S$,~$x$ and~$y$ need to be connected by at least one sequence of two arrows such that the target of the first arrow is the source of the second. For example, in \cref{fig:example_rel_composable}, there is an arrow from~$x_2$ to~$y_3$, and from there on to~$z_1$, and therefore, in the composition~$R \then S$ depicted in \cref{fig:example_rel_composed}, there is an arrow from~$x_2$ to~$z_1$. 
\begin{figure}[h!]
\centering
\includesag{30_rel_3}
%\includegraphics[width=0.5\linewidth]{pics/dist_net_10.png}
 \caption{}
\label{fig:example_rel_composed}
\end{figure}


\

A question on your mind at this point might be: what is the relationship between relations and functions? One point of view is that functions are special kinds of relations. 

\begin{definition}\label{functions as relations}
Let $X$ and $Y$ be sets. A relation $R \subseteq X \times Y$ is a \textbf{function} if it satisfies the following two conditions: 
\begin{enumerate}
\item $\forall \ x \in X \quad \exists \ y \in Y \ : \ \tup{x,y} \in R$
\item $\forall \ \tup{x_1, y_1}, \tup{x_2, y_2} \in R \  \text{holds}: \quad x_1 = x_2 \ \Rightarrow \ y_1 = y_2$
\end{enumerate}
\end{definition}

What does this definition have to do with the ``usual'' way that we think about functions? 

Let start with a relation $R \subseteq X \times Y$ satisfying the conditions of Definition \ref{functions as relations}.  We'll build from it a function $f_R : X \rightarrow Y$. Choose an arbitrary $x \in X$. According to point $1.$ in Definition \ref{functions as relations}, there exists a $y \in Y$ such that $\tup{x,y} \in R$. So let's choose such a $y$, and call it $f_R(x)$. This gives us recipe to get from any $x$ to a $y$. But maybe you are worried: given a specific $x \in X$, what if we choose $y$ differently each time we apply the recipe? Point $2.$ guarantees that this can't happen: it says that the element $f_R(x)$ that we associate to a given $x \in X$ is in fact uniquely determined by that $x$. Put another way, the condition 2. says: if $f_R(x_1) \neq f_R(x_2)$, then $x_1 \neq x_2$. 

Given a function $f : X \rightarrow Y$, we can turn it into a relation in a simple way: we consider its graph
$$
R_f := \text{graph}(f) = \{ \tup{x,y} \in X \times Y \mid y = f(x) \}. 
$$
The relation $R_f$ encodes the same information that is encoded in $f$ -- simply in a different form. 

In this text, we take Definition \ref{functions as relations} as our rigorous definition of a what a function is. Nevertheless, we'll often use functions ``in the usual way'', \text{e.g.} we'll write things like $y = f(x)$. 

%\
%
%\
%
%
%
%\
%
%\
%
%
%
%
%\begin{remark}[]
%\label{remark:oppositerel}
%Any relation~$R\colon A\to B$ induces an relation (or transpose relation, reverse relation) \begin{equation}
%    R^\intercal =\{\tup{b,a}\in B\times A\colon \tup{a,b}\in R\} \subseteq B\times A.
%\end{equation}
%Note that~$\left( R^\intercal\right)^\intercal = R$.
%\end{remark}

 
\subsection{Path planning}
\label{sec:trekking}

%Suppose we are tasked with managing a scientific mission for a Mars rover. In particular, we need to plan the routes that the rover will take in order to travel from its landing position to various other positions. We have a map of the relevant region on Mars which uses coordinates~$\tup{x, y, z}$. We assume the~$z$-th coordinate is given by an ``elevation function'',~$z = h(x,y)$, and that~$h$ is~$C^1$, \text{i.e.} continuously differentiable. This means that our map of the landscape forms a~$C^1$-manifold; let's call it~$L$. 


In the section we'll discuss a more ``continuum-flavored'' (as opposed to ``discrete-flavored'') example of how one might describe ``connectedness" using a category. 


Suppose we are planning a hiking tour in the Swiss Alps. In particular, we wish to consider various routes for hikes. We have a map of the relevant region which uses coordinates~$\tup{x, y, z}$. We assume the~$z$-th coordinate is given by an ``elevation function'',~$z = h(x,y)$, and that~$h$ is~$C^1$, \text{i.e.} continuously differentiable. This means that our map of the landscape forms a~$C^1$-manifold; let's call it~$L$. 



We will now define a category where the morphisms are built from~$C^1$ paths through the landscape, and such that these paths can be composed, essentially, by concatenation. We take paths which are~$C^1$ so that we can speak of the slope (steapness) of a path in any given point, as given by its derivative. 

%\
%
%[INSERT FIGURE]
%
%\



To set things up, we need to have a way to compose $C^1$ paths such that their composition is again~$C^1$. For this, the derivative (velocity) at the end of one path must match the starting velocity of the subsequent path.

\begin{definition}
Let~$\Cat{Berg}$ be the category defined as follows:

\begin{itemize}

\item Objects are tuples~$\tup{p, v}$, where
\begin{itemize}
\item $p \in L$,
\item $v \in \mathbb{R}^3$ (we think of this as a tangent vector to~$L$ at~$p$).  
\end{itemize}

\item A morphism~$\tup{p_1, v_1} \rightarrow \tup{p_2, v_2}$ is~$\tup{\gamma, T}$,
where
\begin{itemize}
\item $T \in \mathbb{R}_{\geq 0}$,
\item $\gamma \colon [0, T] \to L$ is a~$C^1$ function with~$\dot \gamma(0) = v_1$ and~$\dot \gamma(T) = v_2$  (we take one-sided derivatives at the boundaries). 
\end{itemize}

\item For any object~$\tup{p, v}$, we define its identity morphism~$1_{\tup{p,v}} = \tup{\gamma, 0}$ formally: it's path~$\gamma$ is defined on the closed interval~$[0,0]$, \text{i.e.}~$T= 0$ and $\gamma(0) = p$. We declare this path to be~$C^1$ by convention, and declare its derivative at~$0$ to be~$v$.  

\item Given morphisms~$\tup{\gamma_1, T_1}: \tup{p_1, v_1} \to \tup{p_2, v_2}$ and~$\tup{\gamma_2, T_2}: \tup{p_2, v_2} \to \tup{p_3, v_3}$, their composition is $\tup{\gamma, T}$ with~$T = T_1 + T_2$ and
\begin{equation}
 \gamma(t) = \begin{cases}
 \gamma_1(t) &0 \leq t \leq T_1 \\
\gamma_2(t - T_1) & T_1 \leq t \leq T_1 + T_2.
 \end{cases}
\end{equation} 
\end{itemize}

\end{definition}


Since we are only amateurs, we don't feel comfortable with hiking on paths that are too steep in some places. We want to only consider paths that have a certain maximum inclination. Mathematically speaking, for any path -- as described by a morphism in the category $\Cat{Berg}$ -- we can compute its slope, given by a real number, say, in the interval $(-1, 1)$. We can also compute its maximum slope. This gives, for every homset $\Hom(\tup{p_1, v_1}, \tup{p_2, v_2})$, a function
$$
\mathsf{MaxSlope}: \Hom(\tup{p_1, v_1}, \tup{p_2, v_2}) \longrightarrow (-1, 1). 
$$
Let's say we decide that we don't want to traverse paths which have a slope beyond $[-1/2, 1/2]$. Paths which satisfy this condition we call \emph{feasible}. Now let's consider only the feasible paths in $\Cat{Berg}$. If we keep the same objects as $\Cat{Berg}$, but only consider feasible path, will the resulting structure still form a category? We'll let you ponder here, and we'll return to this type of question when we introduce the notion of a \emph{subcategory}. 


%\
%
%\todo{Do also with maximum inclination (min and max) and the composition using min and max}
%
%\JL{Maybe the composition part would be nice to put in the section about functors as an example?}
%
%\


%\gray{
%-------------------------------------------------------------------------
%
%Supposed we are tasked with managing a scientific mission for a Mars rover. In particular, we need need to plan the route that the rover will take in order to travel from its landing position ``$a$'' to a target destination ``$b$''. We have a map of the relevant region on Mars, complete with elevation data, but, of course, only to a certain degree of accuracy. 
%
%To model the landscape, we divide it into a grid of~$1 \times 1$ meter squares, and the center of each is labeled with an~$\tup{x,y}$ coordinate. In total, our model has~$1000 \times 1000$ squares, and we let~$L$ denote the set of coordinates of the centers of the squares. We think of these coordinate labels as the objects of a category~$\cat{C}$ which are the possible (approximate) locations that the rover might be. If the rover is at a given location~$l = \tup{x,y}$, then in our model there are eight possible directions that the rover can move:
%
%\begin{figure}[h!]
%\centering
% \includegraphics[width=0.5\linewidth]{pics/path_planning_1.png}
% \caption{}
%\label{fig:rover_moves}
%\end{figure}
%
%
%If we draw such arrows for each location label $c \in \cat{C}$, then we obtain a (rather full-looking) directed graph such as indicated in Figure \ref{fig:move_graph}.  
%
%\begin{figure}[h!]
%\centering
% \includegraphics[width=0.5\linewidth]{pics/path_planning_2.png}
% \caption{}
%\label{fig:move_graph}
%\end{figure}
%
%To model the possible paths the rover might potential travel, we take the free category on this graph. That is, we let the morphisms in our category $\Cat{C}$ be all possible paths obtained by concatenating directed arrows from the above graph Figure \ref{fig:move_graph}. In particular, given the locations~$a$ and~$b$, we have 
%\begin{equation}
%\Cat{C}(a, b) = \{ \text{paths from } a \text{ to } b \}.
%\end{equation}
%
%\begin{figure}[h!]
%\centering
% \includegraphics[width=0.5\linewidth]{pics/path_planning_3.png}
% \caption{}
%\label{fig:rover_paths}
%\end{figure}
%
%In Figure \ref{fig:rover_paths}, two possible paths are drawn in green. Note that by allowing \emph{all} possible paths we are also allowing ones of infinite length (\text{e.g.} where the rover moves around indefinitely long). Since we want our rover to reach its destination in a finite amount of time, we will subsequently take $\Cat{C}$ to be the category where the morphisms are only the paths of \emph{finite length}. 
%
%Next, we include the elevation information in our model, in order to start to optimize the planning of which path we wish the rover to take. We encode elevation data as a function~$h \colon L \to \mathbb{R}$ which assigns a real number to each location label. If~$l$ and~$l'$ are two locations, the absolute elevation difference between~$l$ and $~l'$ is~$\vert h(l') - h(l) \vert$. For our rover, we only want to consider paths such that the absolute elevation difference between any two adjacent locations along that path is less than a given threshold (if the path is too steep, the rover might tip over!). This is one kind of constraint which determines certain paths in our category~$\Cat{C}$ to be infeasible. 
%
%Among the feasible paths, we wish to optimize the path taken by the rover so that it uses the least amount of energy, say.  For any path~$p$ of finite length, we model what the energy cost~$E(p)$ of that path for the rover would be. (We skip the precise details of how we might model this; surely the energy cost of a path will be related to the length of the path, for example.) This defines a function on each of the homsets of our category $\Cat{C}$, 
%\begin{equation}
%E \colon \Cat{C}(l, l') \longrightarrow \mathbb{R}, 
%\end{equation}
%which, to each path from~$l$ to~$l'$, assigns the corresponding energy cost of that path. Thus our specific optimization problem is to find those feasible paths which minimize the function~$E\colon \Cat{C}(a,b) \to \mathbb{R}$ defined on paths from the starting position~$a$ to the target position~$b$. 
%
%--------------------------------
%
%
%
%\
%
%
%Consider a geographical region whose locations are expressed through coordinates~$(x,y)\in \mathbb{R}^2$, \text{e.g.} as given by a map of that region. Furthermore, consider a function~$\mathsf{alt}: \mathbb{R}^2 \to \mathbb{R}_{\geq 0}$ which, for a known location, returns its altitude.
%
%We can think about this situation using a category, call it~$\mathbf{trek}$, where objects are geographical locations~$\tup{x,y}\in \mathbb{R}^2$ and morphisms are continuous paths between them. The identity morphism for each location consists of the trivial path (i.e., not moving), and composition is given by concatenation of paths.
%\JL{We need to be more precise about what ``continuous path'' means here! The typical mathematical definition of paths from topology is as a function of a (``time'') parameter, and leads to a well-known situation where concatenation is not an associative operation on the nose... and/or there is also issue that there are crazy kinds of continuous paths, such as space-filling curves... perhaps this example can be modified a bit to capture the basic idea, but avoid the math issues...}
%\GZ{Agree, here we just want the connectivity and the filtering of paths which have too large inclinations}
%
%Suppose that a human can only traverse trails which have a maximum inclination of $\alpha>0$ when going uphill and $\beta>0$ when going downhill.
%We can now think of the aforementioned human, wanting to go from a location~$\tup{x,y}$ to a location~$\tup{v,w}$. Finding a path consists of finding at least a morphism in~$\Hom_\mathbf{trek}(\tup{x,y},\tup{v,w})$ satisfying the condition on the maximum inclinations~$\alpha$ and~$\beta$.
%
%
%Using the terminology from \cref{sec:catsfromgraphs}, we can see that~$\mathbf{trek}$ is the free category on a graph with vertices given by geographical locations~$\tup{x,y}\in \mathbb{R}^2$ and arrows given by paths between them. In particular, a valid path~$p\colon \tup{x,y}\mapsto \tup{v,w}$ for the human to be able to reach a destination, has not to exceed the maximum inclination~$\alpha$ when climbin and the maximum inclination~$\beta$ when descending.
%}
%-------------------------------

\subsection{Mobility}

For a specific mode of transportation, say a car, we can define a graph
\begin{equation*}
    G_\mathrm{c}=\tup{V_\mathrm{c},A_\mathrm{c},s_\mathrm{c},t_\mathrm{c}},
\end{equation*} 
where~$V_\mathrm{c}$ represents geographical locations which the car can reach and~$A_\mathrm{c}$ represents the paths it can take (e.g. roads). Similarly, we consider a graph~$G_\mathrm{s}=\tup{V_\mathrm{s},A_\mathrm{s},s_\mathrm{s},t_\mathrm{s}}$, representing the subway system of a city, with stations~$V_\mathrm{s}$ and subway lines going through paths~$A_\mathrm{s}$, and a graph $G_\mathrm{b}=\tup{V_\mathrm{b},A_\mathrm{b},s_\mathrm{b},t_\mathrm{b}}$, representing onboarding and offboarding at airports. In the following, we want to express intermodality: the phenomenon that someone might travel to a certain intermediate location in a car and then take the subway to reach their final destination.

By considering the graph~$G=(V,A,s,t)$ with~$V=V_\mathrm{c}\cup V_\mathrm{s}\cup V_\mathrm{b}$ and~$A=A_\mathrm{c}\cup A_\mathrm{s}\cup A_\mathrm{b}$, we obtain the desired intermodality graph. Graph~$G$ can be seen as a new category, with objects~$V$ and morphisms~$A$.
\begin{example}
Consider the $\Cat{car}$ category, describing your road trip in California, with
\begin{equation*}
    V_\mathrm{c}=\{\textsf{SFO}_\mathrm{c},\textsf{S. Mateo},\textsf{Half Moon Bay},\textsf{SBP}_\mathrm{c},\textsf{Lake Balboa},\textsf{LAX}_\mathrm{c}\},
\end{equation*}
and arrows as in~\cref{fig:carcat}. The nodes represent typical touristic road trip checkpoints in California and the arrows famous highways connecting them.

\begin{figure}[h!]
\begin{center}
\includesag{30_carcategory}
\end{center}
\caption{The $\Cat{car}$ category. \label{fig:carcat}}
\end{figure}

Furthermore, consider the $\Cat{flight}$ category with $V_\mathrm{f}=\{\textsf{SFO}_\mathrm{f}, \textsf{SJC}, \textsf{SBP}_\mathrm{f}, \textsf{LAX}_\mathrm{f}\}$ and arrows as in~\cref{fig:flight}. The nodes represent airports in california and the arrows represent connections, offerend by specific flight companies.

\begin{figure}[h!]
\begin{center}
\includesag{30_flight}
\end{center}
\caption{The $\Cat{flight}$ category. \label{fig:flight}}
\end{figure}

We then consider the $\Cat{board}$ category, with nodes
\begin{equation*}
    V_\mathrm{b}=\{\textsf{SFO}_\mathrm{f},\textsf{SFO}_\mathrm{c},\textsf{SBP}_\mathrm{f},\textsf{SBP}_\mathrm{c},\textsf{LAX}_\mathrm{f},\textsf{LAX}_\mathrm{c}\}
\end{equation*}
and arrows as in~\cref{fig:boarding}. Nodes represent airports and airport parkings, and arrows represent the onboarding and offboarding paths one has to walk to get from the parkings to the airport and vice-versa.

\begin{figure}[h!]
\begin{center}
\includesag{30_boarding}
\end{center}
\caption{The $\Cat{board}$ category. \label{fig:boarding}}
\end{figure}

The combination of the three, which we call the \emph{intermodal graph}, can be represented as a graph, with \textcolor{red}{red} arrows for the car network, \textcolor{blue}{blue} arrows for the flight network, \textcolor{green}{green} arrows for the boarding network, and black dashed arrows for intermodal morphisms, arising from composition of morphisms involving multiple modes (\cref{fig:intermodal}). Imagine that you are in the parking lot of \textsf{LAX} airport and you want to reach \textsf{S. Mateo}. From there, you will e.g. onboard to a \textsf{United} flight to \textsf{SFO}$_\mathrm{f}$, will then offboard reaching the parking lot \textsf{SFO}$_\mathrm{c}$, and drive on highway \textsf{US-101} reaching \textsf{S. Mateo}. This is intermodality.

\begin{figure}[h!]
\begin{center}
\includesag{30_intermodal}
\end{center}
\caption{Intermodal graph. The dashed arrows represent intermodal morphisms, and we depict just one of them for simplicity. \label{fig:intermodal}
\AC{use darkgreen instead of green}
}
\end{figure}
\end{example}

The intermodal network category $\Cat{intermodal}$ is the free category on the graph illustrated in \cref{fig:intermodal}.

\GZ{Maybe not needed? If so, rewrite}
\JL{I think this is nice to include! But then maybe for clarity we would want to actually remove the dashed arrow in Figure 18, since that is not part of the graph we are thinking to take the free category of. Technically we could also leave it in, but that seems to confuse the situation, no?}






% \begin{comment}
% \begin{definition}[Union of categories]
% Given two categories $\CatC,\CatD$, one can create the \emph{union} $\Cat{E}$ of the two, which is composed of:
% \begin{compactenum}
% \item \emph{Objects:} $\Ob_\Cat{E}=\Ob_\CatC \cup \Ob_\CatD$.
% \item \emph{Morphisms:} A morphism $f$ is given by considering the followng. If $f\in \Hom_\CatC(X,Y)$, then $f\in \Hom_\Cat{E}(X,Y)$. If $f\in \Hom_\CatD(X,Y)$, then $f\in \Hom_\Cat{E}(X,Y)$.
% \item \emph{Identity morphism:} For any morphism in $\Cat{E}$, the identity morphism remais the same as in the original category.
% \item \emph{Composition operation}: The composition of morphisms remains the same.
% \end{compactenum}
% \end{definition} 
% \end{comment}

%\subsection{Generating categories from graphs}
%What we sketched is the previous sections has deeper roots. In the following, we will introduce the concept of \emph{free categories on graphs}.
%
%\begin{ctdefinition}[Free category on a graph]
%Consider any graph $G=(V,A,s,t)$. We can define a category $\mathbf{Free}(G)$, called the \emph{free category on $G$}. Its objects are the vertices $V$, and given vertices $a\in V$ and $b\in V$, the morphisms $\mathbf{Free}(G)(a,b)$ are the paths from $a$ to $b$.
%%A path is a sequence of ``consecutive'' edges, \text{i.e.} the source of a subsequent edge is equal to the target of its predecessor. We also formally allow for ``empty paths'', \text{i.e.} a sequence of "zero"-many edges which starts and ends at the same vertex.
%The identity morphism $id_a$ is defined to be the empty path starting and ending at a vertex $a \in V$, and composition of morphisms is given by concatenation of paths.
%\end{ctdefinition}
%
%
%With these two new definitions, we can see that $\mathbf{trek}$ is the free category on a graph with vertices given by geographical locations $\tup{x,y}\in \mathbb{R}^2$ and arrows given by paths between them. In particular, a valid path $p\colon \tup{x,y}\mapsto \tup{v,w}$ for the human to be able to reach a destination, has not to exceed the maximum inclination $\alpha$ when going up and the maximum inclination $\beta$ when going down.


\subsection{Relational Databases}
\label{def:relational-databases}

A \emph{relational database} like PostgreSQL, MySQL, etc. presents 
the data to the user as relations. This does not necessarily mean
that the data is stored as tuples, as in the mathematical model, but 
rather that what the user can do is query and manipulate relations.
This conceptual model is now 50 years old.

Can we use the category $\Rel$ to represents databases? 

\todo{add citation to paper \url{https://dl.acm.org/doi/10.1145/362384.362685}}.

Suppose we want to buy an electric stepper motor for a robot that we are building, and for this we consult a catalogue of electric stepper motors\footnote{See \href{https://www.pololu.com/category/87/stepper-motors}{pololu.com} for a standard catalogue of electric stepper motors.}. 

The catalogue might be organized as a large table, where on the left-hand side there is a column listing all available motors (identified with a model name), and the remaining columns correspond to different attributes that each of the models of motor might have, such as the name of the company that manufactures the motor, the size dimensions, the weight, the maximum power, the price, etc. A simple illustration is provided in \cref{tab:electric_motors}.

\begin{table}[h]
    \centering
    \adjustbox{max width=\textwidth}{%
    \begin{tabular}{c|c|c|c|c|c}
         Motor ID & Company& $\unit[\text{Size}]{[mm^3]}$ & \unit[Weight]{[g]} & \unit[Max Power]{[W]} & \unit[Cost]{[USD]} \\
         \hline
         \textsf{1204}&\textsf{SOYO} & 20 x 20 x 30& 60.0 &2.34 &19.95\\
         \textsf{1206}&\textsf{SOYO} &28 x 28 x 45& 140.0 &3.00 &19.95\\
         \textsf{1207}&\textsf{SOYO} &35 x 35 x 26& 130.0 &2.07 &12.95\\
         \textsf{2267}&\textsf{SOYO} &42 x 42 x 38& 285.0 &4.76 &16.95\\
         \textsf{2279}&\textsf{Sanyo Denki} &42 x 42 x 31.5& 165.0  &5.40 & 164.95\\
        \textsf{1478}&\textsf{SOYO} & 56.4 x 56.4 x 76& 1,000 & 8.96&49.95\\
        \textsf{2299}&\textsf{Sanyo Denki} & 50 x 50 x 16& 150.0 &5.90&59.95
    \end{tabular}%
    }
    \caption{A simplified catalogue of motors.}
    \label{tab:electric_motors}
\end{table}


\subsubsection{Can we use $\Rel$ for relational databases?}

A database table can be seen as representing an $n$-ary relation with $n = 7$, as we are expressing a relation
over the sets 
$$
    \text{MotorIDs} \times \text{Company} 
    \times \text{Sizes} \times \text{Weight} \times \text{Power} \times \text{Cost}.
$$
An $n$-ary relation is a relation over $n$ sets, just like a binary relation is a
relation over $2$ sets.
\begin{definition}[$n$-ary relation]
An $n$-ary relation on $n$ sets $\tup{X_1, X_2, \dots, X_n}$ is a
subset of the product set 
\begin{equation}
X_1 \times X_2 \times \cdots \times X_n
\end{equation}
\end{definition}

$\Cat{Rel}$ only allows binary relations. Morphisms as defined have 1 head and 1 tail:
there are only two points to attach to. There is no immediate and natural way to represent $n$-ary relations using $\Cat{\Rel}$.

To represent relational databases categorically, there are at least 3 options.

\paragraph{Option 1: Hack it}
 We will introduce the notion of \emph{products} and \emph{isomorphisms}.
    This will allows to say that because 
    $$
    X_1 \times X_2 \times X_3 \times \cdots \times X_n
    $$
    is isomorphic to 
     $$
    X_1 \times ( X_2 \times X_3 \cdots \times X_n)
    $$    
    we can talk about $n$-ary relations in terms of binary relations.
    This is not really a natural way to do it.

\paragraph{Option 2: Mutant Morphisms}
    What if morphisms could have more than 2 legs? There
    are indeed theories that work with more complicated arrows.
    For example: multicategories, polycategories, operads. \todo{add links. To nlab?}
    
\begin{figure}[h]
\centering
\includegraphics[width=7cm]{chapters/mutants.jpg}
\caption{Can you imagine how to define
composition with mutant morphisms
with more than 2 legs?}
\end{figure}
    
\paragraph{Option 3: Categorical databases}

A different perspective is that of \emph{categorical databases} \todo[inline]{add ref}. In this modeling framework
one does not model the data tables as relations directly. 
Rather the data is described as a functor~(\cref{functor})
from a category representing the schema 
to $\Set$. 
