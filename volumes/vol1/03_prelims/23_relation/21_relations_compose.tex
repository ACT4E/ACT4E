% !TEX root = chapter-standalone.tex

\section{Composing relations}

\linkvideo{spring2021-relations:relations:comp-rel} % Composing relations

The visualization in \cref{fig:example_rel} hints at the fact that we can compose relations if the target of the one is the source of the other.

To illustrate composition of relations, consider a simple example, involving sets~\setA,~\setB, and~\setC, and relations~$\relA \colon \setA \sto \setB$ and~$\relB \colon \setB \sto \setC$, as depicted graphically below in \cref{fig:example_rel_composable}.

%
\begin{figure}[h!]
    \centering
    \subfloat[Relations compatible for composition. \label{fig:example_rel_composable}]{
        \includesag{30_rel_2}}\\
    \subfloat[Composition of relations. \label{fig:example_rel_composed}]{
        \includesag{30_rel_3}
    }

    \caption{Illustrations for relations composition.}
\end{figure}
%
The composite relation~$\relA \mthen \relB \colon \setA \mto \setC$ is defined to be such that~$\inrel \ela {(\relA \mthen \relB)} \elc$ if and only if there exists some~$\elb \setin \setB$ such that~$\inrel \ela \relA \elb $ and~$\inrel \elb \relB{\elc}$.
Graphically this means that for~$\tup{\ela,\elc}$ to be an element of the relation~$\relA \mthen \relB$, the elements~$\ela$ and~$\elc$ need to be connected by at least one sequence of two arrows such that the target of the first arrow is the source of the second.

For example, in \cref{fig:example_rel_composable}, there is an arrow from~$\sfondue$ to~$\swater$, and from there on to~$\sapple$, and therefore, in the composition~$\relA \mthen \relB$ depicted in~\cref{fig:example_rel_composed}, there is an arrow from~$\sfondue$ to~$\sapple$.

\begin{ctdefinition}[Relation composition]
    \label{def:composition-of-relations}
    \SYNDEF{composition of relations}
    Given relations~$\relA \colon \setA \mto \setB$,~$\relB \colon \setB \mto \setC$, their composition is the relation
    \begin{equation}
        \relA \mthen \relB \definedas \makeset{\tup{\ela,\elc} \setin \setA \cartprod \setC \mid \exists \elb \setin \setB \colon \pars{\inrel{\ela}{\relA}{\elb} } \booland \pars{\inrel{\elb}{\relB}{\elc}}}.
    \end{equation}
\end{ctdefinition}

\todotext{JL: @TAs - write up a simple, nice example of relation composition here and put it in an "example" environment}

\todotext{JL: @TAs - write up two simple examples of relation composition and put them here as (non-graded) exercises, plus write in the solutions using the solutions environment}

\begin{gradedexercise}[ComposingRelations]
    \
    \begin{enumerate}
        \item Let~$\setA = \natnumbers$,~$\setB = \wnumbers$, and~$\setC = \reals$.
              Consider the relation~$\mora \colon \setA \mto \setB$ with
              \begin{equation}
                  \mora = \makeset{ \tup{\ela, \elb} \setin \natnumbers \cartprod \wnumbers \mid \ela = \elb^2 },
              \end{equation}
              and consider the relation~$\morb \colon \setB \mto \setC$ with
              \begin{equation}
                  \morb = \makeset{ \tup{\elb, \elc} \setin \wnumbers \cartprod \reals \mid \elb = 2 \elc}.
              \end{equation}
              Calculate the relation~$\mora \mthen \morb \colon \setA \mto \setB$.

        \item Let~$\setA = \natnumbers$,~$\setB = \wnumbers \cartprod \wnumbers$, and~$\setC = \reals$.
              Consider the relation~$\mora \colon \setA \mto \setB$ with
              \begin{equation}
                  \mora = \makeset{\tup{\ela, \tup{\elnb{1}, \elnb{2}}} \setin \natnumbers \cartprod (\wnumbers \cartprod \wnumbers) \mid \ela = \elnb{1} - \elnb{2}}
              \end{equation}
              and consider the relation~$\morb \colon \setB \mto \setC$ with
              \begin{equation}
                  \morb = \makeset{ \tup{\tup{\elnb{1}, \elnb{2}}, \elc} \setin (\wnumbers \cartprod \wnumbers) \cartprod \reals \mid \elnb{2} \elc = \elnb{1}}.
              \end{equation}

              Calculate the relation~$\mora \mthen \morb \colon \setA \mto \setB$.
    \end{enumerate}
\end{gradedexercise}
