% !TEX root = chapter-standalone.tex

\section{The category of design problems \DP}

Finally, we can declare that the design problems so defined are morphisms in a category that we call~\DP.

% We will show that the class of all design problems forms a category, which we call~\iindex{\DP}.

\begin{definition}[Category of design problems \DP]
    \index{\DP|textbf}
    \label{def:DP}
    The \emph{\iindex{category of design problems} \DP} consists of the following constituents:
    \begin{enumerate}
        \item \emph{Objects}: The objects of~\DP are posets.
        \item \emph{Morphisms}: The morphisms of~\DP are design problems (\cref{def:design-problem}).
        \item \emph{Identity morphism}: The identity morphism~$\funid_\posgenA \colon \funposA \profto \resposA$ is given by \cref{def:dp-identity}.
        \item \emph{Composition operation}: Given morphisms~$\adpa \colon  \funposA \profto \resposB$ and~$\adpb \colon \funposB \profto \resposC$, their composition~$\adpa \dpthen \adpb\colon \funposA\profto \resposC$ is given by \cref{def:dp-series}.
    \end{enumerate}
\end{definition}

We have already shown that the composition operator ``$\dpthen$'' is associative and unital, and that the composition of two design problems is a design problem (closure).
Therefore, \DP is a category.

\DP is called \feas or~$\Prof_\Bool$ in~\cite{fong2019}.

% \iflabelexists{sec:DPI-semicat}{
%     \begin{remark}
%         We will see in \cref{sec:DPI-semicat} that the DPIs (design problems with implementations) also have a categorical interpretation as a semicategory \DPI and that there is a functor from~\DPI to~\DP.
%     \end{remark}
% }

\subsection{Relation between \DPI and \DP}

We have already seen in \cref{rem:DP-from-DPI} that we can obtain a DP from a DPI.
We can make this more formal and say that there exists a \emph{forgetful semifunctor} from \DPI to \DP.

\begin{definition}
    \label{def:dpitodpsemi}
    The forgetful semifunctor~$\dpitodp\colon \DPI\fto \DP$ is given by:
    \begin{compactenum}
        \item Identity on the objects:~$\dpitodpob(\posA)=\posA$.
        \item Given~$\adp=\tup{\funsp,\ressp,\impsp,\prov,\req}$, the action on morphisms is given by
              \begin{equation*}
                  \defmapperiod{\dpitodpmor(\adp)}
                  {\funsp \op \cprod \ressp}
                  {\toinPos}
                  {\Bool}
                  {\tup{\fun\opel, \res}}
                  {\exists \imp \setin \setI\colon (\fun \posleqof{\funsp}\prov(\imp))\booland (\req(\imp)\posleqof{\ressp} \res)}
              \end{equation*}
    \end{compactenum}
\end{definition}

\begin{lemma}
    \cref{def:dpitodpsemi} indeed defines a semifunctor.
\end{lemma}
\begin{proof}
    Consider
    \begin{equation*}
        \begin{aligned}
            \adpa & =\tup{\funposA,\resposB,\impspn{1},\provn{1},\reqn{1}}, \\
            \adpb & =\tup{\funposB,\resposC,\impspn{2},\provn{2},\reqn{2}},
        \end{aligned}
    \end{equation*}
    We need to show
    \begin{equation*}
        \dpitodpmor(\adpa \fthen_\DPI \adpb)=\dpitodpmor(\adpa)\fthen_\DP \dpitodpmor(\adpb).
    \end{equation*}
    Let's start with the left term.
    One has
    \begin{equation*}
        \begin{aligned}
            \dpitodpmor(\adpa \fthen_\DPI \adpb)(\funposAel\F{\opel},\resposCel) & =
            \exists \imp \setin \impsp\colon (\funposAel \posleqof{\posA}\provn{1}(\impn{1}))\booland (\reqn{2}(\impn{2})\posleqof{\posC} \resposCel),
        \end{aligned}
    \end{equation*}
    where~$\impsp=\makeset{\impn{1}\tupconcat \impn{2}\setin \makecprod{\impspn{1}, \impspn{2}} \mid \reqn{1}(\impn{1})\posleqof{\posB}\provn{2}(\impn{2})}$.

    On the other hand,
    \begin{equation*}
        \begin{aligned}
             & (\dpitodpmor(\adpa) \fthen_\DP \dpitodpmor(\adpb))(\funposAel\F{\opel},\resposCel) \\
             & =\bigvee_{\posBel \setin \posB}\dpitodpmor(\adpa)(\funposAel\F{\opel},\resposBel)\booland \dpitodpmor(\adpb)(\funposBel\F{\opel},\resposCel) \\
             & =\bigvee_{\posBel \setin \posB}{\exists \impn{1} \setin \impspn{1}\colon (\funposAel \posleqof{\posA}\provn{1}(\impn{1}))\booland (\reqn{1}(\impn{1})\posleqof{\posB} \resposBel)} \\
             & \booland {\exists \impn{2} \setin \impspn{2}\colon (\funposBel \posleqof{\posB}\provn{2}(\impn{2}))\booland (\reqn{2}(\impn{2})\posleqof{\posC} \resposCel)}
        \end{aligned}
    \end{equation*}
\end{proof}

\devel{

    In the other direction, we can take a DP and find a corresponding DPI.
    We obtain another semifunctor.

    \todotext{@Gioele: Define this semifunctor}
}