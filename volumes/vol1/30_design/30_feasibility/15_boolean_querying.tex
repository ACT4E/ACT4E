% !TEX root = chapter-standalone.tex

\section{Querying  design problems}
\label{sec:dp-querying}

%\linkvideo{spring2021-functorial-comp-b:solving-queries} % Solving DP queries

\todotextjira{172}{\bernina: Explain briefly that in this section we show how the notion of querying introduced earlier connects to the mathematical definition of a \SY{design problem} as a \SY{boolean profunctor}.}

Equation~\cref{eq:dpi_to_dp_1} on the one hand, and \cref{eq:dpi_to_dp_2} on the other hand, give two perspectives on the mathematical definition of what we are calling a \emph{design problem}.
These two perspectives are analogous to something we already discussed in \cref{rem:rel-three-fun-descriptions}, when talking about binary relations.
There, we said that a binary relation from a set~\setA to a set~\setB is a subset~$\relA \setsubseteq \setA \cartprod \setB$,
but that such a relation~\relA can also, equivalently, be viewed as a function~$\phi_{\relA}\colon \setA \cartprod\setB \to \makeset{ \false, \true }$.
The subset~$\relA \setsubseteq \setA \cartprod \setB$ corresponded to the set
\begin{equation}
    \makeset{ \tupp{\ela, \elb} \setin \setA \cartprod \setB \mid \phi_{\relA}(\ela, \elb) = \true }.
\end{equation}
%
To make the analogy with \cref{eq:design-prob-as-upper-set} more precise, note that~\setA,~\setB,~$\makeset{ \false, \true }$, and~$\phi_{\relA}\colon \setA \cartprod\setB \sto \makeset{ \false, \true }$ live in the category of \emph{sets}, and that~$\funsp$,~$\ressp$,~$\Bool$ and~$\adp\colon \funspop \Ptimes \ressp\toinPos \Bool$ live in the category of \emph{posets}.

In \cref{rem:rel-three-fun-descriptions}, we also discussed two further ways to describe a relation~$\relA \setsubseteq \setA \cartprod \setB$: namely, we can transform the function~$\phi_{\relA}\colon \setA \cartprod\setB \sto \makeset{ \false, \true }$ either into a function
\begin{equation}
    \label{eq:curried-relation-again}
    \defmapperiod{
        \hat \phi_{\relA}}{\setA}{\sto
    }{
        \powerset(\setB)
    }{
        \ela
    }{
        \makeset{ \elb \setin \setB \mid \inrel{\ela
            }{
                \relA
            }{
                \elb} }
    }
\end{equation}
or a function
\begin{equation}
    \label{eq:co-curried-relation-again}
    \defmapperiod{
        \check \phi_{\relA}}{\setB}{\sto
    }{
        \powerset (\setA)
    }{
        \elb
    }{
        \makeset{ \ela \setin \setA \mid \inrel{\ela
            }{
                \relA
            }{
                \elb}}
    }
\end{equation}
%
There are analogous transformations for a \SY{design problem}~$\adp\colon \funspop \Ptimes \ressp\toinPos \Bool$.
Can you guess what they would be?

In order to use our ``sets to posets'' analogy and find an answer, it is useful to express the constructions we used in the setting of sets and relations entirely in terms of constructions from the category of sets, if possible.
Then the strategy is to identify what are the analogous constructions in the category of \SY{posets}, and this will allow us to make analogous definitions for \SY{design problems}.

The functions~$\hat \phi_{\relA}$ and~$\check \phi_{\relA}$ above have \SY{powersets} as their target objects.
What is the analogue of the \SY{powerset} operation in the category of posets?

The answer that we will use goes like this.
Given a set~\setA, there is a 1-to-1 correspondence between subsets of~\setA and functions~$\setA \sto \makeset{ \false, \true }$ (similar to above, a set corresponds here to its indicator function).
Thus, $\powerset (\setA)$ can be seen to correspond to~$\HomSet{\Set}{\setA}{\makeset{ \false, \true}}$.
The latter is definitely an expression we can transfer, by analogy, to the category of \SY{posets}, namely we can consider~$\HomSet{\Pos}{\posA}{\Bool}$.
And from \cref{ex:UpperSetsViaFunctors} we know that \SY{monotone maps}.
$\posA \mto \Bool$ correspond to \emph{upper} subsets of~\posA.
So~$\HomSet{\Pos}{\posA}{\Bool}$ corresponds to set~$\setOfUppersets (\posA)$ of upper subsets of~\posA (c.f.
\cref{sec:UpperLowerSets} for the definitions of upper and \SY{lower sets}).

We now can write down the ``poset'' analogues of the functions~$\hat \phi_{\relA}$ and~$\check \phi_{\relA}$.
Namely, given a \SY{design problem} \cref{eq:generic-design-prob}, we have associated functions
\begin{equation}
    \label{eq:dp-left-curry}
    \widehat{\adp} \colon \funspop \mto \setOfUppersets (\ressp)
\end{equation}
and
\begin{equation}
    \label{eq:dp-right-curry}
    \widecheck{\adp} \colon \ressp \mto \setOfUppersets (\funspop).
\end{equation}
However, we are not quite finished: are these  \SY{monotone functions}?
Which \SY{poset} structure can we choose on~$\setOfUppersets (\ressp)$ and~$\setOfUppersets (\funspop)$, respectively, so that~$\widehat{\adp}$ and~$\widecheck{\adp}$ are monotone?

\begin{gradedexercise}[\exname{CurryingDesignProblems}]
    \label{ex:CurryingDesignProblems}
    Let~$\adp\colon \funspop \Ptimes \ressp\toinPos \Bool$ be a design problem.
    In this exercise we will show that \cref{eq:dp-left-curry} corresponds to a monotone function
    \begin{equation}
        \funsp \mto \tupp{\setOfUppersets (\ressp), {{\setsupseteq}}},
    \end{equation}
    and that \cref{eq:dp-right-curry} corresponds to a monotone function
    \begin{equation}
        \ressp \mto \tupp{\setOfLowersets(\funsp), \setsubseteq}.
    \end{equation}
    Here~$\setOfUppersets (\ressp)$ denotes the set of \SY{upper sets} of~$\ressp$ and~$\setOfLowersets(\funsp)$ denotes the set of \SY{lower sets} of~$\funsp$.

    \begin{enumerate}
        \item Show that~$\widehat{\adp} \colon \funspop \mto \setOfUppersets (\ressp)$ and~$\widecheck{\adp} \colon \ressp \mto \setOfUppersets (\funspop)$ are \SY{monotone maps} when we consider~$\setOfUppersets (\ressp)$ and~$\setOfUppersets (\funspop)$ to have the partial order corresponding to the inclusion of subsets.
        \item Show that the \SY{poset} $\tupp{\setOfUppersets\funspop,\setsubseteq}$ and the \SY{poset} $\tupp{\setOfLowersets\funsp, \setsubseteq}$ are isomorphic.
        \item Show that there is a 1-to-1 correspondence between  \SY{monotone functions} \begin{equation}
                  \funspop \mto \tupp{\setOfUppersets \ressp, \setsubseteq}
              \end{equation}
              and  \SY{monotone functions} \begin{equation}
                  \funsp \mto \tupp{\setOfUppersets \ressp, {{\setsupseteq}}},
              \end{equation}
              where in the latter poset, the order is given by the relation of ``containment'' (as opposed to ``inclusion'').
        \item Explain, in a few words, why the above steps prove the stated goal of this exercise.
    \end{enumerate}
\end{gradedexercise}
\solutionof{CurryingDesignProblems}

\todotextjira{173}{\bernina: Explain how the above discussion connect to querying and intuition of the associated optimization problems.}
