% !TEX root = chapter-standalone.tex

\section[DPs as  monotone maps]{Design problems as  monotone maps}
\label{sec:dpdefinition}
\SYNDEF{design problem}
\linkvideo{spring2021-design:design:from-dpi-to-dp} % From DPI to DP

A DPI (\cref{def:DPI}) describes a relation between three sets:~\funsp, \ressp, \impsp.
If we are not interested in the implementations, but just in the relation between \funsp and \ressp, then we can describe a DPI more compactly as a ``DP''\@.

Recall how the problem \Feasibility was defined in \cref{prob:Feasibility}.
Given a particular functionality~$\fun$ and resource~$\res$, we would like to know if they are feasible.

This is a function from~$\funsp \cartprod \ressp$ to~$\boolset$:
%
\begin{equation}
    \mapb\colon \funsp \cartprod \ressp \sto \boolset.
    % leave cartprod
\end{equation}
%
The value~$\mapb(\fun, \res)$ is the answer to the question ``is the functionality~\fun feasible with resources~\res?''.
Due to how the problem is defined, we know that%
\begin{enumerate}
    \item If~\fun is feasible with~\res, then any~$\funan{2} \funleq \fun$ is feasible with~\res.
    \item If~\fun is feasible with~\res, then~\fun is feasible with any~$\resan{2} \resgeq \res$.
\end{enumerate}
Therefore, we can conclude that~$\mapb$ is monotone in the second argument~\res, and antitone in the first argument~$\fun$.

It is going to be convenient to have functions that are monotone in both arguments, and not mixed monotone/antitone.
Instead of considering a map from~$\funsp \Ctimes \ressp$ to~$\Bool$, we can turn things around and look at a map~$\adp$ from~$\funsp\op \Ctimes \ressp$ to~$\Bool$, defined as~$\adp(\fun,\res) = \mapb(\fun\Fop,\res)$.
Because we use~$\funsp\op$ rather than \funsp, the map~$\adp$ is monotone.

\iflabelexists{def:profunctor}{
    \begin{remark}[Spoilers]
        The map $\adp$ has the color of \SY{functors}, because it will be shown to be a particular type of \SY{functors}- a \SY{profunctor}~(\cref{def:profunctor}).
    \end{remark}
}

The feasibility map~$\adp$ has now forgotten everything about the implementations; however, it does contain all the information we need to solve co-design feasibility problems.

\linkvideo{spring2021-design:design:bool-prof} % Boolean profunctors

\begin{definition}[Design Problem]
    \SYNDEF{design problem}
    \label{def:design-problem}
    A design problem (DP) is a tuple~$\tup{\funsp, \ressp, \adp}$, where~$\funsp, \ressp$ are \SY{posets} and~$\adp$ is a \SY{monotone map} of the form%
    \begin{equation}
        \label{eq:design_prob_as_monfun}
        \adp \colon  \funsp\op \Ctimes \ressp \toinPos \Bool.
    \end{equation}
\end{definition}
We will also use the notation~$\adp \colon \funsp \profto \ressp$ for \SY{design problems}, in order to emphasize how we think of them as morphisms.
This will be explained below.
\begin{remark}
    \label{rem:DP-from-DPI}
    Given a DPI~$\tup{\funsp, \ressp, \impsp, \prov,\req}$ it is always possible to obtain from it the following DP
    \begin{equation}
        \label{eq:dpi_to_dp_1}
        \defmapperiod{
            \adp
        }{
            \funsp\op \Ctimes  \ressp
        }{
            \toinPos
        }{
            \Bool
        }{
            \tup{\fun\Fop,\res}
        }{
            \exists \imp \setin \impsp \colon (\fun \posleqof\funsp \prov(\imp)) \booland (\req(\imp)\posleqof\ressp \res)
        }
        %            \adp\colon \funsp\op \Ctimes \ressp & \toinPos  \Bool \\
        %            \tup{\fun\Fop,\res}                   & \mapsto \exists \imp \setin \impsp \colon (\fun \posleqof\funsp \prov(\imp)) \booland (\req(\imp)\posleqof\ressp \res).
    \end{equation}
    Evaluating this DP is the same as asking whether the set
    \begin{equation}
        \label{eq:dpi_to_dp_2}
        \makeset{ \imp \setin \impsp \colon (\fun \posleqof\funsp \prov(\imp)) \booland (\req(\imp)\posleqof\ressp \res)}
    \end{equation}
    is empty or not.
\end{remark}
\vfill\pagebreak
\begin{example}
    Recall \cref{exa:dpi_elmotor}, with the catalogue of electric motors in \cref{tab:electric_motors_3}.

    \begin{table*}[h]
        \centering
        \adjustbox{max width=\textwidth}{%
            \begin{tabular}{c|c|c|c|c|c}
                \F{$\unit[\text{Torque}]{[kg\cdot cm]}$} & \colI{Motor ID}        & \R{\unit[Weight]{[g]}} & \R{\unit[Max Power]{[W]}}
                                                         & \R{\unit[Cost]{[USD]}} \\
                \hline
                \F{0.18}                                 & \colI{\textsf{1204}}   & \R{60.0}               & \R{2.34}                  & \R{19.95} \\
                \F{0.95}                                 & \colI{\textsf{1206}}   & \R{140.0}              & \R{3.00}                  & \R{19.95} \\
                \F{0.65}                                 & \colI{\textsf{1207}}   & \R{130.0}              & \R{2.07}                  & \R{12.95} \\
                \F{3.7}                                  & \colI{\textsf{2267}}   & \R{285.0}              & \R{4.76}                  & \R{16.95} \\
                \F{1.9}                                  & \colI{\textsf{2279}}   & \R{165.0}              & \R{5.40}                  & \R{164.95} \\
                \F{19.0}                                 & \colI{\textsf{1478}}   & \R{1,000}              & \R{8.96}                  & \R{49.95} \\
                \F{2.2}                                  & \colI{\textsf{2299}}   & \R{150.0}              & \R{5.90}                  & \R{59.95}
            \end{tabular}%
        }
        \caption{A simplified catalogue of motors.
        }
        \label{tab:electric_motors_3}
    \end{table*}
    \begin{table*}[h]
        \centering
        \adjustbox{max width=\textwidth}{%
            \begin{tabular}{c|c|c|c|c|c}
                \F{$\unit[\text{Torque}]{[kg\cdot cm]}$} & \R{\unit[Weight]{[g]}} & \R{\unit[Max Power]{[W]}}
                                                         & \R{\unit[Cost]{[USD]}} \\
                \hline
                \F{0.18}                                 & \R{60.0}               & \R{2.34}                  & \R{19.95} \\
                \F{0.95}                                 & \R{140.0}              & \R{3.00}                  & \R{19.95} \\
                \F{0.65}                                 & \R{130.0}              & \R{2.07}                  & \R{12.95} \\
                \F{3.7}                                  & \R{285.0}              & \R{4.76}                  & \R{16.95} \\
                \F{1.9}                                  & \R{165.0}              & \R{5.40}                  & \R{164.95} \\
                \F{19.0}                                 & \R{1,000}              & \R{8.96}                  & \R{49.95} \\
                \F{2.2}                                  & \R{150.0}              & \R{5.90}                  & \R{59.95}
            \end{tabular}%
        }
        \caption{Feasibility relations for the \SY{design problem} of motors.
        }
        \label{tab:electric_motors_dp}
    \end{table*}

    \begin{figure}[tbh]
        \centering
        \includesag{520_dp_electric_motor}
        \caption{Electric motor design problem.}
        \label{fig:dp_em_2}
    \end{figure}

    The catalogue induces a \SY{design problem}~$\adpan{\mathrm{EM}}$, where each feasibility relation between functionality and resources is reported in \cref{tab:electric_motors_dp}.
    with diagrammatic form as in \cref{fig:dp_em_2}.
    In particular, we can query the \SY{design problem} for combinations of \textF{functionalities} and \textR{resources}.
    For instance:
    \begin{equation}
        \adpan{\mathrm{EM}}\left(\F{\unit[0.2]{kg\cdot cm}}, \R{\tup{\unit[50.0]{g}},\R{\unit[2.0]{W}},\R{\unit[15.0]{USD}}} \right)=\false,
    \end{equation}
    since no listed model can provide~$\F{\unit[0.2]{kg\cdot cm}}$ \textF{torque} by requiring the set of \textR{resources}~$\tup{\R{\unit[50.0]{g}},\R{\unit[2.0]{W}},\R{\unit[15.0]{USD}}}$ or less.

\end{example}

\section{DPs as upper sets}

\begin{definition}[Feasible set of a design problem]
    \label{def:dp-feasible-set}
    We define the \emph{feasible set}~$\feasibleset{\adp}$ of a design problem
    \begin{equation}
        \label{eq:generic-design-prob}
        \adp\colon \funsp\op \Ctimes \ressp \toinPos \Bool
    \end{equation}
    as the subset of~$\funsp \op\Ctimes \ressp$ for which~$\adp$ is the \emph{indicator function}, that is%
    \begin{equation}
        \label{eq:design-prob-as-upper-set}
        \feasibleset{\adp} = \makeset{ \tup{\F{\fun^*},\res} \setin \funsp \op\Ctimes \ressp  \mid %
            \adp(\fun\Fop, \res) = \true %
        }.
    \end{equation}
\end{definition}

Note that the feasibility set~$\feasibleset{\adp}$ of a \SY{design problem}~$\adp \colon \funsp \op \Ctimes \ressp\toinPos \Bool$ is a binary relation~$\feasibleset{\adp} \setsubseteq \funsp\op \Ctimes \ressp$.
We saw in \cref{rem:rel-three-fun-descriptions} that there is a one-to-one correspondence between functions~$\mapb \colon \setA \cartprod \setB \sto \boolset$ and binary relations~$\relA\colon \setA \mto \setB$.

An analogous correspondence holds in the context of \SY{design problems}:

\begin{exercise}
    \label{ex:adp-uppersets}
    Prove that there is a one-to-one correspondence between \SY{design problems}~$\adp \colon \funsp \op \Ctimes \ressp\toinPos \Bool$ and upper sets~$\feasibleset{\adp} \setsubseteq \funsp\op \Ctimes \ressp$.
\end{exercise}
\todotextjira{408}{\alphubel: @JL: Write solution to exercise \cref{ex:adp-uppersets}}
\begin{solution}
    \missingsolution

\end{solution}

Recall that when working with a relation~$\relA \colon \setA \sto \setB$ between sets, if the sets in question were finite, then we could conveniently draw the relation~\relA using arrows to connect elements of~\setA to those elements of~\setB to which they are related via~\relA.
Given a \SY{design problem}~$\adp \colon \funsp \op \Ctimes \ressp\toinPos \Bool$ involving finite \SY{posets}, we can visualize it in a similar fashion.
We use Hasse diagrams to visualize the \SY{posets} involved, and we use dashed arrows to connect those elements which are related via the feasibility set~$\feasibleset{\adp}$.

\begin{marginfigure}
    \centering
    \includesag{example_dp_composition_xy}
    \caption{}
    \label{fig:example_dp_graph_xy}
\end{marginfigure}
\begin{marginfigure}
    \centering
    \includesag{example_dp_graph_xy_feas}
    \caption{}
    \label{fig:example_dp_graph_xy_feas}
\end{marginfigure}

\begin{example}
    \label{exa:visualize-dp}
    In \cref{fig:example_dp_graph_xy} we have illustrated this kind of visualization in the case of a \SY{design problem} of the type
    \begin{equation}
        \adp \colon \F{\posgenA} \op \Ctimes  \R{\posgenB} \toinPos \Bool,
    \end{equation}
    where~$\F{\posgenA} = \tup{\posAset, \posleq}$ and~$ \R{\posgenB} = \tup{\posBset, \posleq}$ are finite \SY{posets}, with
    \begin{equation}
        \posAset = \makeset{ \setAeln{1}, \setAeln{2}, \setAeln{3} }
        \qqand
        \posBset =  \makeset{ \setBeln{1}, \setBeln{2}},
    \end{equation}
    and ordered as shown in the figure.

    The relation described by the \SY{design problem} is marked with the dashed arrows;
    The feasibility set
    \begin{equation}
        \feasibleset{\adp} = \makeset{\tup{\setAeln{1}, \setBeln{1}}, \tup{\setAeln{1}, \setBeln{2}}, \tup{\setAeln{2}, \setBeln{2}}, \tup{\setAeln{3}, \setBeln{2}} },
    \end{equation}
    is reported in \cref{fig:example_dp_graph_xy_feas}.
\end{example}

\begin{remark}
    \label{re:dp-from-monotone}
    Given any \SY{monotone maps}~$\mapb\colon \funsp \toinPos \ressp$, we can turn it into a design problem
    \begin{equation}
        \adp_\mapb \colon \funsp\op \Ctimes \ressp \toinPos \Bool
    \end{equation}
    via the following recipe.
    Set
    \begin{equation}
        \adp_\mapb (\fun\Fop, \res) = \true \quad \text{if and only if} \quad \mapb(\fun) \posleq \res.
    \end{equation}
\end{remark}

\begin{exercise}
    \label{ex:adp-monotone}
    Prove that~$\adp_\mapb$ as defined in \cref{re:dp-from-monotone} is indeed a \SY{design problem} when~$\mapb$ is a monotone map.
\end{exercise}
%
\todotextjira{412}{\alphubel: @JL: Write solution to exercise \cref{ex:adp-monotone}}

\begin{solution}
    \missingsolution
\end{solution}

The Boolean-valued \SY{design problems} we are considering in this section do not distinguish between particular implementations: they only tell us if \emph{any} implementation or solution exists for given functionality and resources.

\toexclude{
    \paragraph{Diagrammatic notation}
    We represent \SY{design problems} using a diagrammatic notation.
    One \SY{design problem}~$\adp \colon \funsp \profto \ressp$ is represented as a box with functionality~\funsp on the \emph{left} and resources~\ressp on the \emph{right} (\cref{fig:diagrammaticdp}).
    \begin{figure}[h!]
        \centering
        \includesag{50_diagrammatic}
        \caption{Diagrammatic representation of a design problem. }
        \label{fig:diagrammaticdp}
    \end{figure}

    As we did for DPIs, we will connect these diagrams.
}

\begin{marginfigure}
    \centering
    \includesag{50_engine}
    \caption{Diagram of the engine design problem.}
    \label{fig:enginedp}
\end{marginfigure}
\toexclude{
    \begin{example}
        An aerospace company, Jeb's Spaceship Parts, is designing a new rocket engine, the Bucket of Boom X100.
        The engine requires fuel and provides thrust, and so it can be modeled as a \SY{design problem} where \R{fuel} and \F{thrust} are two totally-ordered sets representing their respective resources.

        The corresponding diagram is reported in~\cref{fig:enginedp}.

        Concretely, ``engine'' is represented as a monotone map%
        %
        \begin{equation}
            \text{engine} \colon \Ftext{thrust}\op \Ctimes \Rtext{fuel} \toinPos \Bool.
        \end{equation}
        %
        Assuming that the \SY{posets} \R{fuel}, \F{thrust}$\op$ are finite, we can think of the ``engine'' \SY{design problem} as a matrix, where each~$(i,j)$-th entry is the answer to the question, ``is the amount of thrust~$\F{f_i}$ feasible with the amount of fuel~$\R{r_j}$?'':
        %
        \begin{equation}
            \begin{blockarray}{ccccccc}
                &&&& \Rtext{Fuel} \\
                && \R{r_1} = 0  & \R{r_2} & \R{r_3} & \hdots & \R{r_m} \\
                \begin{block}{cc(ccccc)}
                    & \F{f_n}\Fop = 0 & 0 & 0 & 0 & & 0 \\
                    & \F{f_{n-1}^*} & 0 & 0 & 0 & & 1 \\
                    \Ftext{thrust}\op & \F{f_{n-2}^*} & 0 & 1 & 1 & & 1 \\
                    & \vdots &  &  &  & \ddots & \\
                    & \F{f_1^*} & 1 & 1 & 1 & & 1 \\
                \end{block}
            \end{blockarray}
        \end{equation}
        %
        Suppose we have tested or are given the performance data of a few different engines, as possible solutions to the ``engine'' design problem, each with a fixed optimal fuel-thrust value.
        To illustrate the monotonicity assumption, we can render the data of ``engine'' as a graph, as depicted in~\cref{fig:solenginedp}.
        \begin{figure}[h!]
            \centering
            \includesag{50_engine_graph}
            \caption{Graphical representation of the possible solutions of the engine design problem. }
            \label{fig:solenginedp}
        \end{figure}

        Note that the shaded regions cover the feasible solution set.
        This feasible solution set is always an \emph{upper set} (\cref{def:upperset}) in~$\Ftext{thrust}\op \Ctimes \Rtext{fuel}$, which is another way of characterizing the monotonicity of the design problem.
        The optimal solutions, indicated by dots, form an \emph{antichain} of solutions.
        We will come back to \SY{antichains} when discussing how to compute optimal solutions of \SY{design problems}.

    \end{example}
}

\toexclude{
    \paragraph{A note on pre-orders}
    The theory of \SY{design problems} can be easily generalized to pre-orders.
    This means that there could be two elements~$\posAel$ and~$\posBel$ such that~$\posAel\posAleq \posBel$ and~$\posAel \posAgeq \posBel$ but~$\posAel \neq \posBel$.

    This is actually common in practice.
    For example, if the order relation comes from human judgement, such as customer preference, all bets are off regarding the consistency of the relation.
    We will only refer to \SY{posets} for two reasons:
    \begin{enumerate}
        \item The exposition is smoother.
        \item Given a pre-order, computation will always involve passing to the \SY{poset} representation.
    \end{enumerate}
    This means that, given a pre-order, we can consider the \SY{poset} of its isomorphism classes, by means of the following equivalence relation:
    \begin{equation}
        \posAel \simeq \posBel \quad \equiv \quad (\posAel \posAleq \posBel) \wedge (\posBel \posAleq \posAel).
    \end{equation}
}

%\JT{Do we need 2 large examples, or can we move the battery example to the notes?}
%
%\newcommand{\cCapacity}{\text{Capacity}}
%\newcommand{\cMass}{\text{Mass}}
%
%\begin{example}[Battery]
%   A battery is a store of elecrical energy.
%   We are interested in the relation between the capacity of the battery, measured
%   in joules, and the mass of the battery, measured in grams.
%   We will model the battery as a design problem
%   \[
%       \text{battery} : \cCapacity \profto \cMass,
%   \]
%   with the two \SY{posets} $\cCapacity$ and $\cMass$ defined as
%   $\cCapacity \definedas \langle\mathbb{R}_+^{\text{J}}, \leq\rangle$
%   and $\cMass \definedas \langle\mathbb{R}_+^{\text{g}}, \leq\rangle$, where ``$\leq$''' is the usual
%   order on $\mathbb{R}_+$.
%
%This is the corresponding diagram:
%   \[
%   \centering
%   \begin{tikzpicture}[oriented WD, bb min width =1.5cm, bby=2ex, bbx=.7cm,bb port length=3pt]
%       \node[bb port sep=0.8, bb={1}{1}, bb name={battery}] (dp) {};
%       \node [black, left = 0.2 of dp] {$\cCapacity$};
%       \node [black, right = 0.2 of dp] {$\cMass$};
%   \end{tikzpicture}
%   \]
%   The concrete representation of the design problem is
%   \[
%       \text{battery} \colon\cCapacity\op\times \cMass \toinPos \Bool,
%   \]
%%
%   In this case, the feasibility question is
%   \[
%           \text{battery}(c^*, m) = \true \quad \Leftrightarrow  \quad
%            \text{a battery of mass $m$ is sufficient to provide the capacity $c^*$.}
%   \]
%   It is easy to convince oneself that this ``$\text{battery}$'' is monotone from basic physics consideration.
%   Monotonicity is equivalent to the following two assertions:
%%
%   \newcommand{\qsmall}[1]{{\color{blue}#1}}
%   \newcommand{\qlarge}[1]{{\color{red}#1}}
%%
%\begin{enumerate}
%\item We can provide a smaller capacity with the same mass:
%   \begin{eqnarray}
%       \text{For all}\  \qlarge{c_2}  \geq_{\cCapacity} \qsmall{c_1},\quad
%       \text{a battery of mass $m$ is sufficient to provide the capacity $\qlarge{c_2}$} \\
%       \Rightarrow
%       \text{a battery of mass $m$ is sufficient to provide the capacity $\qsmall{c_1}$.}
%   \end{eqnarray}
%%
%\item A battery of larger mass can provide the same capacity:
%   \begin{eqnarray}
%       \text{For all}\ \qlarge{m_2} \geq_{\cMass} \qsmall{m_1},\quad
%       \text{a battery of mass $\qsmall{m_1}$ is sufficient to provide the capacity $c^*$} \\
%       \Rightarrow
%       \text{a battery of mass $\qlarge{m_2}$ is sufficient to provide the capacity $c^*$.}
%   \end{eqnarray}
%\end{enumerate}
%
%   Assume that there is a linear relation between mass and capacity,
%   and such relation is described by the energy density~$\rho$ [Wh/kg].
%   Then the minimum mass to provide~$c^*$ is~$m_\text{min} = m_0 + c^* / \rho$.
%   So we have
%   \[
%       \text{battery}(c^*, m) = \true \quad \Leftrightarrow \quad  m \geq m_0 + c^* / \rho.
%   \]
%   A visualization of the feasible set $\feasibleset{\text{battery}}$ is in \cref{fig:battery-1}.
%   Monotonicity means that if we fix one point $\tup{c^*,m}$,
%   if we increase $c^*$, we can only see at most one transition, from feasible to unfeasible.
%   Similarly, if we increase $m$, there is at most one transition from unfeasible to feasible.
%
%\end{example}
%
%\begin{figure}[h!]
%    \caption{}
% \label{fig:battery-1}
%\end{figure}
