\section{The \SY{semicategory} \DPI}
\label{sec:DPI-semicat}

\todotext{Write intro}

\begin{definition}[Semicategory \DPI]
    \label{def:DPIcat}
    \SYNDEF{semicategory of design problems with implementation}
    There is a \SY{semicategory} \DPI where
    \begin{itemize}
        \item The objects are \SY{posets}, objects of \PosL.
        \item The morphisms from \funsp to \ressp are DPIs $\tupp{\funsp,\ressp,\impsp,\prov,\req}$, with \impsp an object of \SetL.
        \item Given two morphisms \label{def:dpi-series}
              \begin{align}
                  \adpan{1} & \colon \funspa \profto \resspb, \\
                  \adpan{2} & \colon \funspb \profto \resspc,
              \end{align}
              described by
              \begin{align}
                  \adpan{1} & = \tupp{\funspa,\resspb,\impspn{1},\provn{1},\reqn{1}}, \\
                  \adpan{2} & = \tupp{\funspb,\resspc,\impspn{2},\provn{2},\reqn{2}},
              \end{align}
              their composition~$\adpan{1} \dpithen \adpan{2}$ is given by
              \begin{equation}
                  \adpan{1} \dpithen \adpan{2} = \tupp{\funspa,\resspc,\impsp,\prov,\req},
              \end{equation}
              where
              \begin{align}
                  \impsp & = \makeset{ \impn{1} \tupconcat \impn{2} \setin \makecprod{\impspn{1}, \impspn{2}} \mid \reqn{1}(\impn{1}) \posleqof{\neutrb} \provn{2}(\impn{2})}, \\
                  \prov  & \colon \impn{1} \tupconcat \impn{2} \mapsto \provn{1}(\impn{1}), \\
                  \req   & \colon \impn{1} \tupconcat \impn{2} \mapsto \reqn{2}(\impn{2}).
              \end{align}
    \end{itemize}
\end{definition}

\showslides{
    \begin{forslides}
        \begin{equation}
            \label{eq:adpa}
            \adpa
        \end{equation}
        \begin{equation}
            \label{eq:adpb}
            \adpb
        \end{equation}
        \begin{equation}
            \label{eq:adp1}
            \adpa: \FB{A} \profto  \RB{B}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp1pf}
            \adpa: \FB{A}\op \cartprod  \RB{B} \to_{\Pos} \Bool
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp1us}
            \adpa: \FB{A} \to \uppersets \RB{B}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp2pf}
            \adpb: \FB{B}\op \cartprod  \RB{C} \to_{\Pos} \Bool
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp2us}
            \adpb: \FB{B} \to \uppersets \RB{C}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp3us}
            \adpb: \FB{C} \to \uppersets \RB{D}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp12pf}
            (\adpa\dpithen\adpb): \FB{A}\op \cartprod  \RB{C} \to_{\Pos} \Bool
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp12us}
            (\adpa\dpithen\adpb): \FB{A}  \to\uppersets \RB{C}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adpM12us}
            (\adpa\dpithen\adpb):(\FB{A} \cartprod \FB{C})  \to\uppersets (\RB{C} \cartprod \RB{D})
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp12pfexpr}
            \langle\F{a}^*, \R{c}\rangle \mapsto \bigvee_{b_1\leq b_2} \adpa(\F{a}\op, b_1) \wedge \adpb(b_2\op, \R{c})
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp2}
            \adpb: \FB{B} \profto  \RB{C}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp1adp2}
            \adpa\dpithen\adpb: \FB{A} \profto  \RB{C}
        \end{equation}
        %
        \begin{equation}
            \label{eq:FA}
            \FB{A}
        \end{equation}
        \begin{equation}
            \label{eq:FB}
            \FB{B}
        \end{equation}
        \begin{equation}
            \label{eq:FC}
            \FB{C}
        \end{equation}
        \begin{equation}
            \label{eq:FD}
            \FB{D}
        \end{equation}
        \begin{equation}
            \label{eq:RA}
            \RB{A}
        \end{equation}
        \begin{equation}
            \label{eq:RB}
            \RB{B}
        \end{equation}
        \begin{equation}
            \label{eq:RC}
            \RB{C}
        \end{equation}
        \begin{equation}
            \label{eq:RD}
            \RB{D}
        \end{equation}
        \begin{equation}
            \label{eq:impsp1}
            \impsp_1
        \end{equation}
        \begin{equation}
            \label{eq:impsp2}
            \impsp_2
        \end{equation}
        \begin{equation}
            \label{eq:impsp12}
            \impsp_{1} \cartprod \impsp_{2}
        \end{equation}
        \begin{equation}
            \label{eq:dproba}
            \adp \colon \funsp \profto \ressp
        \end{equation}
        %
        \begin{equation}
            \label{eq:dprob2}
            \ftor \colon \funsp \profto \Uressp
        \end{equation}
    \end{forslides}
}

% Graphically, one is allowed to connect only edges of different colors and of the same type.
% This interconnection is indicated with the symbol~``$\preceq$'' in a rounded box~(\cref{fig:connection}).

% \begin{figure}[h]
%     \centering
%     \includesag{520_dp_unc_conn}
%     \caption{}
%     \label{fig:connection}
% \end{figure}

%\captionsideleft{\label{fig:connection}}{\includegraphics[scale=0.33]{papers/uncertainty/unc_connection.pdf}}

The semantics of the interconnection is that the second DPI provides the resources required by the first DPI.
This is a partial order inequality constraint of the type~$\resan{1}\posleq\funan{2}$.

\linkvideo{spring2021-design:design:dpi-comp} % Composing DPIs
% \begin{definition}[DPI composition]
%     \label{def:series-composition}
%     The series composition of two DPIs
%     \begin{equation}
%         \begin{aligned}
%             \adp_{1} & =  \tupp{\funsp_{1},\ressp_{1},\impsp_{1},\prov_{1},\req_{1}}, \\
%             \adp_{2} & =  \tupp{\funsp_{2},\ressp_{2},\impsp_{2},\prov_{2},\req_{2}},
%         \end{aligned}
%     \end{equation}
%     for which~$\funsp_{2}=\ressp_{1},$ is defined as
%     \begin{equation}
%         (\adp_{1} \dpithen \adp_{2})
%         \definedas
%         \tupp{ \funsp_{1},\ressp_{2},\impsp,\prov,\req},
%     \end{equation}
%     where:
%     \begin{equation}
%         \impsp  =  \makeset{
%             \tupp {\imp_{1}, \imp_{2}} \setin (\impsp_{1} \cartprod \impsp_{2})\mid\req_{1}(\imp_{1})\posleqof{\ressp_{1}}\prov_{2}(\imp_{2})
%         },
%     \end{equation}
%     \begin{equation}
%         \begin{aligned}
%             \prov & : & \tupp {\imp_{1}, \imp_{2}} & \mapsto\prov_{1}(\imp_{1}), \\
%             \req  & : & \tupp {\imp_{1}, \imp_{2}} & \mapsto\req_{2}(\imp_{2}).
%         \end{aligned}
%     \end{equation}
% \end{definition}

% \begin{marginfigure}
%     \centering
%     \includesag{dpi_series}
%     \caption{}
%     \label{fig:composition-2}
% \end{marginfigure}

% The composition is graphically represented as in \cref{fig:composition-2}.

\begin{lemma}
    Series composition is \SY{associative}.
\end{lemma}
\begin{proof}
    Consider
    \begin{equation}
        \begin{aligned}
            \adpan{1} & = \tupp{\funspa,\resspb,\impspn{1},\provn{1},\reqn{1}}, \\
            \adpan{2} & = \tupp{\funspb,\resspc,\impspn{2},\provn{2},\reqn{2}}, \\
            \adpan{3} & = \tupp{\funspc,\resspd,\impspn{3},\provn{3},\reqn{3}}.
        \end{aligned}
    \end{equation}
    We want to show that
    \begin{equation}
        \label{eq:assoc_dpi}
        (\adpan{1}\dpithen \adpan{2})\dpithen \adpan{3}=\adpan{1}\dpithen (\adpan{2}\dpithen \adpan{3}).
    \end{equation}
    We know that the first part of the left term of \cref{eq:assoc_dpi} gives
    \begin{equation}
        (\adpan{1} \dpithen \adpan{2})
        =
        \tupp{ \funspa,\resspc,\impspn{1,2},\provn{1,2},\reqn{1,2}},
    \end{equation}
    where
    \begin{align}
        \impspn{1, 2} & = \makeset{ \impn{1} \tupconcat \impn{2} \setin \makecprod{\impspn{1}, \impspn{2}} \mid \reqn{1}(\impn{1}) \posleqof{\neutrb} \provn{2}(\impn{2})} \\
        \provn{1,2}   & \colon \impn{1} \tupconcat \impn{2} \mapsto \provn{1}(\impn{1}) \\
        \reqn{1,2}    & \colon \impn{1} \tupconcat \impn{2} \mapsto \reqn{2}(\impn{2})
    \end{align}
    Therefore, the full left term of \cref{eq:assoc_dpi} reads
    \begin{equation}
        \label{eq:dpi_ass_1}
        (\adpan{1} \dpithen \adpan{2})\dpithen \adpan{3}=\tupp{ \funspa,\resspd,\impspn{1,3},\provn{1,3},\reqn{1,3}},
    \end{equation}
    where
    \begin{align}
        \impspn{1, 3} & = \makeset{ \impn{1} \tupconcat \impn{2} \tupconcat \impn{3} \setin \impsp \mid \reqn{1,2}(\impn{1}\tupconcat \impn{2}) \posleqof{\neutrc} \provn{3}(\impn{3})\booland \reqn{1}(\impn{1})\posleqof{\neutrb}\provn{2}(\impn{2})}, \\
                      & = \makeset{ \impn{1} \tupconcat \impn{2} \tupconcat \impn{3} \setin \impsp \mid \reqn{2}(\impn{2}) \posleqof{\neutrc} \provn{3}(\impn{3})\booland \reqn{1}(\impn{1})\posleqof{\neutrb}\provn{2}(\impn{2})}, \\
        \provn{1,3}   & \colon \impn{1} \tupconcat \impn{2} \tupconcat \impn{3} \mapsto \provn{1,2}(\impn{1}\tupconcat \impn{2})=\provn{1}(\impn{1}), \\
        \reqn{1,3}    & \colon \impn{1} \tupconcat \impn{2}\tupconcat \impn{3} \mapsto \reqn{3}(\impn{3}),
    \end{align}
    where~$\impsp=\makecprod{\impspn{1}, \impspn{2}, \impspn{3}}$.

    By expanding the second part of the second term of \cref{eq:assoc_dpi}, we have:
    \begin{equation}
        (\adpan{2} \dpithen \adpan{3})
        =
        \tupp{ \funspb,\resspd,\impspn{2,3},\provn{2,3},\reqn{2,3}},
    \end{equation}
    where
    \begin{align}
        \impspn{2, 3} & = \makeset{ \impn{2} \tupconcat \impn{3} \setin \makecprod{\impspn{2}, \impspn{3}} \mid \reqn{2}(\impn{2}) \posleqof{\neutrc} \provn{3}(\impn{3})} \\
        \provn{2,3}   & \colon \impn{2} \tupconcat \impn{3} \mapsto \provn{2}(\impn{2}) \\
        \reqn{2,3}    & \colon \impn{2} \tupconcat \impn{3} \mapsto \reqn{3}(\impn{3})
    \end{align}
    Therefore, the full right term of \cref{eq:assoc_dpi} reads
    \begin{equation}
        \label{eq:dpi_ass_2}
        \adpan{1} \dpithen (\adpan{2}\dpithen \adpan{3})=\tupp{ \funspa,\resspd,\impspn{1,3}\colI{'},\provn{1,3}\colF{'},\reqn{1,3}\colR{'}},
    \end{equation}
    where
    \begin{align}
        \impspn{1, 3}\colI{'} & = \makeset{ \impn{1} \tupconcat \impn{2} \tupconcat \impn{3} \setin \impsp \mid \reqn{1}(\impn{1}) \posleqof{\neutrb} \provn{2,3}(\impn{2}\tupconcat\impn{3})\booland \reqn{2}(\impn{2})\posleqof{\resspc}\provn{3}(\impn{3})}, \\
                              & =   \makeset{ \impn{1} \tupconcat \impn{2} \tupconcat \impn{3} \setin \impsp \mid \reqn{1}(\impn{1}) \posleqof{\neutrb} \provn{2}(\impn{2})\booland \reqn{2}(\impn{2})\posleqof{\resspc}\provn{3}(\impn{3})}, \\
        \provn{1,3}\colF{'}   & \colon \impn{1} \tupconcat \impn{2} \tupconcat \impn{3} \mapsto \provn{1}(\impn{1}), \\
        \reqn{1,3}\colR{'}    & \colon \impn{1} \tupconcat \impn{2}\tupconcat \impn{3} \mapsto \reqn{2,3}(\impn{2}\tupconcat \impn{3})=\reqn{3}(\impn{3}).
    \end{align}

    It is clear that~$\impspn{1,3}=\impspn{1,3}\colI{'}$,~$\provn{1,3}=\provn{1,3}\colF{'}$, and~$\reqn{1,3}=\reqn{1,3}\colR{'}$.
    This, together with \cref{eq:dpi_ass_1} and \cref{eq:dpi_ass_2} shows associativity.
\end{proof}

These two properties are sufficient to conclude that there exists a \SY{semicategory} of \SY{design problems}.

\linkvideo{spring2021-design:design:dpi-semicat} % Semi-category DPI

\begin{lemma}
    \DPI is not a category, because one cannot find identities.
\end{lemma}
\begin{proof}
    We prove this by contradiction.
    Suppose we can find a DPI that works as an identity for interconnection for any other DPI with implementation space $\impsp_{\catid}$.
    Therefore, when postponed to a DPI with implementation space~$\impspn{1}$ we should have that
    \begin{equation}
        \makecprod{\impspn{1}, \impspn{\catid}} = \impspn{1}.
    \end{equation}
    This implies that~$\impspn{\catid}$ is an empty list of sets, that is inhabited by only one element, the empty tuple.
    Therefore, the map~$\reqn{\catid}$ of the identity is necessarily a constant, because there is only one element in the domain.
    Therefore, it is impossible to preserve~$\reqn{1}$.
\end{proof}
% We also have an identity.

% \begin{definition}[Identity for DPI] For any \SY{poset} $\posgenA$, we can define a DPI
%   \begin{equation}
%     \funid_\posgenA = \tupp{\funsp,\ressp,\impsp,\prov,\req}
%   \end{equation}
%   as follows:
%   \begin{equation}
%     \funsp = \ressp = \impsp = \posgenA,
%   \end{equation}
%   \begin{equation}
%     \prov = \req = \catid_{\posAset},
%   \end{equation}
%   where $\catid_{\posAset}$ is the identity on the set $\posAset$.

%   %   \begin{equation}
%   %   \definemap{\prov}{\impsp}{\funsp}{a}{a}
%   % \end{equation}
%   % \begin{equation}
%   %   \definemap{\req}{\impsp}{\ressp}{a}{a}
%   % \end{equation}
% \end{definition}

% \begin{lemma}
%   $\adp \dpithen \funid_{\ressp} = \adp$
% \end{lemma}
% \begin{proof}
% Take
% \begin{equation}
% \adp = \tupp{\funsp,\posgenA,\impsp,\prov,\req}
% \end{equation}
% We have for the series
% \begin{equation}
%   \impsp =
%   \makeset{
%      {\imp_1} {\imp_2} \setin (\impsp \cartprod \posgenA)
%       \mid
%       \req_{1}(\imp_{1}) \posleqof{\posgenA} \prov_{2}(\imp_{2})
% }
% \end{equation}
% \end{proof}
% \devel{
%     \subsection{Feedback in DPI}

%     \todojira{194}{define here $\dploopb$.
%         Later we define $\dploop$}
% }

\section{Sum and intersection of DPIs}
\label{subsec:dpi-intersection}

\subsection{Sum of DPIs}\label{subsec:dpi-union}

The sum of two \SY{design problems with implementation} is a \SY{design problem} with the implementation space~$\impsp=\impsp_{1}\setdisunion\impsp_{2}$, and it represents the exclusive choice between two possible alternative families of designs.

\begin{marginfigure}
    \centering
    \includesag{20_dpi_coproduct}
    \caption{}
    \label{fig:dpcoproduct}
\end{marginfigure}

\begin{definition}[Sum of DPIs]
    \label{def:parallel-1}
    Given two DPIs with same functionality and resources~$\adpa=\tupp{\funsp,\ressp,\impspn{1},\provn{1},\reqn{1}}$ and~$\adpb=\tupp{\funsp,\ressp,\impspn{2},\provn{2},\reqn{2}}$, define their sum as
    \begin{equation}
        \adpa \dpjoin\adpb\definedas\tupp{\funsp,\ressp,\impspn{1}\setdisunion\impspn{2},\prov,\req},
    \end{equation}
    where
    \begin{equation}
        \begin{aligned}
            \prov & = \provn{1} \funcsum \provn{2}, \\
            \req  & = \reqn{1} \funcsum \reqn{2}.
        \end{aligned}
    \end{equation}

    %     \begin{eqnarray}
    %     \prov & \colon & \imp\mapsto\begin{cases}
    %                                     \prov_{1}(\imp), & \text{if }\imp\setin\impsp_{1}, \\
    %                                     \prov_{2}(\imp), & \text{if }\imp\setin\impsp_{2},
    %                                 \end{cases}\label{eq:dppar-exec-1} \\
    %     \req  & \colon & \imp\mapsto\begin{cases}
    %                                     \req_{1}(\imp), & \text{if }\imp\setin\impsp_{1}, \\
    %                                     \req_{2}(\imp), & \text{if }\imp\setin\impsp_{2}.
    %                                 \end{cases}\nonumber
    % \end{eqnarray}
\end{definition}

\todotext{Do an example of this}
%
%\captionsideleft{\label{fig:dpcoproduct}}{
%  \includegraphics[scale=0.33]{gmcdp_coproduct}
%}

\subsection{Intersection of DPIs}
\todotext{write intro}

\begin{marginfigure}
    \centering
    \includesag{dpi_intersection}
    \caption{}
    \label{fig:intersection}
\end{marginfigure}

\begin{definition}[Intersection of DPIs]
    \label{def:intersection-1}
    Given two DPIs with same functionality and resources~$\adpa=\tupp{\funsp,\ressp,\impsp_{1},\prov_{1},\req_{1}}$ and~$\adpb=\tupp{\funsp,\ressp,\impsp_{2},\prov_{2},\req_{2}}$, define their intersection as
    \begin{equation}
        \adpa \dpmeet\adpb\definedas\tupp{\funsp,\ressp,\impsp,\prov,\req},
    \end{equation}
    where
    \begin{equation}
        \begin{multlined}
            \impsp = \opensetbracket
            (\maketupconcat{\impn{1}, \impn{2}, \fun, \res})
            \setin (
            \makecprod{ \impspn{1}, \impspn{2}, \funsp, \ressp }
            ) \mid \\
            \qquad
            (\fun \funleq \provn{1}(\impn{1}))  \booland
            (\fun \funleq \provn{2}(\impn{2}))  \booland \\
            (  \reqn{1}(\impn{1}) \resleq \res )  \booland
            ( \reqn{2}(\impn{2}) \resleq \res )
            \closesetbracket
        \end{multlined}
    \end{equation}
    and the maps~$\prov$ and~$\req$ are the projections of the third and fourth component.
\end{definition}

\todotext{Do an example of this}
