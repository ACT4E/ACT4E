\section{The semicategory \DPI}
\label{sec:DPI-semicat}

\todotext{Write intro}

\begin{definition}[Semicategory \DPI]
    \label{def:DPIcat}
    There is a semicategory \DPI where
    \begin{itemize}
        \item The objects are posets, objects of \PosL.
        \item The morphisms from \funsp to \ressp are DPIs $\tupp{\funsp,\ressp,\impsp,\prov,\req}$, with \impsp an object of \SetL.
        \item Given two morphisms
              \begin{align}
                  \adpan{1} & \colon \posA \to \posB, \\
                  \adpan{2} & \colon \posB \to \posC,
              \end{align}
              described by
              \begin{align}
                  \adpan{1} & = \tupp{\posA,\posB,\impspn{1},\provn{1},\reqn{1}}, \\
                  \adpan{2} & = \tupp{\posB,\posC,\impspn{2},\provn{2},\reqn{2}},
              \end{align}
              their composition~$\adpan{1} \fthen \adpan{2}$ is given by
              \begin{equation}
                  \adpan{1} \fthen \adpan{2} = \tupp{\posA,\posC,\impsp,\prov,\req},
              \end{equation}
              where
              \begin{align}
                  \impsp & = \makeset{ \impn{1} \tupconcat \impn{2} \setin \makecprod{\impspn{1}, \impspn{2}} \mid \reqn{1}(\impn{1}) \posleq_{\posB} \provn{2}(\impn{2})} \\
                  \prov  & \colon \impn{1} \tupconcat \impn{2} \mapsto \provn{1}(\impn{1}) \\
                  \req   & \colon \impn{1} \tupconcat \impn{2} \mapsto \reqn{2}(\impn{2})
              \end{align}
    \end{itemize}
\end{definition}

\showslides{
    \begin{forslides}
        \begin{equation}
            \label{eq:adpa}
            \adpa
        \end{equation}
        \begin{equation}
            \label{eq:adpb}
            \adpb
        \end{equation}
        \begin{equation}
            \label{eq:adp1}
            \adpa: \FB{A} \profto  \RB{B}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp1pf}
            \adpa: \FB{A}^{\op} \cartprod  \RB{B} \to_{\Pos} \Bool
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp1us}
            \adpa: \FB{A} \to \uppersets \RB{B}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp2pf}
            \adpb: \FB{B}^{\op} \cartprod  \RB{C} \to_{\Pos} \Bool
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp2us}
            \adpb: \FB{B} \to \uppersets \RB{C}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp3us}
            \adpb: \FB{C} \to \uppersets \RB{D}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp12pf}
            (\adpa\fthen\adpb): \FB{A}^{\op} \cartprod  \RB{C} \to_{\Pos} \Bool
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp12us}
            (\adpa\fthen\adpb): \FB{A}  \to\uppersets \RB{C}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adpM12us}
            (\adpa\fthen\adpb):(\FB{A} \cartprod \FB{C})  \to\uppersets (\RB{C} \cartprod \RB{D})
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp12pfexpr}
            \langle\F{a}^*, \R{c}\rangle \mapsto \bigvee_{b_1\leq b_2} \adpa(\F{a}^{\text{op}}, b_1) \wedge \adpb(b_2^{\text{op}}, \R{c})
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp2}
            \adpb: \FB{B} \profto  \RB{C}
        \end{equation}
        %
        \begin{equation}
            \label{eq:adp1adp2}
            \adpa\fthen\adpb: \FB{A} \profto  \RB{C}
        \end{equation}
        %
        \begin{equation}
            \label{eq:FA}
            \FB{A}
        \end{equation}
        \begin{equation}
            \label{eq:FB}
            \FB{B}
        \end{equation}
        \begin{equation}
            \label{eq:FC}
            \FB{C}
        \end{equation}
        \begin{equation}
            \label{eq:FD}
            \FB{D}
        \end{equation}
        \begin{equation}
            \label{eq:RA}
            \RB{A}
        \end{equation}
        \begin{equation}
            \label{eq:RB}
            \RB{B}
        \end{equation}
        \begin{equation}
            \label{eq:RC}
            \RB{C}
        \end{equation}
        \begin{equation}
            \label{eq:RD}
            \RB{D}
        \end{equation}
        \begin{equation}
            \label{eq:impsp1}
            \impsp_1
        \end{equation}
        \begin{equation}
            \label{eq:impsp2}
            \impsp_2
        \end{equation}
        \begin{equation}
            \label{eq:impsp12}
            \impsp_{1} \cartprod \impsp_{2}
        \end{equation}
        \begin{equation}
            \label{eq:dproba}
            \adp \colon \funsp \profto \ressp
        \end{equation}
        %
        \begin{equation}
            \label{eq:dprob2}
            \ftor \colon \funsp \profto \Uressp
        \end{equation}
    \end{forslides}
}

% Graphically, one is allowed to connect only edges of different colors and of the same type.
% This interconnection is indicated with the symbol~``$\preceq$'' in a rounded box~(\cref{fig:connection}).

% \begin{figure}[h]
%     \centering
%     \includesag{520_dp_unc_conn}
%     \caption{}
%     \label{fig:connection}
% \end{figure}

%\captionsideleft{\label{fig:connection}}{\includegraphics[scale=0.33]{papers/uncertainty/unc_connection.pdf}}

The semantics of the interconnection is that the second DPI provides the resources required by the first DPI.
This is a partial order inequality constraint of the type~$\res_{1}\posleq\fun_{2}$.

\linkvideo{spring2021-design:design:dpi-comp} % Composing DPIs
% \begin{definition}[DPI composition]
%     \label{def:series-composition}
%     The series composition of two DPIs
%     \begin{equation}
%         \begin{aligned}
%             \adp_{1} & =  \tupp{\funsp_{1},\ressp_{1},\impsp_{1},\prov_{1},\req_{1}}, \\
%             \adp_{2} & =  \tupp{\funsp_{2},\ressp_{2},\impsp_{2},\prov_{2},\req_{2}},
%         \end{aligned}
%     \end{equation}
%     for which~$\funsp_{2}=\ressp_{1},$ is defined as
%     \begin{equation}
%         (\adp_{1} \fthen \adp_{2})
%         \definedas
%         \tupp{ \funsp_{1},\ressp_{2},\impsp,\prov,\req},
%     \end{equation}
%     where:
%     \begin{equation}
%         \impsp  =  \makeset{
%             \tupp {\imp_{1}, \imp_{2}} \setin (\impsp_{1} \cartprod \impsp_{2})\mid\req_{1}(\imp_{1})\posleqof{\ressp_{1}}\prov_{2}(\imp_{2})
%         },
%     \end{equation}
%     \begin{equation}
%         \begin{aligned}
%             \prov & : & \tupp {\imp_{1}, \imp_{2}} & \mapsto\prov_{1}(\imp_{1}), \\
%             \req  & : & \tupp {\imp_{1}, \imp_{2}} & \mapsto\req_{2}(\imp_{2}).
%         \end{aligned}
%     \end{equation}
% \end{definition}

% \begin{marginfigure}
%     \centering
%     \includesag{dpi_series}
%     \caption{}
%     \label{fig:composition-2}
% \end{marginfigure}

% The composition is graphically represented as in \cref{fig:composition-2}.

\begin{lemma}
    Series composition is associative.
\end{lemma}
\devel {
    \todotext{@Gioele: adapt the proof with new notation}

    \begin{proof}
        Consider
        \begin{equation}
            \begin{aligned}
                \adp_{1} & = \tupp{\funsp_{1},\ressp_{1},\impsp_{1},\prov_{1},\req_{1}}, \\
                \adp_{2} & = \tupp{\funsp_{2},\ressp_{2},\impsp_{2},\prov_{2},\req_{2}}, \\
                \adp_{3} & = \tupp{\funsp_{3},\ressp_{3},\impsp_{3},\prov_{3},\req_{3}},
            \end{aligned}
        \end{equation}
        for which~$\funsp_{2}=\ressp_{1}$ and~$\funsp_{3}=\ressp_{2}$.
        We want to show that
        \begin{equation}
            \label{eq:assoc_dpi}
            (\adp_1\fthen \adp_2)\fthen \adp_3=\adp_1\fthen (\adp_2\fthen \adp_3).
        \end{equation}
        We know that the first part of the left term of \cref{eq:assoc_dpi} gives
        \begin{equation}
            (\adp_{1} \fthen \adp_{2})
            =
            \tupp{ \funsp_{1},\ressp_{2},\impsp_{1,2},\prov_{1,2},\req_{1,2}},
        \end{equation}
        Therefore, the full left term of \cref{eq:assoc_dpi} reads
        \begin{equation}
            \label{eq:dpi_ass_1}
            (\adp_{1} \fthen \adp_{2})\fthen \adp_{3}=\tupp{ \funsp_{1},\ressp_{3},\impsp_{1,3},\prov_{1,3},\req_{1,3}},
        \end{equation}
        with
        \begin{equation}
            \begin{aligned}
                \impsp_{1,3} & =  \opensetbracket  \tupp {\tupp{\imp_{1}, \imp_{2}}, \imp_{3}} \setin ((\impsp_{1} \cartprod \impsp_{2})\cartprod \impsp_{3})\mid\req_{1,2}
                (\tupp {\imp_{1}, \imp_{2}})\posleqof{\ressp_{2}}\prov_{3}(\imp_{3}) \\
                             & \qquad \wedge \req_{1}(\imp_{1})\posleqof{\ressp_1}\prov_2(\imp_2) \closesetbracket \\
                             & =\opensetbracket  \tupp{\imp_{1}, \imp_{2}, \imp_{3}} \setin (\impsp_{1} \cartprod \impsp_{2}\cartprod \impsp_{3})\mid\req_{2}(\imp_2)\posleqof{\ressp_{2}}\prov_{3}(\imp_{3}) \\
                             & \qquad \wedge \req_{1}(\imp_{1})\posleqof{\ressp_1}\prov_2(\imp_2) \closesetbracket
            \end{aligned}
        \end{equation}
        and
        \begin{equation}
            \begin{aligned}
                \prov_{1,3} \colon \tupp {\tupp {\imp_{1}, \imp_{2}}, \imp_{3}} & \mapsto\prov_{1,2}(\tupp{\imp_{1}, \imp_{2}}), \\
                \tup{\imp_{1}, \imp_{2}, \imp_{3}}                              & \mapsto \prov_1(\imp_{1}), \\
                \req_{1,3} \colon \tupp {\tupp {\imp_{1}, \imp_{2}}, \imp_{3}}  & \mapsto\req_{3}(\imp_{3}) \\
                \tupp{\imp_{1}, \imp_{2},\imp_{3}}                              & \mapsto\req_{3}(\imp_{3}).
            \end{aligned}
        \end{equation}
        By expanding the second part of the second term of \cref{eq:assoc_dpi}, we have:
        \begin{equation}
            (\adp_{2} \fthen \adp_{3})
            =
            \tupp{ \funsp_{2},\ressp_{3},\impsp_{2,3},\prov_{2,3},\req_{2,3}},
        \end{equation}
        Therefore, the full right term of \cref{eq:assoc_dpi} reads
        \begin{equation}
            \label{eq:dpi_ass_2}
            \adp_{1} \fthen (\adp_{2}\fthen \adp_{3})=\tupp{ \funsp_{1},\ressp_{3},\impsp'_{1,3},\prov'_{1,3},\req'_{1,3}},
        \end{equation}
        with
        \begin{equation}
            \begin{aligned}
                \impsp_{1,3}' & =  \opensetbracket  \tupp {\imp_{1}, \tupp {\imp_{2}, \imp_{3}}} \setin (\impsp_{1} \cartprod (\impsp_{2}\cartprod \impsp_{3}))\mid\req_{1}(\imp_{1})\posleqof{\ressp_{1}}\prov_{2,3}
                (\tupp{\imp_{2}, \imp_{3}}) \\
                              & \qquad \wedge \req_2(\imp_2)\posleqof{\ressp_2}\prov_3(\imp_3)\closesetbracket \\
                              & =\opensetbracket  \tupp{\imp_{1}, \imp_{2}, \imp_{3}} \setin (\impsp_{1} \cartprod \impsp_{2}\cartprod \impsp_{3})\mid\req_{1}(\imp_{1})\posleqof{\ressp_{1}}\prov_{2}(\imp_2) \\
                              & \qquad \wedge \req_2(\imp_2)\posleqof{\ressp_2}\prov_3(\imp_3)\closesetbracket
            \end{aligned}
        \end{equation}
        and
        \begin{equation}
            \begin{aligned}
                \prov'_{1,3} \colon  \tupp{\imp_{1}, \tup{\imp_{2}, \imp_{3}}} & \mapsto\prov_{1}(\imp_{1}) \\
                \tupp{\imp_{1}, \imp_{2}, \imp_{3}}                            & \mapsto\prov_{1}(\imp_{1}), \\
                \req'_{1,3} \colon  \tupp{\imp_{1}, \tup{\imp_{2}, \imp_{3}}}  & \mapsto\req_{2,3}(\tupp{\imp_{2}, \imp_{3}}) \\
                \tupp{\imp_{1}, \imp_{2}, \imp_{3}}                            & \mapsto \req_{3}(\imp_{3})
            \end{aligned}
        \end{equation}
        It is clear that~$\impsp_{1,3}=\impsp'_{1,3}$,~$\prov_{1,3}=\prov'_{1,3}$, and~$\req_{1,3}=\req'_{1,3}$.
        This, together with \cref{eq:dpi_ass_1} and \cref{eq:dpi_ass_2} shows associativity.
    \end{proof}
}

These two properties are sufficient to conclude that there exists a semicategory of design problems.

\linkvideo{spring2021-design:design:dpi-semicat} % Semi-category DPI

\begin{lemma}
    \DPI is not a category, because one cannot find identities.
\end{lemma}
\begin{proof}
    We prove this by contradiction.
    Suppose we can find a DPI that works as an identity for interconnection for any other DPI with implementation space $\impsp_{\catid}$.
    Therefore, when postponed to a DPI with implementation space $\impsp_1$ we should have that
    \begin{equation}
        \makecprod{\impsp_1, \impsp_{\catid}} = \impsp_1.
    \end{equation}
    This implies that $\impsp_{\catid}$ is an empty list of sets, that is inhabited by only one element, the empty tuple.
    Therefore, the map $\req_{\catid}$ of the identity is necessarily a constant, because there is only one element in the domain.
    Therefore, it is impossible to preserve $\req_1$.
\end{proof}
% We also have an identity.

% \begin{definition}[Identity for DPI] For any poset $\posgenA$, we can define a DPI
%   \begin{equation}
%     \funid_\posgenA = \tupp{\funsp,\ressp,\impsp,\prov,\req}
%   \end{equation}
%   as follows:
%   \begin{equation}
%     \funsp = \ressp = \impsp = \posgenA,
%   \end{equation}
%   \begin{equation}
%     \prov = \req = \catid_{\posAset},
%   \end{equation}
%   where $\catid_{\posAset}$ is the identity on the set $\posAset$.

%   %   \begin{equation}
%   %   \definemap{\prov}{\impsp}{\funsp}{a}{a}
%   % \end{equation}
%   % \begin{equation}
%   %   \definemap{\req}{\impsp}{\ressp}{a}{a}
%   % \end{equation}
% \end{definition}

% \begin{lemma}
%   $\adp \fthen \funid_{\ressp} = \adp$
% \end{lemma}
% \begin{proof}
% Take
% \begin{equation}
% \adp = \tupp{\funsp,\posgenA,\impsp,\prov,\req}
% \end{equation}
% We have for the series
% \begin{equation}
%   \impsp =
%   \makeset{
%      {\imp_1} {\imp_2} \setin (\impsp \cartprod \posgenA)
%       \mid
%       \req_{1}(\imp_{1}) \posleqof{\posgenA} \prov_{2}(\imp_{2})
% }
% \end{equation}
% \end{proof}
% \devel{
%     \subsection{Feedback in DPI}

%     \todojira{194}{define here $\dploopb$.
%         Later we define $\dploop$}
% }

\section{Sum and intersection of DPIs}
\label{subsec:dpi-intersection}

\subsection{Sum of DPIs}\label{subsec:dpi-union}

The sum of two design problems with implementation is a design problem with the implementation space~$\impsp=\impsp_{1}+\impsp_{2}$, and it represents the exclusive choice between two possible alternative families of designs.

\begin{marginfigure}
    \centering
    \includesag{20_dpi_coproduct}
    \caption{}
    \label{fig:dpcoproduct}
\end{marginfigure}

\begin{definition}[Sum of DPIs]
    \label{def:parallel-1}
    Given two DPIs with same functionality and resources~$\adpa=\tupp{\funsp,\ressp,\impsp_{1},\prov_{1},\req_{1}}$ and~$\adpb=\tupp{\funsp,\ressp,\impsp_{2},\prov_{2},\req_{2}}$, define their sum as
    \begin{equation}
        \adpa\join\adpb\definedas\tupp{\funsp,\ressp,\impsp_{1}+\impsp_{2},\prov,\req} ,
    \end{equation}
    where
    \begin{equation}
        \begin{aligned}
            \prov & = \prov_1 + \prov_2, \\
            \req  & = \req_1 + \req_2.
        \end{aligned}
    \end{equation}

    %     \begin{eqnarray}
    %     \prov & \colon & \imp\mapsto\begin{cases}
    %                                     \prov_{1}(\imp), & \text{if }\imp\setin\impsp_{1}, \\
    %                                     \prov_{2}(\imp), & \text{if }\imp\setin\impsp_{2},
    %                                 \end{cases}\label{eq:dppar-exec-1} \\
    %     \req  & \colon & \imp\mapsto\begin{cases}
    %                                     \req_{1}(\imp), & \text{if }\imp\setin\impsp_{1}, \\
    %                                     \req_{2}(\imp), & \text{if }\imp\setin\impsp_{2}.
    %                                 \end{cases}\nonumber
    % \end{eqnarray}
\end{definition}

%
%\captionsideleft{\label{fig:dpcoproduct}}{
%  \includegraphics[scale=0.33]{gmcdp_coproduct}
%}

\subsection{Intersection of DPIs}
\todotext{write intro}

\begin{marginfigure}
    \centering
    \includesag{dpi_intersection}
    \caption{}
    \label{fig:intersection}
\end{marginfigure}

\begin{definition}[Intersection of DPIs]
    \label{def:intersection-1}
    Given two DPIs with same functionality and resources~$\adpa=\tupp{\funsp,\ressp,\impsp_{1},\prov_{1},\req_{1}}$ and~$\adpb=\tupp{\funsp,\ressp,\impsp_{2},\prov_{2},\req_{2}}$, define their intersection as
    \begin{equation}
        \adpa\meet\adpb\definedas\tupp{\funsp,\ressp,\impsp,\prov,\req},
    \end{equation}
    where
    \begin{equation}
        \begin{multlined}
            \impsp = \makeset{ (\maketupconcat{\imp_1, \imp_2, \fun, \res}) \setin (\makecprod{ \impsp_1, \impsp_2, \funsp, \ressp }) \mid \\
                (\fun \funleq \prov_1(\imp_1))  \booland
                (\fun \funleq \prov_2(\imp_2))  \booland \\
                (  \req_1(\imp_1) \resleq \res )  \booland
                ( \req_2(\imp_2) \resleq \res )}
        \end{multlined}
    \end{equation}
    and the maps $\prov$ and $\req$ are the projections of the third and fourth component.
\end{definition}

