% !TEX root = chapter-standalone.tex
\section{Recipes as ingredients}

We can think at a higher level, by having recipes as ingredients.

\todotextjira{733}{\alphubel: Can somebody doublecheck?}
For example, the following shows that if a dark blue stain gives you a light blue stain, and a light blue stain gives you a orange stain, you can produce a orange stain from a dark blue stain:
%
\begin{equation}
    \label{eq:colors-quoting}
    \middlesag{colors-quoting}
\end{equation}
%
Note that to activate the meta-recipe above, no windsor stain was needed.
In fact, for the above to be valid, it is not even necessary to postulate that windsor stains exist.

We can do \textbf{abstraction} by replacing some ingredients with \emph{placeholders}.
When we write a recipe with placeholders, we mean that the recipe is valid whatever is put in the placeholders, with the constraint that if two placeholders are of a similar color should hold the same thing.

For example, if a windsor stain gives me a B, and B gives me a rob roy stain, then a windsor stain gives me a rob roy stain, not matter what B is:
%
\begin{equation}
    \label{eq:colors-abstraction}
    \middlesag{colors-abstraction}
\end{equation}
%
We can abstract further by saying that: if~A gives me~B, and~B gives me~C, then~A gives me~C:
%
\begin{equation}
    \label{eq:colors-theorems}
    \middlesag{colors-theorems1}
\end{equation}

\section{Commutativity and associativity}
\label{sec:commutativity-associativity}
\todotext{\bernina: Move section to own file}
With the power of abstraction we can talk about properties of the rules themselves.

For example, we can define \emph{commutativity} as follows.
A composition operation is commutative if getting a C from A and B holds if and only if B and A also give a~C:
\begin{equation}
    \label{eq:colors-commutativity}
    \middlesag{colors-commutativity}
\end{equation}
%
For associativity, we want to say that, given three things A, B, C, composing A with B and then the result with C is the same thing as composing A with the result of B and C.
\begin{equation}
    \label{eq:colors-associativity}
    \middlesag{colors-associativity}
\end{equation}

It is easy to see that this is valid for Lego composition.
\begin{equation}
    \label{eq:colors-assoc-legoa}
    \middlesag{colors-assoc-lego_1}\quad.
\end{equation}
\begin{equation}
    \label{eq:colors-assoc-legob}
    \middlesag{colors-assoc-lego_2}\quad.
\end{equation}

\Cref{tab:color-properties} shows the properties of the 4 composition rules for composing colors that we described earlier.

\begin{table*}[p]
    \caption{Properties of color composition rules}
    \fbox{%
        \adjustbox{max width=17cm}{
            \includesag{colors-table}
        }
    }
    \label{tab:color-properties}
\end{table*}

The table also notes the presence of a \emph{neutral element} and an \emph{annihilating} element.
A \SY{neutral element}, is an element which, when composed with another element, does not change the original color.
Using the additive composition rule, for instance, this element is \emph{black}.
On the other hand, when considering the lego purists composition rule no \SY{neutral element} can be found (indeed, composing with any element will result in a color change).

\todotextjira{262}{\bernina: @Andrea: Describe annihilating better.}

%
%Example from slide 12:
%%\prflinethickness=3pt by adding this between proofs you can increase thickness, but somehow I cannot find a way to increase the middle one
%\begin{equation}
%\prftree{\prftree{\stain{staincola}}{\stainfilled}}{\prftree{\stainfilled}{\stain{staincolf}}}{\prftree{\stain{staincola}}{\stain{staincolf}}}
%\end{equation}

\section{Composing recipes}

We can also compose recipes themselves.

For example, imagine that in our analysis of Lego composition we decompose its color from the shape.
Each element is now described by a color and a shape:
%
\begin{equation}
    \label{eq:color-and-shape}
    \middlesag{color_and_shape}
\end{equation}

We can now define composition of color-shape pairs by composing the Lego-purist rule for colors with a color-neutral shape composition rule.

For example, given two pairs
%
\begin{equation}
    \label{eq:two_pairs_comma}
    \middlesag{two_pairs_comma},
\end{equation}
%
we can find what their composition is by looking at what happens when we compose the components:
%
\begin{equation}
    \label{eq:comma_pairs_composition}
    \middlesag{comma_pairs_composition}
\end{equation}
%
We can generalize this as follows:
%
\begin{equation}
    \label{eq:comma_pairs_composition_gen}
    \middlesag{comma_pairs_composition_gen}
\end{equation}

\section{Isomorphisms}

Do you know the game ``spot the 5 differences''?
In this book we are going to play the opposite game, which is ``spot how several different things are the same at some level of abstraction''.

Consider two Lego worlds in which all colors are red or all colors are white:
\begin{equation}
    \label{eq:lego_world_red}
    \middlesag{lego_world_red}
\end{equation}
%
and
%
\begin{equation}
    \label{eq:lego_world_white}
    \middlesag{lego_world_white}
\end{equation}

We could create Lego theories for each of the worlds.
Although they would describe different worlds, the theories would be \emph{isomorphic}.

If we confine ourselves with composing Lego blocks with the same section, then all it counts is the height of the stacks.
The equations above are saying~$1+1=2$:
%
\begin{equation}
    \vmiddle{\prfperiod{1}{1}{2}}
\end{equation}
%
If we are dealing with addition, then there are many other things that follow the same rules.
For example, we might look at composing two pieces of rope.
If we have a piece of rope of length~$a$ and one of length~$b$, you can tie them together to get a rope of length $a+b$:
%
\begin{equation}
    \label{eq:rope-compose}
    \middlesag{rope_composition}
\end{equation}
%
The algebra of ropes captures the algebra of bricks: the bricks are a special case because they have integer height, while ropes can be of any length.

We want to show you a rope trick.
Suppose that we want to be more precise than~\cref{eq:rope-compose} to describe the process of composing ropes, by keeping track of the extra rope that is needed to make a knot:
%
\begin{equation}
    \label{eq:knot_material}
    \middlesag{knot_material}
\end{equation}
%
One first attempt would be to call~$k$ the extra rope for the knot, and have rules like \cref{eq:rope-k1}: from~$a + k$ and~$k + b$ we obtain a piece of rope of~$a+b$:
%
\begin{equation}
    \label{eq:rope-k1}
    \middlesag{rope_knot_2}
\end{equation}

%
%
This is fine but not elegant.
If you want to compose further, you need to introduce a notion of subtraction:
%
\begin{equation}
    \label{eq:rope-k2}
    \middlesag{rope_knot_3}
\end{equation}
%
A more elegant way is the following: consider only ropes of the form~$k + a + k$, so that we can account for the rope needed for the knots at either ends:
%
\begin{equation}
    \label{eq:rope-kk}
    \middlesag{rope_knot_knot}
\end{equation}
%
Now when we compose, the 2~$k$s on the inside elide, and we are left with 2~$k$s at either end, ready to be knotted with other pieces of rope.
Notice that all ropes so created have the 2 extra~$k$s.
We can just remove them from the notation.
We obtain new rules for ropes that take into account the knots:
%
\begin{equation}
    \label{eq:rope-blue}
    \middlesag{rope_blue}
\end{equation}
%
And here's the magic trick: if we don't take into account the knot materials we have the simple rule~\cref{eq:rope-compose}; if we do take into account the knot materials, \emph{for any arbitrary length $k$}, we obtain~\cref{eq:rope-blue} which is exactly the same as~\cref{eq:rope-compose}.
\todographicsjira{524}{\bernina:There was a picture from an old rope trick magic book that was in the slides.}
\begin{exercise}
    Explain the trick: Where did the extra material go?
\end{exercise}
\begin{solution}
    Note that~\cref{eq:rope-compose} describes composition for ropes of any arbitrary size, while \cref{eq:rope-blue} describes compositions for ropes whose length can be written as $k+a+k$, hence with a minimum size of~$2k$.
    Therefore, the rope
    \begin{equation}
        \rope{ropecola}{ropecolb}{2}{0}{0}{1}{$1$}
    \end{equation}
    in the first theory describes a physical rope of length $1$, while the rope
    \begin{equation}
        \rope{blue}{blue}{2}{0}{0}{1}{1}
    \end{equation}
    in the second theory describes a rope of length $1+2k$.
    They are different theories that happen to have isomorphic rules.
    Note that the rope~$k+k$ acts just like the identity 0.
    If you connect $k + a + k$ to $k+k$, you obtain $k + a + k$, for all values of~$a$.
\end{solution}
%
%\begin{comment}
%    \devel{
%        \begin{tikzpicture}
%            \brick{4}{2}{cred}{0}{0}{0}{1}
%        \end{tikzpicture}
%        \hfill
%
%        \begin{tikzpicture}
%%\brick{3}{1}{yellow}{6}{0}{0}
%%\brick{4}{2}{blue}{2}{0}{0}
%%\brick{2}{4}{cred}{0}{0}{0}
%%\brick{2}{4}{cred}{0}{1}{1}
%            \brickcustom{4}{2}{pink}{4}{2}{0}{1}
%            \brickcustom{4}{2}{blue}{4}{0}{0}{1}
%            \brickcustom{4}{2}{green}{0}{2}{0}{1}
%            \brickcustom{4}{2}{cred}{0}{0}{0}{0.33}
%            \brickcustom{4}{2}{cwhite}{0}{0}{1}{0.33} % should be 0.33 instead of 1
%            \brickcustom{4}{2}{cred}{0}{0}{2}{0.33} % should be 0.66 instead of 2
%% 1) there is a problem with the pins
%% GZ: yes, the problem arises because being dynamic with the heights, you need to be dynamic also with the pin positions. Now ajusted sith \weight, but still not optimal
%% 2) can we make #6 absolute and not relative, so that it's x,y,z?
%% GZ: can look into it, you want 0.33 instead of 1, with the same meaning as 7 right? (0.33 * \brickheight)
%            \brickcustom{2}{4}{cwhite}{6}{0}{1}{1}
%
%%\brickcustom{2}{4}{cred}{2}{0}{0}{6mm}
%        \end{tikzpicture}
%    }
%
%    Here is one formal property of Lego: given two blocks of the same shape, you can always make a block of twice the shape.
%
%    More generally, to compose blocks in this way, you would only care about the lateral dimensions.
%    You can compose an~$a \times b \times c$ block with an ~$a \times b \times d$ block to obtain an~$a \times b \times( c + d)$ block.
%    Note that, for now,~$a$ and~$b$ are treated as labels, not as numbers.
%
%    We like to put this in formula as follows. We put the ingredients to the top, and the results at the bottom.
%
%    \begin{equation}
%        \prftree{\text{block } a \times b \times c}{\text{block } a \times b \times d }{%
%            \text{block } a \times b \times (c+d)
%        }
%    \end{equation}
%
%\paragraph{Lego with colors}
%
%If you have legos of different colors, it becomes a bit more complicated. The rule now becomes:
%\begin{center}
%  \prftree{\begin{tikzpicture} \brickcustom{4}{2}{cred}{0}{0}{0}{0.33}\end{tikzpicture}}{\begin{tikzpicture} \brickcustom{4}{2}{cwhite}{0}{0}{0}{0.33}\end{tikzpicture}}{\begin{tikzpicture} \brickcustom{4}{2}{cblue}{0}{0}{0}{0.33}\end{tikzpicture}}
%  {\begin{tikzpicture}\brickcustom{4}{2}{cred}{0}{0}{0}{0.33}
%        \brickcustom{4}{2}{cwhite}{0}{0}{1}{0.33}
%        \brickcustom{4}{2}{cblue}{0}{0}{2}{0.33}\end{tikzpicture}}
%\end{center}
%
%\paragraph{Lego operations}
%
%There are also other ways you could compose the 3 blocks. You could slightly translate them, to create stairs.
%
%todographics{lego figure here: the 3 blocks composed in different ways, by some offset}
%
%You can also rotate them before composing.
%
%todographics{lego figure here: the 3 blocks composed using rotations}
%
%What are the rules of this composition? Let's define a block as a solidly connected set of parallelipipedes (malformed cubes with different dimensions of the 3 sides). There are 3 kinds of faces: the faces pointing up, which have the pins, the faces pointing down, which have the holes for the pins, and the lateral faces.
%
%Connecting two blocks means that there should be at least one pin face of the lower block touching one hole face of the upper block; and, that there are no intersections of the solid blocks. Then, the ``interface'' of the blocks
%
%
%You can also put decorations; but if you do, you remove the possibility of connecting to all of them.
%
%todographics{lego block with some decoration on top}
%
