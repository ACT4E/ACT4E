% !TEX root = chapter-standalone.tex

\section{Data migration}

The name ``natural transformation'' has historical roots -- do not worry if the concept itself does not seem ``natural'' to you at first.
% We will try to explain it in a way that is hopefully at least clear.
To give motivation and a concrete illustration, we start with an example.

\paragraph{An alumni database}

Suppose a university is keeping a database of its alumni.
The database contains a list of all the students that ever attended the university (each of them has a unique student ID number), as well as for example information about students' names, discipline of study, date of graduation, \etc

We have seen that an instance of a database can be modeled as a \SY{functor} whose target is the category of sets, and whose source is a category encoding the abstract architecture of the database.
\todotext{Seen where? link}

%
\begin{marginfigure}
    \centering
    \includesag{student_database_schema}
    \caption{The schema of an alumni database.}
    \label{fig:student_database_schema}
\end{marginfigure}
%

The architecture of the database in our example might be encoded by a category with four objects and three non-identity morphisms, as depicted in \cref{fig:student_database_schema}.
The object~$\styleobj{S}$ stands for \emph{Student},~$\styleobj{D}$ stands for \emph{Discipline},~$\styleobj{N}$ stands for \emph{Name}, and~$\styleobj{Y}$ stands for \emph{Year}.
Call this category~\CatC.
A database instance~$\funa \colon \CatC \fto \Set$ entails specifying a set~$\funa(\styleobj{S})$ of all student IDs, a set~$\funa(\styleobj{D})$ of university disciplines such as mechanical engineering, civil engineering, applied mathematics, pure mathematics, \etc
It also entails defining functions for each of the arrows in~\CatC.
For example,~$\funa(\stylemorph{\text{studied}}) \colon \funa(\styleobj{S}) \mto \funa(\styleobj{D})$ is the function that assigns to each student ID the name of the discipline that that student studied.

\paragraph{Updating the database}

For simplicity, we focus on two aspects of the data: student ID numbers and the disciplines of study.
We assume that the university updates its alumni database once a year.
This means, for example, adding the graduates of that year to the total list of graduates.

To model the situation, let~$\funa \colon \CatC \fto \Set$ be the database instance for the year 2021, and let~$\funb \colon \CatC \fto \Set$ be the database instance for the year 2022.
For concreteness, suppose the student IDs are in some standardized format, for example a code of the kind 17-371-802, where each of the three parts of the code are calculated/assigned by some rule (\text{e.g.}, the ``17'' here stands for 2017, the year the student registered with the university, \etc)
.

Since new students register to the university each year, the set~$\funa(\styleobj{S})$ of all student IDs registered up to the end of 2020 is a subset of the set~$\funb(\styleobj{S})$ of student IDs up to the end of 2022.
This means there is an inclusion function~$\ntrafoa_{\styleobj{S}} \colon \funa(\styleobj{S}) \mto \funb(\styleobj{S})$.

Now suppose that in 2022 the university decides to simplify the way it attributes disciplines to students in the database.

For instance, instead of the discipline names~$\funa(\styleobj{D}) = \makeset{ \text{mechanical engineering}, \text{civil}\ \text{engineering}, \text{applied}\ \text{physics}, \text{theoretical}\ \text{physics}, \text{pure}\ \text{math}, \linebreak[1]\text{applied}\ \text{math} }$, the new discipline names are just
%
\begin{equation}
    \funb(\styleobj{D}) = \makeset{ \text{engineering}, \text{physics}, \text{math} }.
\end{equation}
%
In order to implement these changes, we use a function~$\ntrafoa_{\styleobj{D}}\colon \funa(\styleobj{D}) \mto \funb(\styleobj{D})$ which maps the old discipline names to the corresponding new ones in an obvious way:
\begin{equation}
    \ntrafoa_{\styleobj{D}}(\text{civil engineering}) = \text{engineering}, \ \ntrafoa_{\styleobj{D}}(\text{applied physics}) = \text{physics}, \ \text{etc.}
\end{equation}
\todographics{\bernina: Would be nice to draw this function as a diagram (like we did in the chapter about sets)}
The functions~$\ntrafoa_\styleobj{S}$ and~$\ntrafoa_\styleobj{D}$ allow us to check whether the new database instance~$\funb$ relates coherently with the older database instance~$\funa$.
Concretely, we want that if a student ID in~$\funb(\styleobj{S})$ is inherited from~$\funa(\styleobj{S})$ -- in other words, if it is in the image of~$\ntrafoa_{\styleobj{S}}$ -- then we want that its associated discipline in the database instance~$\funb$ is the same as if we first computed the student's discipline in the older database instance~$\funa$, and then mapped it to~$\funb$ using the function~$\ntrafoa_{\styleobj{D}}$.

%
\begin{marginfigure}
    \centering
    \includesag{student_database_square}
    \caption{}
    \label{fig:student_database_square}
\end{marginfigure}
%

This can be formulated succinctly by saying that we want the diagram in figure \cref{fig:student_database_square} to commute.

What we have defined is a collection of morphisms: for each object $\Obja$ in~$\CatC$, we have a morphism~$\ntrafoa_\Obja \colon \funa(\Obja) \mto \funb(\Obja)$ that obeys the commutativity property corresponding to the diagram.
Such transformations appear in many places and are formalized by the notion of \SY{natural transformations}.

\section{Natural transformations}
\linkvideo{spring2021-nat-trafos:diagrams} % Diagrams
%\linkvideo{spring2021-nat-trafos:natural-trafos} % Natural transformations

To define \SY{natural transformations}, the general situation we will start from is when we have two \SY{functors}~$\funa \colon \CatC \fto \CatD$ and~$\funb \colon \CatC \fto \CatD$, sharing the same source and target, respectively.
In the previous example above,~$\funa$ and~$\funb$ were database instances.

A \SY{natural transformation} from~$\funa$ to~$\funb$ is then a kind of ``map'' that relates the two \SY{functors}.
How might one define such a thing?

First, let's look at the situation only on the level of objects.
Each object~$\Obja$ of~\CatC is mapped by~$\funa$ and~$\funb$ to an object~$\funa(\Obja)$ and~$\funb(\Obja)$ of~\CatD, respectively.
One straightforward way to relate~$\funa(\Obja)$ to~$\funb(\Obja)$ is to choose a morphism~$\funa(\Obja) \mto \funb(\Obja)$ in~\CatD.
We call this morphism~$\ntrafoa_{\Obja}$, using the subscript~$\Obja$ since~$\ntrafoa_{\Obja}$ relates the respective images of the object~$\Obja$ under~$\funa$ and~$\funb$.
If we choose such a morphism for each object in~\CatC, then we have collection~$\makeset{ \ntrafoa_\Obja }_{\Obja \setin \ObC}$ of morphisms in~\CatD, indexed by the objects of~\CatC.

\begin{marginfigure}
    \hfill
    \includesag{diagram_two_functors}
    % \caption{}
    % \label{fig:diagram_two_functors}
\end{marginfigure}

Next, consider a morphism~$\mora \colon \Obja \mto \Objb$ in the category~\CatC.
Under the \SY{functor}~$\funa$ it will be mapped to some morphism~$\funa(\mora)\colon \funa(\Obja) \mto \funb(\Objb)$ in~\CatD, and under the \SY{functor}~$\funb$ it will be mapped to some other morphism~$\funb(\mora)\colon \funb(\Obja) \mto \funb(\Objb)$, also in~\CatD.

\vspace{5mm}
% \equationsag{diagram_two_functors}{eq:diagram_two_functors}
% %
% \begin{figure}[h!]
%     \centering
%     \includesag{}
%     \caption{}
%     \label{fig:two-functors-diagram}
% \end{figure}
% %
\begin{marginfigure}
    \hfill
    \includesag{diagram_two_functors_conn}
    % \caption{}
    % \label{fig:two-functors-connected-diagram}
\end{marginfigure}

We can think of~$\funa(\mora)\colon \funa(\Obja) \mto \funb(\Objb)$ and~$\funb(\mora)\colon \funb(\Obja) \mto \funb(\Objb)$ as each being very small diagrams (directed graphs) in~\CatD.
If we have already chosen morphisms~$\ntrafoa_\Obja\colon \funa(\Obja) \mto \funb(\Obja)$ and~$\ntrafoa_\Objb\colon \funa(\Objb) \mto \funb(\Objb)$ in~\CatD, then these will connect the two diagrams, as depicted in the figure to the side.
% \equationsag{diagram_two_functors_conn}{eq:two-functors-connected-diagram}
% \begin{figure}[h!]
%     \centering
%     \includesag{diagram_two_functors_conn}
%     \caption{}
%     \label{fig:two-functors-connected-diagram}
% \end{figure}
%

\vspace{7mm}

%
\begin{marginfigure}
    \hfill
    \includesag{naturality_square}
    \caption{}
    \label{fig:naturality-square}
\end{marginfigure}

In~\CatD, this gives rise to the square diagram shown to the side.
We'll require, as a condition on the morphisms~$\ntrafoa_\Obja$ and~$\ntrafoa_\Objb$, that they make the diagram commutative:
\begin{equation}
    \funa(\mora) \mthen \ntrafoa_\Objb = \ntrafoa_\Obja \mthen \funb(\mora).
\end{equation}

\vspace{7mm}

% \todojira{630}{\alphubel: @JL: ideally say more here to motivate or explain this.
%     Perhaps include somewhere this perspective: Natural transformations are meant to capture the idea that a transformation is natural in the sense of not depending on any arbitrary choices.
%     If a transformation does depend on arbitrary choices, the arrows alpha X and alpha Y would not be reusable but would have to change when f changes.
% }

%

Now consider not only a single morphism~$\mora \colon \Obja \mto \Objb$ in~\CatC being mapped by~$\funa$ and~$\funb$, respectively, but \emph{all} of the category~\CatC.
Under~$\funa$, the category~\CatC is mapped to a -- possibly very complicated -- diagram in~\CatD (a directed graph of objects and morphism comprising the image of~$\funa$), and similarly, under~$\funb$, the category~\CatC is mapped to another diagram in~\CatD (the image of~$\funb$).

To relate the image of~$\funa$ to the image of~$\funb$ we can proceed in the same way as above: for each object~$\Obja$ in~\CatC, we choose a morphism~$\ntrafoa_\Obja \colon \funa(\Obja) \mto \funb(\Obja)$ in~\CatD.
In other words, we have a collection of morphisms~$(\ntrafoa_\Obja)$, ${\Obja \setin \ObC}$ indexed by the objects of~\CatC.
These gives rise to lots of squares of the kind in \cref{fig:naturality-square}, which we will require to be commutative.
It is because of this commutativity condition, which is a condition on the collection~$(\ntrafoa_\Obja)$, ${\Obja \setin \ObC}$, that some mathematicians would say that the collection~$(\ntrafoa_\Obja)$, ${\Obja \setin \ObC}$ is a ``coherent'' or ``natural'' way to relate the image of~$\funa$ to the image of~$\funb$.
(This does not mean, however, that there is at most one \SY{natural transformation} between any two given \SY{functors}---on the contrary, there might be many!)

\begin{marginfigure}
    \centering
    \includesag{two_naturality_squares}
    \caption{}
    \label{fig:two-naturality-squares}
\end{marginfigure}

In \cref{fig:two-naturality-squares} we have illustrated a situation involving three objects and two morphisms in~\CatC, giving rise to two squares.
We have ``glued'' the two squares together since they share an edge (this a more compact way of drawing them).
Note that because each of the two component squares in the diagram commute, so does the entire diagram.

%
%

\clearpage

\linkvideo{spring2021-nat-trafos:natural-trafos:nat-trafo-def} % Definition of natural transformation
\linkvideo{spring2021-nat-trafos:natural-trafos:nattrafos-as-mor} % Natural transformations are morphisms between functors

\begin{ctdefinition}[Natural transformation]
    \label{def:natural-transformation}
    Let \CatC and \CatD be categories, and let~$\funa,\funb\colon \CatC\fto \CatD$ be \SY{functors}.
    A \maindef{natural transformation}~$\ntrafoa \colon \funa \nto \funb$ is specified by:

    \constit
    \begin{enumerate}
        \item For each object~$\Obja\setin \ObC$, a morphism $\ntrafoa_\Obja \colon \funa(\Obja)\mto \funb(\Obja)$ in \CatD, called the $\Obja$\emph{-component} of $\ntrafoa$.
    \end{enumerate}
    \condit
    \begin{enumerate}
        \item For every morphism~$\mora\colon \Obja\mto \Objb$ in \CatC, the components of $\ntrafoa$ must satisfy the \emph{naturality condition}
              \begin{equation}
                  \funa(\mora)\mthen \ntrafoa_\Objb = \ntrafoa_\Obja\mthen \funb(\mora).
              \end{equation}
              In other words, the following diagram must commute:
              \begin{equation}
                  \label{eq:def-naturality-square}
                  \middlesag{55_natural_2}
              \end{equation}
    \end{enumerate}
\end{ctdefinition}

To reiterate: a \SY{natural transformation} $\ntrafoa$ is a \emph{collection} $(\ntrafoa_\Obja)_{\Obja \setin \ObC}$ of morphisms (called the \emph{components} of the natural transformation) which satisfy the naturality conditions. The name ``components'' is analogous to how a vector $v = (v_1, .
    .., v_n)$ has \emph{components} or a sequence $a = (a_n)_{n \setin \natnumbers}$ has \emph{terms}. 

The diagrams \cref{eq:def-naturality-square} are often called \emph{naturality squares}, and a \SY{natural transformation}~$\ntrafoa \colon \funa\nto \funb$ is often depicted concisely in this manner:
\equationsag{55_natural_1}{eq:55_natural_1}

\Cref{fig:nat_trans_graphically} shows a diagram that describes the property of functors and of natural transformations.
The diagram in $\CatD$ is a ``commuting prism'': all faces of the prism commute.

\begin{figure}[h]
    \centering
    \begin{ctdefinitionshade}
        \small
        \includesag{096_natural_graphically}
    \end{ctdefinitionshade}
    \caption{}
    \label{fig:nat_trans_graphically}
\end{figure}


\begin{example}
    Consider the \SY{powerset} \SY{functor} from \cref{ex:powerset_functor}, and denote it~$\funa$.
    As a reminder, the \SY{functor} maps a set $\setA$ to its \SY{powerset}, and a function $\mora \colon \setA \mto \setB$ to the map which sends each subset of $\setA$ to its image under $\mora$.
    We now look at a \SY{natural transformation}~$\ntrafoa\colon \funid_\Set \nto \funa$, specified by
    \begin{equation}
        \begin{aligned}
            \ntrafoa_\setA\colon \funid_\Set(\setA) & \mto \funa(\setA) \\
            \setA                                   & \mto \powerset(\setA) \\
            \setAel                                 & \mapsto \makeset{\setAel}.
        \end{aligned}
    \end{equation}
    In other words, the \SY{natural transformation} embeds each element of~\setA into the power set~$\powerset(\setA)$.
    To check that this is a valid \SY{natural transformation}, consider $\mora\colon \setA\mto \setB$.
    We have
    \begin{equation}
        \begin{aligned}
            (\ntrafoa_\setA \mthen \funa(\mora))(\setAel)
             & =\makeset{\setAel} \mthen \funa(\mora) \\
             & =\makeset{\mora(\setAel)} \\
             & =\mora(\setAel)\mthen \ntrafoa_\setB \\
             & =(\mora \mthen \ntrafoa_\setB)(\setAel).
        \end{aligned}
    \end{equation}
\end{example}

\section{Natural isomorphisms}

\begin{ctdefinition}[Natural isomorphism]
    \label{def:natural-isomorphism}
    A \SY{natural transformation}~$\ntrafoa \colon \funa \nto \funb $ is called a \maindef{natural isomorphism} if each component morphism ~$\ntrafoa_\Obja$ in \CatD is an isomorphism.
\end{ctdefinition}
\todotextjira{473}{\alphubel: @JL: seems like a lot of things are missing here.}
\clearpage

\section{More examples}
\linkvideo{spring2021-nat-trafos:natural-trafos:double-dual} % Double dual

\todojira{631}{\alphubel: @JL: write up example here involving monoid actions / state machines}

\todojira{632}{\alphubel: @JL: write up example here about natural transformations between monotone maps}

\begin{example}
    \label{ex:Vect}
    Consider the category~$\VectR$ whose objects are real \SY{vector spaces} and whose morphisms are linear maps.
    (For convenience, in the following we sometimes omit reference to the ground field.)
    Recall that the \emph{dual} of a \SY{vector space}~$V$ is the \SY{vector space} describing all linear maps from~$V$ to~\reals:
    \begin{equation}
        \label{eq:dual-vector-space}
        V^* \definedas \HomSet{\VectR}{V}{\reals},
    \end{equation}
    Also, recall that if~$\mapa\colon V \mto W$ is a linear map, then its dual is a linear map~$\mapa^* \linebreak[1] \colon W^* \mto V^*$.

    Applying the above duality construction twice to a \SY{vector space} or a linear map gives their double dual.
    It turns out that this is a functorial operation.
    That is, there is a functor
    \begin{equation}
        \label{eq:double-dual-functor}
        \text{\stylefunctors{Double dual}}\colon \VectRs \fto \Vect
    \end{equation}
    that maps every \SY{vector space} and every linear map to its double dual.

    Furthermore, for any \SY{vector space}~$V$, there is a ``canonical'' or ``natural'' map
    \begin{equation}
        \ntrafoa_V \colon V \nto V^{**}
    \end{equation}
    defined by
    \begin{equation}
        \label{eq:natural-trafo-to-double-dual}
        \ntrafoa_V(v)(l) = l(v), \quad v \setin V, l \setin V^*.
    \end{equation}
    These form the components of a \SY{natural transformation} from the \SY{identity functor} on $\VectRs$ to the double dual \SY{functor}.
    \equationsag{nat-trafo-ddual}{eq:nat-trafo-ddual}

\end{example}


\vfill

\begin{marginfigure}
    \centering
    \includesag{graph-cat}
    \caption{}
    \label{fig:graph-cat-again}
\end{marginfigure}


\begin{gradedexercise}[\exname{NatTrafosGraphs}]
    \label{ex:NatTrafosGraphs}
    \todotext{Fix symbols}
    This exercise builds on \cref{ex:GraphsViaFunctors}.
    There, we defined a category~$\CatSymbol{G}$ which has precisely two objects and four morphisms, see \cref{fig:graph-cat-again} (the two \SY{identity morphisms} are not drawn).
    The task there was to understand how specifying a \SY{functor} from this category $G$ into the category of sets is ``the same thing'' as specifying a directed graph.

    Now consider two \SY{functors}~$\funaA, \funaB \colon \CatSymbol{G} \fto \Set$.
    Spell out what it means to have a \SY{natural transformation}~$\ntrafoa\colon \funaA \nto \funaB$.
    What does this correspond to in the language of directed graphs?
\end{gradedexercise}

\solutionof{NatTrafosGraphs}

\begin{gradedexercise}[\exname{UpperSetsNatTrafos}]
    \label{ex:UpperSetsNatTrafos}
    This exercise builds on \cref{ex:UpperSetsViaFunctors}.
    There we fixed a poset~\posA, viewed it as a category~$\CatSymbol{P}$, and saw that \SY{functors}~$\CatSymbol{P} \fto \Bool$ encode \SY{upper sets} in~\posA.
    Suppose we have two \SY{functors}~$\funaA, \funaB \colon \CatSymbol{P} \fto \Bool$.
    What does a \SY{natural transformation}~$\ntrafoa \colon \funaA \nto \funaB$ correspond to in terms of the \SY{upper sets} encoded by~$\funaA$ and~$\funaB$, respectively?
\end{gradedexercise}

\solutionof{UpperSetsNatTrafos}

\devel{

    \section{Horizontal composition}

    \todojira{638}{\bernina: @JL: write this up}

    \section{To add}
    \todojira{141}{\bernina: @JL: Add parts corresponding to listed videos.
    }
    \linkvideo{spring2021-nat-trafos:natural-trafos:horizontal-composition} % Horizontal composition
    \linkvideo{spring2021-nat-trafos:natural-trafos:interchange-law} % Interchange law
    \linkvideo{spring2021-nat-trafos:natural-trafos:rel-mon-maps} % Relating monotone maps
    \linkvideo{spring2021-nat-trafos:natural-trafos:eq-maps-gr-actions} % Equivariant maps between group actions
}

\showslides{
    \begin{forslides}
        \begin{equation}
            \label{eq:ex_nt_1}
            \ntrafoa \colon \funid_\Set \nto \funa
        \end{equation}
        \begin{equation}
            \label{eq:ex_nt_2}
            \begin{aligned}
                \ntrafoa_\setA \colon \funid_\Set(\setA) & \mto \funa(\setA) \\
                \setAel                                  & \mapsto \makeset{\setAel}
            \end{aligned}
        \end{equation}
    \end{forslides}
}
