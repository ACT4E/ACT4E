% !TEX root = chapter-standalone.tex

\section{Currency categories}
\label{sec:currency_cat}
In this section, we introduce a kind of category for describing currency exchangers.
Our idea is to model currencies as objects of a category, and morphisms will describe ways of exchanging between those currencies.
As an example, currency exchangers offer this service.

We start with a set~\setC of labels for all the currencies we wish to consider:
\begin{equation}
    \setC = \makeset{ \EUR, \USD, \CHF, \SGD, \dots }.
\end{equation}

\showslides{
    \begin{forslides}
        \begin{equation}
            \label{eq:40_currency_blocks}
            \includesag{40_currency_blocks}
        \end{equation}
        \begin{equation}
            \label{eq:40_currency_comp}
            \includesag{40_currency_comp}
        \end{equation}
        \begin{equation}
            \label{eq:40_currency_comp_2}
            \includesag{40_currency_comp_2}
        \end{equation}
    \end{forslides}
}

Now consider two currencies, say~$\USD$ and~$\EUR$.
How can we describe the process of changing an amount of \USD to an amount of \EUR?
We model this using two numbers: an exchange rate~$a$ and a commission~$d$ for the transaction.
A morphism from one currency to another is given by this pair of numbers~$\tup{a,b}$.
Now, for each morphism, there is a function which takes an amount of the source currency and transforms it into an amount of the target currency.
Given an amount~$x \setin \reals$ of \USD, this function is:
\begin{equation}
    \label{eq:def_curr_ex}
    \defmapperiodset{\mapa_{\tup{a,d}}}{\reals}{\reals}{x}{ax-d}
\end{equation}
Note that the commission~$d$ is to be intended in the target currency.
Of course, for changing \USD to \EUR, there may be various different banks or agencies which each offer different exchange rates and/or different commissions.
Each of these corresponds to a different morphism from~$\USD$ to~$\EUR$.

To build our category, we also need to specify how currency exchangers compose.
Given currencies~$\Obja, \Objb, \Objc$, and given currency exchangers~$\tup{a,d}$ from~$\Obja$ to~$\Objb$ and~$\tup{b,e}$ from~$\Objb$ to~$\Objc$,
we define the composition~$\tup{a,d} \mthen \tup{b,e}$ to be the currency exchanger from~$\Obja$ to~$\Objc$ given by the pair of numbers
\begin{equation}
    \label{eq:comp-law-curr}
    \tup{ab, bd+e}.
\end{equation}
In other words, we compose currency exchangers as one would expect: we multiply the first and the second exchange rates together, and we add the commissions (paying attention to first transform the first commission into the units of the final target currency).

Finally, we also need to specify \SY{identity morphisms} for our category.
These are currency exchangers which ``do nothing''.
For any object~$\Obja$, its \SY{identity morphism} is
\begin{equation}
    \tup{1,0},
\end{equation}
the currency exchanger from~$\Obja$ to~$\Obja$ with exchange rate ``1'' and commission ``0''.

We now want to check that the composition of currency exchangers as defined above obeys unitality and associativity.

Given~$\tup{1,0}$ from~$\Obja$ to~$\Obja$,~$\tup{1,0}$ from~$\Objb$ to~$\Objb$, and~$\tup{a,d}$ from~$\Obja$ to~$\Objb$ we have:
\begin{equation}
    \begin{aligned}
        \tup{1,0}\mthen\tup{a,d} & =\tup{1\cdot a, a\cdot 0+d} \\
                                 & =\tup{a,d},
    \end{aligned}
\end{equation}
and
\begin{equation}
    \begin{aligned}
        \tup{a,d}\mthen \tup{1,0} & =\tup{a\cdot 1, 1\cdot d+0} \\
                                  & =\tup{a,d},
    \end{aligned}
\end{equation}
This is unitality.
Furthermore, given~$\tup{b,e}$ from~$\Objb$ to~$\Objc$, and~$\tup{c,f}$ from~$\Objc$ to~$\Objd$ we have:
\begin{equation}
    \begin{aligned}
        \left( \tup{a,d}\mthen \tup{b,e}\right)\mthen \tup{c,f} & =\tup{ab,bd+e}\mthen \tup{c,f} \\
                                                                & =\tup{abc,c(bd+e)+f} \\
                                                                & =\tup{a,d}\mthen \tup{bc,ce+f} \\
                                                                & =\tup{a,d}\mthen \left( \tup{b,e}\mthen \tup{c,f}\right).
    \end{aligned}
\end{equation}
This is associativity.
Thus, we indeed have a category.

We can formally define the category of currencies \Curr.

\begin{definition}[Category \Curr]
    \label{def:Curr}
    The \maindef{category of currencies} \Curr is specified by:
    \begin{enumerate}
        \item \emph{Objects:} a collection of currencies.
        \item \emph{Morphisms:} given two currencies~$\Obja, \Objb$, morphisms between them are currency exchangers~$\tup{a,d}$ from~$\Obja$ to~$\Objb$.
        \item \emph{Identity morphism:} given a currency~$\Obja$, its \SY{identity morphism} is the currency exchanger~$\tup{1,0}$.
              We also call such morphisms ``trivial currency exchangers''.
        \item \emph{Composition of morphisms:} the composition of morphisms is given by the formula \cref{eq:comp-law-curr}, describing a composed currency exchanger.
    \end{enumerate}
\end{definition}

As an illustration, consider three currency exchange companies ExchATM, MoneyLah, and Frankurrencies, which operate on several currencies (\cref{tab:currencycompanies}).

\begin{table*}[h]
    \centering
    \begin{tabular}{c|c|c|c|c}
        \textbf{Company name} & \textbf{Exchanger label}      & \textbf{Direction} & \textbf{Exchange rate} $a$
                              & \textbf{Fixed commission} $b$ \\
        \hline
        ExchATM               & $\transmuter{A}$              & \USD $\mto$ \CHF   & 0.95 (in \unitfrac[]{\chf}{\usd}) & 2.0 (in \unit[]{\chf}) \\
        ExchATM               & $\transmuter{B}$              & \CHF $\mto$ \USD   & 1.05 (in \unitfrac[]{\usd}{\chf}) & 1.5 (in \unit[]{\usd}) \\
        ExchATM               & $\transmuter{C}$              & \USD $\mto$ \SGD   & 1.40 (in \unitfrac[]{\sgd}{\usd}) & 1.0 (in \unit[]{\sgd}) \\
        MoneyLah              & $\transmuter{D}$              & \USD $\mto$ \CHF   & 1.00 (in \unitfrac[]{\chf}{\usd}) & 1.0 (in \unit[]{\chf}) \\
        MoneyLah              & $\transmuter{E}$              & \SGD $\mto$ \USD   & 0.72 (in \unitfrac[]{\usd}{\sgd}) & 3.0 (in \unit[]{\usd}) \\
        Frankurrencies        & $\transmuter{F}$              & \EUR $\mto$ \CHF   & 1.20 (in \unitfrac[]{\chf}{\eur}) & 0.0 (in \unit[]{\chf}) \\
        Frankurrencies        & $\transmuter{G}$              & \CHF $\mto$ \EUR   & 1.00 (in \unitfrac[]{\eur}{\chf}) & 1.0 (in \unit[]{\eur})
    \end{tabular}
    \caption{Three currency exchange companies operating different currencies.
    }
    \label{tab:currencycompanies}
\end{table*}
We can represent this information as a graph, where the nodes are the currencies and the edges are particular exchange operations (\cref{fig:currencygraph}).

\begin{figure}[h]
    \centering
    \includesag{30_currencygraph}
    \caption{Three currency exchange companies operating different currencies as a graph. }
    \label{fig:currencygraph}
\end{figure}

There is a currency category built from the information in \cref{tab:currencycompanies} and the graph in \cref{fig:currencygraph}.
Its collection of objects is the set~$\makeset{\EUR, \USD, \CHF, \SGD}$, and its morphisms are, in total:
\begin{itemize}
    \item the trivial currency exchanger (identity morphism)~$\disunionA{0}$ for each of the four currencies (which are the objects),
    \item the currency exchangers corresponding to each item in \cref{tab:currencycompanies},
    \item all possible compositions of the currency exchangers listed in \cref{tab:currencycompanies}.
\end{itemize}

The phrase ``all possible compositions'' is a bit vague.
What we mean here can be made more precise.
It corresponds to a general recipe for starting with a graph~$G$, such as in \cref{fig:currencygraph}, and obtaining from it an associated category, called the \emph{free category on}~$G$.

\iflabelexists{sec:catsfromgraphs}{We introduce this concept in \cref{sec:catsfromgraphs}.}

\begin{exercise}[\exname{Temperatures}]
    \label{ex:temperatures}
    Define a category of temperature converters, where the objects are \transmuted{Celsius}, \transmuted{Kelvin}, \transmuted{Fahrenheit}, and the morphisms are the rules to transform a measurement from one unit to another.

    Prove that this forms a category.
\end{exercise}
\begin{solution}
    The concept of this exercise is very similar to the one of \Curr.
    In general, we can write a temperature converter (morphism) from \transmuted{e} to \transmuted{f} as a pair of numbers~$\tup{a,d}$,~$a,d\setin \reals$.
    For each morphism we have a map which actually transform an amount of the first temperature into an amount of the second temperature:
    \begin{equation}
        \begin{aligned}
            \mapa_{\tup{a,d}}\colon \reals & \sto \reals \\
            x                              & \mapsto ax+d.
        \end{aligned}
    \end{equation}
    Now, all the possible conversions between the three temperature conventions feature specific values for~$a,d$, listed in \cref{tab:temperature_conversions} (rows are to be intended as the source, and columns as the target convention).

    \begin{table*}[tbh]
        \begin{tabular}{llll}
                                    & \transmuted{Celsius}     & \transmuted{Kelvin}      & \transmuted{Fahrenheit} \\
            \transmuted{Celsius}    & $a=1$, $d=0$             & $a=1$, $d=273$           & $a=9/5$, $d=32$ \\
            \transmuted{Kelvin}     & $a=1$, $d=-273$          & $a=1$, $d=0$             & $a=9/5$, $d=-459.4$ \\
            \transmuted{Fahrenheit} & $a=5/9$, $d=-17.\bar{7}$ & $a=5/9$, $d=255.\bar{2}$ & $a=1$, $d=0$
        \end{tabular}
        \caption{Temperature conversion factors. \label{tab:temperature_conversions}}
    \end{table*}
    We now define the category \Temp as being constituted of:
    \begin{itemize}
        \item \emph{Objects:}~$\Obof\Temp=\makeset{\transmuted{Celsius}, \transmuted{Kelvin}, \transmuted{Fahrenheit}}$;
        \item \emph{Morphisms:} There is a single morphism from \transmuted{e} to \transmuted{f} for any~$\transmuted{e},\transmuted{f}\setin \Obof\Temp$, given by~$\tup{a,d}$, with~$a,d$ as in \cref{tab:temperature_conversions};
        \item \emph{Composition of morphisms}: Analogous to the one in \Curr;
        \item \emph{Identity morphisms}: Analogous to the ones in \Curr.
    \end{itemize}
    This indeed forms a category, as we have shown for \Curr.
\end{solution}

%The graph representation seems enough to describe this as a category, where the objects are the currencies (USD,CHF,EUR, and SGD), the morphisms are the different exchange operations, and the identity morphisms are identity currency exchangers. However, to properly define this category, we need to define composition and prove that the category is closed with respect to it, \ie  that the composition of two currency exchangers is a currency exchanger in the category. Given three currencies $\mathsf{X,Y,Z}$, a currency exchanger $\tup{a,b}$ from $\mathsf{X}$ to $\mathsf{Y}$, and a currency exchanger $\tup{c,d}$ from $\mathsf{Y}$ to $\mathsf{Z}$, one can define their composition as
%\begin{equation}
%\begin{aligned}
%\label{eq:currencycomp}
%    \tup{a,b}\mthen \tup{c,d}&=\tup{c\cdot a,c\cdot b+d}
%\end{aligned}
%\end{equation}
%Note that the result of the composition of currency exchangers is a currency exchanger: Thus, currency exchangers are closed under the composition operation we have defined. Finally, we need to check \emph{unitality} and \emph{associativity} for composition. Given a currency exchanger $\tup{a,b}$ from $\mathsf{X}$ to $\mathsf{Y}$ we have
%\begin{equation}
%    \begin{aligned}
%    \tup{1,0}\mthen \tup{a,b}&=\tup{a,b}\mthen \tup{1,0}\\
%    &=\tup{a,b},
%    \end{aligned}
%\end{equation}
%which is unitality. Furthermore, given a currency exchanger $\tup{c,d}$ from $\mathsf{Y}$ to $\mathsf{Z}$ and a currency exchanger $\tup{e,f}$ from $\mathsf{Z}$ to $\mathsf{W}$, we have
%\begin{equation}
%    \begin{aligned}
%    (\tup{a,b}\mthen \tup{c,d})\mthen \tup{e,f}&=\tup{a,b}\mthen( \tup{c,d}\mthen \tup{e,f})\\
%    &=\tup{eca, ecb+ed+f},
%    \end{aligned}
%\end{equation}
%which is associativity.
%We are now ready to properly define the category of currency exchangers $\mathbf{Curr}$.
%
%\begin{definition}[Category of currencies]
%    The \emph{category of currencies} $\mathbf{Curr}$ is specified by:
%    \begin{enumerate}
%        \item \emph{Objects:} $\Ob_\mathbf{Curr}$ is a collection of currencies.
%        \item \emph{Morphisms:} Given two currencies $\mathsf{C},\mathsf{D}\setin \Ob_{\mathbf{Curr}}$, morphisms between them are currency exchangers $\tup{a,b}$ from $\mathsf{C}$ to $\mathsf{D}$.
%        \item \emph{Identity morphism:} Given an object $C\setin \Ob_\mathbf{Curr}$, the identity morphism is given by the currency exchanger $\tup{1,0}$.
%        \item \emph{Composition of morphisms:} The composition of morphisms is given by composition of currency exchangers.
%    \end{enumerate}
%\end{definition}

% \JL{The following paragraph(s) might be best moved to a later part in the text, once pareto fronts and optimization have been discussed a little bit.}

