% !TEX root = chapter-standalone.tex

\section{Profunctors}

\todostructurejira{267}{Re-organize the videoes here - join them to make 1-2 total videos.}

\linkvideo{spring2021-profunctors:recap-design} % Recap of design problems
\linkvideo{spring2021-profunctors:gen-bool} % Generalizing boolean profunctors

\showslides{
    \begin{forslides}
        \begin{ctdefinition}[$\DP$]
            \label{def:dp-again}
            Given two posets~$\funsp$ and~$\ressp$, a \emph{design problem} with functionality $\funsp$ and resources~$\ressp$ is a monotone function of the form
            \begin{equation}
                \label{eq:dp-again-1}
                \adp \colon \funsp\op \Ctimes \ressp \fto_{\Pos} \Bool.
            \end{equation}
            This is also written as
            \begin{equation}
                \label{eq:dp-again-2}
                \adp\colon \funsp \profto \ressp.
            \end{equation}
        \end{ctdefinition}

        \begin{equation}
            \label{eq:dp-again-3}
            \tupp{\fun^{\op}, \res} \quad \mapsto \quad \exists \imp \in \impsp :  (\fun \funleq \prov(\imp)) \booland (\req(\imp) \resleq \res)
        \end{equation}
        %
        \begin{equation}
            \label{eq:dp-again-set}
            \tupp{\fun^{\op}, \res} \quad \mapsto \quad \{ \imp \in \impsp :  (\fun \funleq \prov(\imp)) \booland (\req(\imp) \resleq \res) \}
        \end{equation}
        %
        \begin{equation}
            \label{eq:dp-again-prof}
            \adp \colon \funsp\op \Ctimes \ressp \fto_{\Pos} \powerset \impsp
        \end{equation}
        %
        \begin{equation}
            \label{eq:profunctors-rela}
            \relA \colon \setA \cartprod  \setB \to \Bool.
        \end{equation}
    \end{forslides}
}

We recall the definition of boolean profunctors:

\begin{ctdefinition}[Boolean profunctors]
    \label{def:boolean-profunctor-again}
    Given two posets~$\posgenA$ and~$\posgenB$, a \emph{boolean profunctor} from~$\posgenA$ to~$\posgenB$ is a monotone function of the form
    \begin{equation}
        \label{eq:boolean-profunctor-funa}
        \funa\colon \posgenA\op \Ctimes \posgenB \fto_{\Pos} \Bool.
    \end{equation}
    This is also written as
    \begin{equation}
        \funa\colon \posgenA \profto \posgenB.
    \end{equation}
\end{ctdefinition}
\linkvideo{spring2021-profunctors:bool-prof-gen-rel} % Boolean profunctors as generalization of relations

We are going to extend this to general profunctors:
\begin{compactitem}
    \item Instead of posets, we will have arbitrary categories.
    \item Instead of \Bool, we will have \Set.
    \item Instead of monotone functions, we will have functors.
\end{compactitem}

\linkvideo{spring2021-profunctors:profunctors} % Profunctors as generalization of boolean profunctors
\begin{ctdefinition}[Profunctors]
    \label{def:profunctor}
    Given two categories \CatC and \CatD, a \emph{\iindex{profunctor}} from \CatC to \CatD is a functor of the form
    \begin{equation}
        \label{eq:profunctors-def-1}
        \funa\colon \CatC\op \Ctimes \CatD \fto_{\Category} \Set.
    \end{equation}
    This is also written as
    \begin{equation}
        \label{eq:profunctors-def-2}
        \funa\colon \CatC \profto \CatD.
    \end{equation}
\end{ctdefinition}

\todotextjira{176}{This needs to be re-visited - it doesn't say what is the equivalence relation}
\linkvideo{spring2021-profunctors:from-dpi-to-feas} % From DPI to feasibility relations
\linkvideo{spring2021-profunctors:dpi-comp} % DPI composition
\linkvideo{spring2021-profunctors:prof-comp} % Profunctor composition
\begin{widepar}
    \todojira{177}{Adjust style of the following def}
    \begin{ctdefinition}[Profunctor composition]
        \label{def:profunctor-composition}
        Given two profunctors~$\funa\colon \CatC \profto \CatD$ and~$\funb\colon \CatD \profto \CatE$
        we can define their composition~$\funab\colon \CatC \profto \CatE$ as follows:
        \begin{equation}
            \begin{aligned}
                \funabob \colon \Ob(\CatC\op \Ctimes \CatE) & \fto  \Ob\, \Set,                                                                                  \\
                \tup{\prcop, \pre}                          & \mapsto \productop_{\prd\in\Ob \CatD} \funaob(\prcop, \prd) \cartprod \funbob(\prdop, \pre) / \sim
            \end{aligned}
        \end{equation}
        \begin{equation}
            \begin{aligned}
                \funabmor  \colon \Hom_{(\CatC\op \Ctimes \CatE)}( \tupp{\prcop_1, \pre_1}; \tupp{\prcop_2, \pre_2}) \to \Hom_{\Set}( \funabob(\prcop_1, \pre_1); \funabob(\prcop_2, \pre_2)) \\
                \tup{\pralpha^\ast, \prbeta} \mapsto  \begin{cases}
                                                          \begin{aligned}
                        \funabob(\prcop_1, \pre_1) & \to   \funabob(\prcop_2, \pre_2)) \\
                        \tup{\prs, \prt}           & \mapsto  \tup{
                            \funamor(\tup{\pralpha, \catid_{\prd}})(\prs),
                            \funbmor(\tup{\catid_{\prdop}, \prbeta})(\prt)}
                    \end{aligned}
                                                      \end{cases}
            \end{aligned}
        \end{equation}
        In the formulas:
        \begin{equation}
            \pralpha\colon \prc_2 \mto \prc_1, \qquad
            \prbeta\colon \pre_1 \mto \pre_2,
        \end{equation}
        and~$\tup{\prs, \prt}$ is a pair of elements for which there exists a~$\prd\in\Ob \CatD$ such that
        \begin{equation}
            \prs \in \funaob(\prcop_1, \prd), \qquad\prt \in \funbob(\prdop, \pre).
        \end{equation}
    \end{ctdefinition}
\end{widepar}

Unfortunately the composition is not associative, hence profunctors do not form a category.

\showslides{
    \begin{forslides}
        \begin{definition}[$\Cat{V}$-profunctor]
            \label{def:enriched-profunctor}
            Let \CatA and \CatB be categories enriched in~$\Cat{V}$.
            A profunctor enriched in~$\Cat{V}$ from \CatA to \CatB, denoted~$\funa\colon \CatA \profto \CatB$, is a functor enriched in~$\Cat{V}$:
            \begin{equation}
                \funa\colon \CatA\op \Ctimes \CatB \fto \Cat{V}.
            \end{equation}
        \end{definition}

    \end{forslides}
}

\todojira{184}{@J: Add exercises for profunctors}
