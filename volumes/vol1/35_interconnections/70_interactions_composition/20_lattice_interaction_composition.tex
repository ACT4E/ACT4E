% !TEX root = chapter-standalone.tex

\section{Lattice interaction with composition}

\todojira{627}{description and intro}
\todojira{628}{reference to previous parts}
\todojira{629}{better sectioning}

\subsection{Monoidal composition}

\begin{lemma}
    \label{lem:times_vee}
    Consider~$\adpa,\adpb\in \HomSet{\DP}{\F{\posgenA}}{\R{\posgenB}}$ and~$\adpc\in \HomSet{\DP}{\F{\posgenC}}{\R{\posgenD}}$.
    One has
    \begin{equation*}
        (\adpa \join \adpb)
        \mtimescat \adpc=(\adpa \mtimescat \adpc) \join (\adpb\mtimescat \adpc).
    \end{equation*}
\end{lemma}

\begin{proof}
    One has:
    \begin{equation*}
        \begin{aligned}
            ~ & ((\adpa \join \adpb)\mtimescat \adpc)(\tup{\FposgenAel,\F{\posgenCel}}\Fop,\tup{\RposgenBel,\R{\posgenDel}}) \\
              & = (\adpa \join \adpb)(\FposgenAel\Fop,\RposgenBel)\booland \adpc(\F{\posgenCel^*},\R{\posgenDel}) \\
              & =(\adpa(\FposgenAelop,\RposgenBel) \boolor \adpb(\FposgenAelop,\RposgenBel))\booland \adpc(\F{\posgenCel^*},\R{\posgenDel}) \\
              & =(\adpa(\FposgenAelop,\RposgenBel) \booland  \adpc(\F{\posgenCel^*},\R{\posgenDel})) \boolor (\adpb(\FposgenAelop,\RposgenBel)\booland \adpc(\F{\posgenCel^*},\R{\posgenDel})) \\
              & =((\adpa \mtimescat \adpc) \join (\adpb\mtimescat \adpc))(\tup{\FposgenAel,\F{\posgenCel}}\Fop,\tup{\RposgenBel,\R{\posgenDel}}).
        \end{aligned}
    \end{equation*}
\end{proof}

\begin{lemma}
    \label{lem:times_wedge}
    Consider~$\adpa,\adpb\in \HomSet{\DP}{\F{\posgenA}}{\R{\posgenB}}$ and~$\adpc\in \HomSet{\DP}{\F{\posgenC}}{\R{\posgenD}}$.
    One has
    \begin{equation*}
        (\adpa \meet \adpb)
        \mtimescat \adpc=(\adpa \mtimescat \adpc) \meet (\adpb\mtimescat \adpc).
    \end{equation*}
\end{lemma}
\begin{proof}
    One has:
    \begin{equation*}
        \begin{aligned}
            ~ & ((\adpa \meet \adpb)\mtimescat \adpc)(\tup{\FposgenAel,\F{\posgenCel}}\Fop,\tup{\RposgenBel,\R{\posgenDel}}) \\
            = & (\adpa \meet \adpb)(\FposgenAelop,\RposgenBel)\booland \adpc(\F{\posgenCel^*},\R{\posgenDel}) \\
            = & (\adpa(\FposgenAelop,\RposgenBel) \booland \adpb(\FposgenAelop,\RposgenBel))\booland \adpc(\F{\posgenCel^*},\R{\posgenDel}) \\
            = & (\adpa(\FposgenAelop,\RposgenBel) \booland  \adpc(\F{\posgenCel^*},\R{\posgenDel})) \booland (\adpb(\FposgenAelop,\RposgenBel)\booland \adpc(\F{\posgenCel^*},\R{\posgenDel})) \\
            = & ((\adpa \mtimescat \adpc) \meet (\adpb\mtimescat \adpc))(\tup{\FposgenAel,\F{\posgenCel}}\Fop,\tup{\RposgenBel,\R{\posgenDel}}).
        \end{aligned}
    \end{equation*}
\end{proof}

% \begin{lemma}
%     \label{lem:vee_vee}
%     Consider~$\adpa,\adpb,\adpc\in \HomSet{\DP}{\F{\posgenA}}{\R{\posgenB}}$.
%     One has
%     \begin{equation*}
%         (\adpa \join \adpb)
%         \join \adpc=(\adpa \join \adpc) \join (\adpb\join \adpc).
%     \end{equation*}
% \end{lemma}
% \begin{proof}
%     One has:
%     \begin{equation*}
%         \begin{aligned}
%             ~ & ((\adpa \join \adpb)\join \adpc)(\FposgenAelop,\RposgenBel) \\
%               & =  (\adpa \join \adpb)(\FposgenAelop,\RposgenBel)\boolor \adpc(\FposgenAelop,\RposgenBel) \\
%               & =(\adpa(\FposgenAelop,\RposgenBel) \boolor \adpb(\FposgenAelop,\RposgenBel))\boolor \adpc(\FposgenAelop,\RposgenBel) \\
%               & =(\adpa(\FposgenAelop,\RposgenBel) \boolor  \adpc(\FposgenAelop,\RposgenBel)) \boolor (\adpb(\FposgenAelop,\RposgenBel)\boolor \adpc(\FposgenAelop,\RposgenBel)) \\
%               & =((\adpa \join \adpc) \join (\adpb\join \adpc))(\FposgenAelop,\RposgenBel).
%         \end{aligned}
%     \end{equation*}
% \end{proof}

\subsection{Trace}

\begin{lemma}
    \label{lem:trace_vee}
    Consider~$\adpa,\adpb\in \HomSet{\DP}{\F{\posgenC}\cartprod\F{\posgenA}}{\R{\posgenC} \cartprod\R{\posgenB}}$.
    One has
    \begin{equation*}
        \Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpa\join \adpb)=\Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpa)\join  \Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpb)
    \end{equation*}
\end{lemma}
\begin{proof}
    One has:
    \begin{equation*}
        \begin{aligned}
            ~ & \Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpa\join \adpb)(\FposgenAelop,\RposgenBel) \\
              & = \bigvee_{\posCel\in \posC} (\adpa\join \adpb)(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel}) \\
              & =\bigvee_{\posCel\in \posC} \adpa(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel})\boolor \adpb(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel}) \\
              & =\bigvee_{\posCel\in \posC} \adpa(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel})\boolor \bigvee_{\posCel\in \posC} \adpb(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel}) \\
              & =\Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpa)(\FposgenAelop,\RposgenBel)\boolor  \Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpb)(\FposgenAelop,\RposgenBel)
        \end{aligned}
    \end{equation*}
\end{proof}

\begin{remark}
    Consider~$\adpa,\adpb\in \HomSet{\DP}{\F{\posgenC}\cartprod\F{\posgenA}}{\R{\posgenC} \cartprod\R{\posgenB}}$.
    In general, one has
    \begin{equation*}
        \Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpa\meet \adpb)\neq \Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpa)\meet  \Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpb)
    \end{equation*}
    Specifically, on one hand one has
    \begin{equation*}
        \begin{aligned}
            \Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpa\meet \adpb)(\FposgenAelop,\RposgenBel) & = \bigvee_{\posCel\in \posC} (\adpa\meet \adpb)(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel}) \\
                                                                                                 & =\bigvee_{\posCel\in \posC} \adpa(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel})\booland \adpb(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel}),
        \end{aligned}
    \end{equation*}
    and on the other hand one has
    \begin{equation*}
        \begin{aligned}
             & \Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpa)(\FposgenAelop,\RposgenBel)\meet  \Tr_{\F{\posgenA},\F{\posgenB}}^{\posC}(\adpb)(\FposgenAelop,\RposgenBel) \\
             & =\bigvee_{\posCel\in \posC} \adpa(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel})\booland \bigvee_{\posCel\in \posC} \adpb(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel}).
        \end{aligned}
    \end{equation*}
    Clearly, these two equations are different, as soon as one has uncomparable~$\posgenCel,\posgenCel'\in \posgenC$, and~$\posgenAel\in \posgenA$,~$\posgenBel\in \posgenB$ such that
    \begin{equation*}
        \begin{aligned}
            \adpa(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel})  & =\true, \\
            \adpb(\tup{\F{\posgenCel},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel})  & =\true, \\
            \adpb(\tup{\F{\posgenCel'},\FposgenAel}\Fop,\tup{\R{\posgenCel},\RposgenBel}) & =\false.
        \end{aligned}
    \end{equation*}
\end{remark}

\todo{If needed, let's add a specific case}