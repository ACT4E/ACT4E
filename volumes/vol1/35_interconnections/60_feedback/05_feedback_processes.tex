% !TEX root = chapter-standalone.tex

\section{Feedback for systems}
\label{sec:feedback-processes}

\todotext{write intro to this section}

\subsection{Moore machines}

\todotext{write up this subsection}

%\begin{definition}[Moore machine, 3rd definition]
%    \label{def:moore-machine}
%    A Moore machine is a tuple
%    \begin{equation}
%        \label{eq:moore-tuple-improved-again}
%        \tup{\prinL,\prstL,\proutL,\prdyn,\prreadout,\prstart},
%    \end{equation}
%    where~$\prinL$,~$\prstL$, and~$\proutL$ are objects of~$\SetL$,~$\prdyn$ is a function of the type
%    \begin{equation}
%        \prdyn \colon \prinL \cprod \prstL \mtoin{\SetL} \prstL,
%    \end{equation}
%    $\prreadout$ is a function of the type
%    \begin{equation}
%        \prreadout \colon \prstL \mtoin{\SetL} \proutL,
%    \end{equation}
%    and~$\prstart \setin \prstL$.
%\end{definition}

\begin{definition}\label{def:trace-moore}
    Let $\mora = \tup{\prinL \cprod \prObjw,\prstL,\proutL \cprod \prObjw, \prdyn_\mora,\prreadout_\mora,\prstart}$ be a \SY{Moore machine}.
    The \emph{trace of} $\mora$ \emph{over} $\prObjw$ is the Moore machine
    \begin{equation}
        \Tr_{\prinL,\proutL}^\prObjw \mora = \tup{\prinL,\prstL,\proutL, \prdyn_{\Tr \mora}, \prreadout_{\Tr \mora},\prstart}
    \end{equation}
    where
    \begin{equation}
        \defmapperiodset{
            \prdyn_{\Tr \mora}
        }{
            \prinL \cprod \prstL
        }{
            \prstL
        }{
            \prinel \tupconcat \prstel
        }{
            \prdyn_\mora(\prinel \tupconcat \pi_\prObjw \prreadout (\prstel) \tupconcat \prstel)
        }
    \end{equation}
    and
    \begin{equation}
        \defmapperiodset{
            \prreadout_{\Tr \mora}
        }{
            \prstL
        }{
            \proutL
        }{
            \prstel
        }{
            \pi_\proutL \prreadout (\prstel)
        }
    \end{equation}
    %
    Above, $\pi_\Objc$ is the projection $\prinL \cprod \prObjw \to \prObjw$ and $\pi_\proutL$ is the projection $\proutL \cprod \prObjw \to \proutL$.
\end{definition}

\subsection{Proper LTI systems}

\todotext{write up this subsection}

%\begin{ctdefinition}[Category \LTI]
%    The category  \iindex{\LTI} of LTI systems is defined by:
%    \begin{enumerate}
%        \item \emph{Objects}: natural numbers.
%        \item \emph{Morphisms}: A morphism in \LTI from~$\styleobj{l}\setin \natnumbers$ to~$\styleobj{m}\setin \natnumbers$ is a continuous time LTI system~$\genericlti{}$.
%              %where~$\mat{A}\setin \reals^{\ntimesn}$,~$\mat{B}\setin \reals^{n\times l}$,~$\mat{C}\setin \reals^{m\times n}$,~$\mat{D}\setin \reals^{m\times l}$.
%              Note that the dimensions of the input/output are implicit.
%        \item \emph{Composition}: Given morphisms~$\mora \colon \styleobj{a}\mto \styleobj{b}$ and~$\morb\colon \styleobj{b}\mto \styleobj{c}$, described by the LTI systems
%              \begin{equation}
%                  \begin{aligned}
%                       & \genericlti{\mora} \\
%                       & \genericlti{\morb},
%                  \end{aligned}
%              \end{equation}
%              their composition~$(\mora \mthen \morb)\colon \styleobj{a}\mto \styleobj{c}$ is the LTI system~$\genericlti{}$, where
%              \begin{equation}
%                  \begin{aligned}
%                      \prstart & =\begin{bmatrix}
%                                      \prstart_\mora \\
%                                      \prstart_\morb \\
%                                  \end{bmatrix},\quad
%                      \mat{A}=\begin{bmatrix}
%                                  \mat{A}_\mora              & \mat{0}       \\
%                                  \mat{B}_\morb\mat{C}_\mora & \mat{A}_\morb
%                              \end{bmatrix},\quad
%                      \mat{B}=\begin{bmatrix}
%                                  \mat{B}_\mora \\
%                                  \mat{B}_\morb\mat{D}_\mora
%                              \end{bmatrix}, \\
%                      \mat{C}  & =\begin{bmatrix}
%                                      \mat{D}_\morb\mat{C}_\mora & \mat{C}_\morb
%                                  \end{bmatrix}, \quad
%                      \mat{D}=\mat{D}_\morb\mat{D}_\mora.
%                  \end{aligned}
%              \end{equation}
%        \item \emph{Identities}: the identity for~$\styleobj{l}\setin \natnumbers$ is the system~$\tup{\mat{0}^{0\times 1},\mat{0}^{0\times 0},\mat{0}^{0\times l},\mat{0}^{l\times 0},\mathbb{I}^{l\times l}}$.
%
%    \end{enumerate}
%\end{ctdefinition}

\begin{definition}\label{def:trace-lti-prop}
    Let $\mora = \genericplti{}$ be a proper LTI system from $\styleobj{l}\setin \natnumbers$ to~$\styleobj{m}\setin \natnumbers$.
    Given factorizations $\styleobj{l} = \styleobj{i} + \styleobj{k}$ and $\styleobj{m} = \styleobj{j} + \styleobj{k}$, we define the proper LTI system $\Tr_{\styleobj{i},\styleobj{j}}^{\styleobj{k}}\mora$ as
    \begin{equation}
        \tupp{\prstart,\mat{A} + \rowscols{\mat{B}}{:}{i+1:k}\rowscols{\mat{C}}{j+1:j+k}{:},\rowscols{\mat{B}}{:}{1:i},\rowscols{\mat{C}}{1:j}{:}}
    \end{equation}
    where the notation $\rowscols{\mat{A}}{a:b}{c:d}$ means considering rows $a$ to $b$ and columns $c$ to $d$ of matrix $\mat{A}$.
    In case only $:$ is given, all rows/column are considered.

    \begin{comment}
    where $\mat{B}_\styleobj{i}$ and $\mat{B}_\styleobj{k}$ are such that
    \begin{equation}
        \mat{B} = \begin{bmatrix}
            \mat{B}_\styleobj{i} & \mat{B}_\styleobj{k}
        \end{bmatrix}
    \end{equation}
    and $\mat{C}_\styleobj{j}$ and $\mat{C}_\styleobj{k}$ are such that
    \begin{equation}
        \mat{C} = \begin{bmatrix}
            \mat{C}_\styleobj{j} \\ \mat{C}_\styleobj{k} \\
        \end{bmatrix}.
    \end{equation}
    \end{comment}
\end{definition}

\begin{definition}\label{def:trace-lti-prop}
    Let $\mora = \genericlti{}$ be a proper LTI system from $\styleobj{l}\setin \natnumbers$ to~$\styleobj{m}\setin \natnumbers$.
    Given factorizations $\styleobj{l} = \styleobj{i} + \styleobj{k}$ and $\styleobj{m} = \styleobj{j} + \styleobj{k}$, we define the LTI system $\Tr_{\styleobj{i},\styleobj{j}}^{\styleobj{k}}\mora$ as
    \begin{equation}
        \begin{aligned}
            \langle\prstart,\mat{A} + \rowscols{\mat{B}}{:}{i+1:k}\mat{E} \rowscols{\mat{C}}{j+1:j+k}{:}, & \rowscols{\mat{C}}{1:j}{:}+\rowscols{\mat{D}}{1:j}{i+1:i+k}\mat{E}\rowscols{\mat{C}}{j+1:j+k}{:}, \\
                                                                                                          & \rowscols{\mat{D}}{1:j}{1:i}+\rowscols{\mat{D}}{1:j}{i+1:i+k}\mat{E} \rowscols{\mat{D}}{j+1:j+k}{1:i}\rangle,
        \end{aligned}
    \end{equation}
    where $\mat{E}=(\idmat-\rowscols{\mat{D}}{j+1:j+k}{i+1:i+k})^{-1}$.
    \begin{comment}
    where $\mat{B}_\styleobj{i}$ and $\mat{B}_\styleobj{k}$ are such that
    \begin{equation}
        \mat{B} = \begin{bmatrix}
            \mat{B}_\styleobj{i} & \mat{B}_\styleobj{k}
        \end{bmatrix}
    \end{equation}
    and $\mat{C}_\styleobj{j}$ and $\mat{C}_\styleobj{k}$ are such that
    \begin{equation}
        \mat{C} = \begin{bmatrix}
            \mat{C}_\styleobj{j} \\ \mat{C}_\styleobj{k} \\
        \end{bmatrix}.
    \end{equation}
    \end{comment}
\end{definition}
