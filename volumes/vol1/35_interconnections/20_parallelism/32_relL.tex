% !TEX root = chapter-standalone.tex

\section{The Category~$\cCat{\Rel}$}
We define a category~$\cCat{\Rel}$ where the objects are sets of tuples (as in~$\cCat{\Set}$).

What is a relation in this context?
Given two sets of tuples~$\cObj{\setAn{1},\ldots, \setAn{m}}$ and~$\cObj{\setBn{1},\ldots, \setBn{n}}$, a relation between them is given by
\begin{equation*}
    \relA \subseteq \cObj{\setAn{1},\ldots, \setAn{m}} \cartprod \cObj{\setBn{1},\ldots, \setBn{n}}.
\end{equation*}
We can define a multiplication operation for relations.
Consider
\begin{equation*}
    \begin{aligned}
        \relA\colon \cObj{\setAn{1},\ldots, \setAn{m}} & \mtoin{\cCat{\Rel}}\cObj{\setBn{1},\ldots, \setBn{n}}, \\
        \relB\colon \cObj{\setCn{1},\ldots, \setCn{o}} & \mtoin{\cCat{\Rel}}\cObj{\setDn{1},\ldots, \setDn{p}}.
    \end{aligned}
\end{equation*}
One has
\begin{equation*}
    \relA\mtimescatmor \relB \colon \cObj{\setAn{1},\ldots, \setAn{m}}\cprod \cObj{\setCn{1},\ldots, \setCn{o}}\mtoin{\cCat{\Rel}}
    \cObj{\setBn{1},\ldots, \setBn{n}}\cprod \cObj{\setDn{1},\ldots, \setDn{p}}.
\end{equation*}
Specifically, the multiplication is given by:
\begin{equation}
    \label{eq:multiofrels}
    \defmapperiod{\mtimescatmor}
    {\Mor_{\cCat{\Rel}}\cartprod \Mor_{\cCat{\Rel}}}
    {\mto}
    {\Mor_{\cCat{\Rel}}}
    {\tup{\relA,\relB}}
    {\{\tup{\setAeln{}\tupconcat \setCeln{},\setBeln{}\tupconcat \setDeln{}} \mid \tup{\setAeln{},\setBeln{}}\setin \relA \booland \tup{\setCeln{},\setDeln{}}\setin \relB\}}
\end{equation}

\begin{definition}[The category~$\cCat{\Rel}$]
    \label{def:RelL}
    The category~$\cCat{\Rel}$ is:
    \begin{enumerate}
        \item \emph{Objects:} sets of tuples (as in~$\cCat{\Set}$)
        \item \emph{Morphisms:}
              relations between sets of tuples.
        \item \emph{Composition:}
              Composition is the usual composition of relations.
        \item \emph{Identities:}
              The identity morphism on an object~$\cObj{\setAn{1},\ldots, \setAn{m}}$ is given by the identity relation~$\catid_{\cObj{\setAn{1},\ldots, \setAn{m}}}$.
    \end{enumerate}
\end{definition}

\begin{exercise}
    \label{ex:relassocstack}
    Consider the stacking operations on objects and on morphisms introduced in this section.
    Prove that~$\cCat{\Rel}$ is associative stacking.
\end{exercise}

\begin{solution}
    To prove the statement we first check that the stacking operations satisfy \cref{def:simple-stacking-semi-cat}, we then show that they are compatible, and finally show associativity.
    The stacking operation on objects was already checked for~$\cCat{\Set}$.
    The stacking operation on morphisms clearly returns a valid relation.
    Furthermore, compatibility is satisfied:
    \begin{equation*}
        \prfperiod{
            \relA\colon \cObj{\setAn{1},\ldots, \setAn{m}} \mtoin{\cCat{\Rel}}\cObj{\setBn{1},\ldots, \setBn{n}}
        }
        {
            \relB\colon \cObj{\setCn{1},\ldots, \setCn{o}} \mtoin{\cCat{\Rel}}\cObj{\setDn{1},\ldots, \setDn{p}}
        }
        {
            \relA\mtimescatmor \relB \colon \cObj{\setAn{1},\ldots, \setAn{m}}\cprod \cObj{\setCn{1},\ldots, \setCn{o}}\mtoin{\cCat{\Rel}}
            \cObj{\setBn{1},\ldots, \setBn{n}}\cprod \cObj{\setDn{1},\ldots, \setDn{p}}
        }
    \end{equation*}
    Finally, associativity for the operation on objects was already shown for~$\cCat{\Set}$.
    The stacking operation on morphisms follows directly from \cref{eq:multiofrels}.
\end{solution}
\begin{exercise}
    \label{ex:relfuncstack}
    Prove that the structure defined in \cref{ex:relassocstack} makes~$\cCat{\Rel}$ functorial stacking.
\end{exercise}

\begin{solution}
    Consider
    \begin{equation*}
        \begin{aligned}
            \relA\colon \setA & \mtoin{\cCat{\Rel}} \setB \\
            \relB\colon \setD & \mtoin{\cCat{\Rel}} \setE \\
            \relC\colon \setB & \mtoin{\cCat{\Rel}} \setC \\
            \relD\colon \setE & \mtoin{\cCat{\Rel}} \setF \\
        \end{aligned}
    \end{equation*}
    We want to prove that
    \begin{equation*}
        (\relA \mthen \relC) \mtimescatmor (\relB \mthen \relD)=(\relA \mtimescatmor \relB) \mthen (\relC \mtimescatmor \relD).
    \end{equation*}
    Recall that
    \begin{equation*}
        \relA \mthen \relC =\{ \tup{\setAel, \setCel}\in \setA\cartprod \setC \mid \exists \setBel \in \setB \colon (\tup{\setAel,\setBel}\setin \relA) \booland (\tup{\setBel, \setCel} \setin \relC)\}
    \end{equation*}
    and
    \begin{equation*}
        \relB \mthen \relD =\{ \tup{\setDel, \setFel}\in \setD\cartprod \setF \mid \exists \setEel \in \setE \colon (\tup{\setDel,\setEel}\setin \relB) \booland (\tup{\setEel, \setFel} \setin \relD)\}
    \end{equation*}
    Therefore:
    \begin{equation*}
        \begin{aligned}
            (\relA \mthen \relC) \mtimescatmor (\relB \mthen \relD) & =\{\tup{\setAeln{}\tupconcat \setDeln{},\setCeln{}\tupconcat \setFeln{}} \mid (\tup{\setAeln{},\setCeln{}}\setin \relA\mthen \relC) \booland (\tup{\setDeln{},\setFeln{}}\setin \relB\mthen \relD)\}
        \end{aligned}
    \end{equation*}
    On the other hand, one has:
    \begin{widepar}
        \begin{equation*}
            \begin{aligned}
                 & (\relA \mtimescatmor \relB) \mthen (\relC \mtimescatmor \relD) \\
                 & =\{\tup{\setAeln{}\tupconcat \setDeln{},\setCeln{}\tupconcat \setFeln{}} \mid \exists \setBel \tupconcat \setEel \in \cObj{\setB,\setE} \colon  (\tup{\setAeln{}\tupconcat \setCeln{},\setBeln{}\tupconcat \setEeln{}}\setin \relA\mtimescatmor \relB) \booland (\tup{\setBeln{}\tupconcat \setEeln{}, \setCeln{}\tupconcat \setFeln{}}\setin \relC\mtimescatmor \relD)\} \\
                 & =\{\tup{\setAeln{}\tupconcat \setDeln{},\setCeln{}\tupconcat \setFeln{}} \mid (\exists \setBel \setin \setB) \booland (\exists \setEel \setin \setE) \colon
                (\tup{\setAeln{},\setBeln{}}\setin \relA)\booland (\tup{\setCeln{},\setEeln{}}\setin \relB) \booland
                (\tup{\setBeln{}, \setCeln{}}\setin \relC)\booland
                (\tup{\setEeln{}, \setFeln{}}\setin \relD)\}
            \end{aligned}
        \end{equation*}
        which shows the equivalence.
    \end{widepar}
\end{solution}

