% !TEX root = ../CategoricalCoDesign.tex
\section{Thinking about how things transform into each other}

\subsection{Category theory helps reasoning about interfaces and transformations}

We argue that all the concepts of formal engineering design discussed in the
previous section can be naturally described in the language of category theory. We will start with a simple example. In an electric car, electric power is turned by the engine into rotational
motion of the axle, and then the rotational motion is converted into translational motion by the wheels and their friction with the road. In this simple setting, one can identify the key systems and subsystems: car, engine, axle, wheels, and road.

We can identify the functionality/resources of interest as: $\mathsf{electric} \ \mathsf{power}$, $\mathsf{rotational}\ \mathsf{motion}$, and $\mathsf{translational}\ \mathsf{motion}$. Note that each of these quantities plays a dual role. For example, the $\mathsf{rotational} \ \mathsf{motion}$ is something which is produced by the motor, so it is a functionality for the motor, while it is a resource for axle/wheels, because they need it to provide $\mathsf{translational}\ \mathsf{motion}$.

For a first qualitative description of the scenario, we might choose to just keep track of what functionality/resource is converted into what. For this qualitative description, we can draw a diagram in which each resource
is a point (\cref{fig:e1}).

\begin{figure}[h!]
    \centering
    \includesag{30_dpcatfig_e1}
    \caption{Resources/functionalities in the electric car example \label{fig:e1}.}
\end{figure}

Furthermore, we can draw an arrow between two resources if we can obtain one
from the other. In the example, we have described how $\mathsf{electric}\ \mathsf{power}$ becomes $\mathsf{rotational}\ 
\mathsf{motion}$, described by the $\mathsf{engine}$ arrow, and how $\mathsf{rotational}\ 
\mathsf{motion}$ becomes $\mathsf{translational}\ \mathsf{motion}$, described by the $\mathsf{wheel}$ arrow (\cref{fig:e2}).

\begin{figure}[h!]
    \centering
    \includesag{30_dpcatfig_e2}
    \caption{System components connect resources/functionalities \label{fig:e2}.}
\end{figure}

In this representation, the arrows are the components of the system.
We will learn how to compose these arrows according to the rules of category theory.

If we use the semantics that an arrow from resource $X$ to resource $Y$ means ``Having $Y$ is
enough to obtain $X$'', then, since $Y$ is enough for $Y$ per definition, we can add a self-loop for each
resource. We will call the self-loops \emph{identities} (\cref{fig:e3}).

\begin{figure}[h!]
    \centering
    \includesag{30_dpcatfig_e3}
    \caption{System components and identities \label{fig:e3}.}
\end{figure}

Furthermore, we might consider the idea of composition of arrows. If from $Y$ we
can get $X$ and from $Z$ we can get $Y$, then from $Z$ we can get $X$. In our
example, if the arrows $\mathsf{engine}$ and $\mathsf{wheel}$ exist, then also the arrow ``$\mathsf{engine}$ then $\mathsf{wheel}$''
exists~(\cref{fig:e4}).
\GZ{Figure has to go here}

\begin{figure}[h!]
    \centering
    \input{sag/30_dpcatfig_e4.tikz}
    \caption{Composition of system components \label{fig:e4}.}
\end{figure}

A ``category'' is nothing more than this \GZ{reformulate}: It is an abstract mathematical
structure whose two primitive notions are objects and arrows between objects.
The following is the formal definition.

\begin{shaded}
\begin{definition}[Category] \label{def:categorymain}
A \emph{category} $\CatC$ is defined by specifiying four components: 
%vthe
%category's \emph{objects}, the category's \emph{morphisms},
%the \emph{identities} and the \emph{composition operations}. More precisely,
%a category consists of:
\begin{compactenum}
\item \emph{Objects}: a collection\footnotemark \  $\ObC$, whose elements are called \emph{objects}.
\item \emph{Morphisms}: for every pair of objects $X, Y\in \ObC$, there is a set $\CatC(X, Y)$, the elements of which are called
\emph{morphisms} from $X$ to $Y$. $\HomC(X, Y)$ is sometimes called the ``hom-set from $X$ to $Y$''. 
\item \emph{Identity morphisms}:  for each object $X$, there is
an element $\id_X \in \HomC(X,X) $ which is called \emph{the identity
morphism of $X$}.
\item \emph{Composition operations}: given any morphism $f \in  \HomC(X,Y) $ and any morphism $g \in \HomC(Y, Z)$, there exists a morphism $f\then g$ in $\HomC(X, Z)$ which is the \emph{composition of $f$ and $g$}.
\end{compactenum}

\

Furthermore, there are two properties that must hold:

\

\begin{compactenum}
    \item \emph{Unitality}: for any morphism $f\in\Hom(X,Y)$, 
    \begin{equation}
        \id_X \then f= f = f \then \id_Y.
    \end{equation}
    \item \emph{Associativity}: for $f\in \HomC(X,Y)$, $g\in \HomC(Y,Z)$, and $h\in \HomC(Z,W)$,
    \begin{equation}
        (f\then g)\then h= f \then (g \then h).
    \end{equation}
\end{compactenum}

\end{definition}
\end{shaded}
\footnotetext{A ``collection'' is something which may be thought of as a set, but may be ``too large" to technically be a set in the formal sense. This distinction is necessary in order to avoid such issues as Russel's paradox.}

\begin{remark}
The set of morhisms $\CatC(X, Y)$ is sometimes denoted $\HomC(X, Y)$ and called the ``hom-set from $X$ to $Y$''. The ``Hom'' comes from the word ``homomorphism''.
\end{remark}

\begin{remark}[Composition notation]
We denote composition of morphisms in a somewhat unusual way---sometimes preferred by category-theorists and computer scientists---namely in \emph{diagrammatic order}. That is, given $f\colon A\to B$ and $g\colon B\to C$, we denote their composite by $(f\then g)\colon A\to C$, pronounced ``$f$ then $g$''. This is in contrast to the more typical notation for composition, namely $g\circ f$, or simply $gf$, which reads as ``$g$ after $f$''. The notation $f\then g$ is also sometimes called \emph{infix notation}. 
\end{remark}


\noindent The properties of a category allow us to save some ink when drawing diagrams of morphisms:
\begin{compactitem}
\item We do not need to draw the identity arrows from one object to itself, because, by the definition of a category, they always exist. 
%However, we will see how there might be multiple such loops.
\item  Whenever there are arrows $A\to B$ and $B \to C$, we will not need to draw the arrows composition, because it always exists in a category.
\end{compactitem}

With these conventions, we can just draw the arrows~$f$ and~$g$ in the diagram,
and the rest of the diagram is implied (\cref{fig:e5}).

\begin{figure}[h!]
    \centering
    \includesag{30_dpcatfig_e5}
    \caption{\label{fig:e5} Electric car example. The grey arrows are implied by the properties
    of a category.}
\end{figure}

Particularly, the electric car example corresponds to the category $\CatC$ specified by 
\begin{itemize}
    \item \emph{Objects:} $\Ob_\CatC=\{\mathsf{electric}\ \mathsf{power},\mathsf{rotational}\ \mathsf{motion},\mathsf{translational}\ \mathsf{motion}\}$.
    \item \emph{Morphisms}: The system components are the morphisms. E.g., we have $\mathsf{engine}$, $\mathsf{wheel}$, and the morphism $\mathsf{wheel \ then \ engine}$, implied by the properties of the category.
\end{itemize}

We can slightly expand this example by noting the inverse transformations. In an electric car
it is possible to regenerate power; that is, we can obtain $\mathsf{rotational}\ \mathsf{motion}$ of the wheels from
$\mathsf{translational}\ \mathsf{motion}$ (via the morphism $\mathsf{move}$), and then convert the $\mathsf{rotational}\ \mathsf{motion}$ into $\mathsf{electric}\ \mathsf{power}$ (via the morphism $\mathsf{dynamo}$)~(\cref{fig:e6},\cref{fig:e6-together}).


\begin{figure}[h!]
    \centering
    \includesag{30_dpcatfig_e6}
    \caption{\label{fig:e6}}
\end{figure}


\begin{figure}[h!]
    \centering
    \includesag{30_dpcatfig_e7}
    \caption{\label{fig:e6-together}}
\end{figure}

Given the semantics of the arrows in a category, all compositions of arrows exist, even if they are not drawn
explicitly. For example, we can consider the composition~$f\then g \then k \then h$, which
converts $\mathsf{electric}\ \mathsf{power}$ into $\mathsf{rotational}\ \mathsf{motion}$, into $\mathsf{translational}\ \mathsf{motion}$, then back to
$\mathsf{rotational}\ \mathsf{motion}$ and $\mathsf{electric}\ \mathsf{power}$. This is an arrow that has the same head and tail as the identity on $\mathsf{electric}\ \mathsf{power}$~(\cref{fig:e8}). However, the arrows are not necessarily the same. In fact, we know that if these are physical systems, there will be some loss for the many conversions.

\begin{figure}[h!]
    \centering
    \includesag{30_dpcatfig_e8}
    %\includegraphics[scale=0.33]{dpcatfig_e8}
    \caption{\label{fig:e8}}
\end{figure}

In fact, it is important to recognize that there might be two or more distinct arrows between two resources~(\cref{fig:e9}). Each arrow between $X$ and $Y$ represents a different way  to obtain~$X$ from~$Y$. This is one of the aspects which will make category theory powerful enough to reason about design.

\begin{figure}[h!]
    \centering
    \includesag{30_dpcatfig_e9}
    \caption{\label{fig:e9}}
\end{figure}

The directionality of the arrows is also important. While the convention of
which resource is the tail and which the head is just a typographic convention,
it might be the case that we know how to convert one resource into another, but
not vice versa.

\cref{fig:e10} shows an example of a diagram that describes a process which is definitely
not invertible.

\begin{figure}[h!]
    \centering
    \includesag{30_dpcatfig_e10}
    \caption{An example of a process which is not invertible. \label{fig:e10}}
\end{figure}

\subsection{The currency category}
In this section, we start by introducing an example. We define a category of currency exchangers $\mathbf{Curr}$. To introduce what currencies are, we first present the notion of units. Define $\mathbb{R}_\mathsf{g}$ to be the set of real numbers $\mathbb{R}$ with unit $\mathsf{g}$ ($\mathbb{R}\times \{\mathsf{g}\}$). With $\unit[p]{\mathsf{a}}\in \mathbb{R}_\mathsf{a}$ we denote a real $p\in \mathbb{R}$ with unit $\mathsf{a}$. Given $\unit[p]{\mathsf{a}} \in \mathbb{R}_\mathsf{a}$ and $\unit[q]{\mathsf{b}}\in \mathbb{R}_\mathsf{b}$, define
    \begin{equation}
    \begin{aligned}
    \cdot \colon \mathbb{R}_\mathsf{a} \times \mathbb{R}_\mathsf{b} &\to \mathbb{R}_\mathsf{ab}\\
    \tup{\unit[p]{\mathsf{a}},\unit[q]{\mathsf{b}}}&\mapsto r\coloneqq \unit[p\cdot q]{\mathsf{ab}}.
    \end{aligned}
    \end{equation}
Furthermore, two objects can be summed if and only if they share the same units. Note that from now on we will say $p\in \mathbb{R}_\mathsf{g}$ to mean $\unit[p]{\mathsf{g}}$, $p\in \mathbb{R}$.

\noindent Consider two currencies, $\mathsf{C,D}$. A currency exchanger from $\mathsf{C}$ to $\mathsf{D}$ can be expressed as a pair $\tup{a,b}$, $a\in {\mathbb{R}_{+}}_ {\frac{\mathsf{D}}{\mathsf{C}}}$ and $b\in {\mathbb{R}_{+}}_ {\mathsf{D}}$. The pair specifies an affine function of the form
\begin{equation}
        \begin{aligned}
        \mathsf{CE}\colon \mathbb{R}_\mathsf{C}&\to \mathbb{R}_\mathsf{D}\\
        \unit[p]{\mathsf{C}}&\mapsto \unit[q]{\mathsf{D}} \coloneqq a\cdot \unit[p]{\mathsf{C}} -b,
        \end{aligned}
    \end{equation}
   where $a$ represents the exchange rate from $\mathsf{C}$ to $\mathsf{D}$, and $b$ represents the fixed commission of the currency exchanger. Note that one can define the identity currency exchanger, $\tup{1,0}$, which is equivalent to not exchange the money. As an example, consider three currency exchange companies $\mathsf{ExchATM}$, $\mathsf{MoneyLah}$, and $\mathsf{Frankurrencies}$, which operate on several currencies (\cref{tab:currencycompanies}).
   
\begin{table}[h]
    \centering
    \begin{tabular}{c|c|c|c|c}
         Company name&Operation name& Direction &$a$ (exchange rate)&$b$   (fixed commission)  \\
         \hline
         $\mathsf{ExchATM}$&$A$&USD to CHF&\unitfrac[0.95]{CHF}{USD}&\unit[2.0]{CHF}\\
         $\mathsf{ExchATM}$&$B$&CHF to USD&\unitfrac[1.05]{USD}{CHF}&\unit[1.5]{USD}\\
         $\mathsf{ExchATM}$&$C$&USD to SGD&\unitfrac[1.40]{SGD}{USD}&\unit[1.0]{SGD}\\
         $\mathsf{MoneyLah}$&$D$&USD to CHF&$\unitfrac[1.00]{CHF}{USD}$&\unit[1.0]{CHF}\\
         $\mathsf{MoneyLah}$&$E$&SGD to USD&\unitfrac[0.72]{USD}{SGD}&\unit[3.0]{USD}  \\
        $\mathsf{Frankurrencies}$&$F$& EUR to CHF&\unitfrac[1.20]{CHF}{EUR}&\unit[0.0]{CHF}\\
        $\mathsf{Frankurrencies}$&$G$& CHF to EUR&\unitfrac[1.00]{EUR}{CHF}&\unit[1.0]{EUR}
    \end{tabular}
    \caption{Three currency exchange companies operating different currencies.
    }
    \label{tab:currencycompanies}
\end{table}

We can represent this information as a graph, where the nodes are the currencies and the edges are particular exchange operations (\cref{fig:currencygraph}).

\begin{figure}[h]
\begin{center}
    \begin{tikzcd}[column sep = 5cm, row sep = 3cm]
    \text{USD}\arrow[bend left=20, r,"A"]\arrow[bend right=20, r,"D",swap] 
    \arrow[d,bend left=20,"C"]
    &\text{CHF}
    \arrow[d,bend left=20,"G"]
    \arrow[l,"B"]\\
    \text{SGD}\arrow[u,bend left=20,"E"]&
    \text{EUR}
    \arrow[u,bend left=20,"F"]
    \end{tikzcd}
\end{center}
\caption{Three currency exchange companies operating different currencies as a graph. \label{fig:currencygraph}}
\end{figure}

The graph representation seems enough to describe this as a category, where the objects are the currencies (USD,CHF,EUR, and SGD), the morphisms are the different exchange operations, and the identity morphisms are identity currency exchangers. However, to properly define this category, we need to define composition and prove that the category is closed with respect to it, i.e. that the composition of two currency exchangers is a currency exchanger in the category. Given three currencies $\mathsf{X,Y,Z}$, a currency exchanger $\tup{a,b}$ from $\mathsf{X}$ to $\mathsf{Y}$, and a currency exchanger $\tup{c,d}$ from $\mathsf{Y}$ to $\mathsf{Z}$, one can define their composition as
\begin{equation}
\begin{aligned}
\label{eq:currencycomp}
    \tup{a,b}\then \tup{c,d}&=\tup{c\cdot a,c\cdot b+d}
\end{aligned}
\end{equation}
Note that the result of the composition of currency exchangers is a currency exchanger: Thus, currency exchangers are closed under the composition operation we have defined. Finally, we need to check \emph{unitality} and \emph{associativity} for composition. Given a currency exchanger $\tup{a,b}$ from $\mathsf{X}$ to $\mathsf{Y}$ one has
\begin{equation}
    \begin{aligned}
    \tup{1,0}\then \tup{a,b}&=\tup{a,b}\then \tup{1,0}\\
    &=\tup{a,b},
    \end{aligned}
\end{equation}
which is unitality. Furthermore, given a currency exchanger $\tup{c,d}$ from $\mathsf{Y}$ to $\mathsf{Z}$ and a currency exchanger $\tup{e,f}$ from $\mathsf{Z}$ to $\mathsf{W}$, one has
\begin{equation}
    \begin{aligned}
    (\tup{a,b}\then \tup{c,d})\then \tup{e,f}&=\tup{a,b}\then( \tup{c,d}\then \tup{e,f})\\
    &=\tup{eca, ecb+ed+f},
    \end{aligned}
\end{equation}
which is associativity.
We are now ready to properly define the category of currency exchangers $\mathbf{Curr}$.

\begin{definition}[Category of currencies]
    The \emph{category of currencies} $\mathbf{Curr}$ is specified by:
    \begin{compactenum}
        \item \emph{Objects:} $\Ob_\mathbf{Curr}$ is a collection of currencies.
        \item \emph{Morphisms:} Given two currencies $\mathsf{C},\mathsf{D}\in \Ob_{\mathbf{Curr}}$, morphisms between them are currency exchangers $\tup{a,b}$ from $\mathsf{C}$ to $\mathsf{D}$. 
        \item \emph{Identity morphism:} Given an object $C\in \Ob_\mathbf{Curr}$, the identity morphism is given by the currency exchanger $\tup{1,0}$.
        \item \emph{Composition of morphisms:} The composition of morphisms is given by composition of currency exchangers.
    \end{compactenum}
\end{definition}

The category $\Cat{Curr}$ represents the set of all possible currency exchangers that could
ever exist. However, in this set there would be very irrational agents. For example, there is a currency exchanger that given 1 USD, will give you back 2 USD, or even will not give you back any money. This highlights a recurring topic: Often mathematicians will be happy to define a broader category of objects, while, in practice, the engineer will find herself thinking about a more constrained set of objects. In particular, one would like to find the best conversions. These can be expressed as \emph{pareto fronts}. To do so, one only needs to iterate a finite number of times, since the optimal path (conversion morphism), if such a morphism exists, will never pass through the same currency more than once. This is valid if we assume the action of converting back and forth the same currency to have a cost (through the commission) higher than 0. To see this, consider three currencies $\mathsf{A,B,C}$, a currency exchanger $\tup{a,b}$ from $\mathsf{A}$ to $\mathsf{B}$ , a currency exchanger $\tup{c,d}$ from $\mathsf{B}$ to $\mathsf{C}$ , and a currency exchanger $\tup{e,f}$ from $\mathsf{C}$ to $\mathsf{A}$. \JL{more pedagogical} The composition of the currency exchangers reads:
\begin{equation}
\tup{\underbrace{eca}_{g}, \underbrace{ecb+ed+f}_{h}}.
\end{equation}
Assuming $e=a^{-1}$ (i.e., an exchange rate direction is not more profitable than the other), and $h\neq 0$, because of the commissions one can show that there are multiple morphisms from $\mathsf{A}$ to $\mathsf{A}$, and that the identity morphism is the most ``convenient'' one.
\GZ{not clear, maybe a diagram?}




