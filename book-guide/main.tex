\documentclass{article}
%\documentclass[paper=8.125in:10.250in,pagesize=pdftex,
   % headinclude=false,footinclude=true,final,oneside,egregdoesnotlikesansseriftitles]{kaobook}
\usepackage[demo]{graphicx} % Required for inserting images
\def\sagdir{sag}
\def\rootdir{../../..}


\title{ACT4E Installation \& Book Setup}
\author{ Justin Bollhalder, Victor Kawasaki-Borruat, Jonathan Lorand}
\date{July 2024}
\usepackage{amsthm}

\usepackage{verbatim}
\usepackage{xcolor}
\definecolor{bg}{HTML}{282828}
\newtheorem{remark}{Remark}
\usepackage[a4paper, total={6in, 8in}]{geometry}
%\usepackage{minted}
\usepackage{tcolorbox}
\usepackage{todonotes}
\tcbuselibrary{minted,skins}

\newtcblisting{bashcode}{
  listing engine=minted,
  colback=bashcodebg,
  colframe=black!70,
  listing only,
  minted style=colorful,
  minted language=bash,
  minted options={linenos=true,texcl=true},
  left=1mm,
}
\definecolor{bashcodebg}{rgb}{0.85,0.85,0.85}
\usepackage{hyperref}
\begin{document}

\maketitle

\section{Introduction}

\todo{J: write up an orienting overview intro}

\section{Installing the book}
Here you will learn how to interact with the book. You will need to install Docker on your work machine, which you can install by clicking  \href{https://docs.docker.com/engine/install/}{here} or visiting \url{https://docs.docker.com/engine/install/}. Next, open the terminal and type in
\begin{minted}{bash}
  docker pull act4e/act4e-build:alphubel
\end{minted}
This should not produce any errors.


\subsection{Installing Git}
You will also need \texttt{git} to work with the book.Install it from \href{https://git-scm.com/book/en/v2/Getting-Started-Installing-Git}{here} or visit \url{https://git-scm.com/book/en/v2/Getting-Started-Installing-Git} \& follow the instructions for your operating system.

\begin{remark}
    Make a Github account, and make sure you are an accepted user for the ACT4E repository. You can check if you have access by visiting \href{https://github.com/ACT4E/ACT4E-solutions}{this} page (solutions page is only available to members of the ACT4E organisation\footnote{sounds cryptic, right?}).
\end{remark}

\subsubsection{Generating Access Token}
I actually have no clue how i did this, TODO.

\subsubsection{Cloning the Repository}

\todo{JB: one could also download GitHub Desktop and do the setup (cloning, own branch etc.) that way}

Next, you will clone the repository onto your computer. This will give you access to all the files from the book, so you can actually work with it. First off, open your terminal on the \textbf{desired folder you want the book to be in}. This can be done e.g. on MacOS by right clicking on a folder, and saying "Open Terminal in Folder". 

\begin{remark}
    You \textbf{cannot} have any whitespace or funny characters in your folder name. E.g. the name "ETH Book" does \textbf{not} work, as it contains a whitespace. The best option is just to call it "ACT" or something of the likes.
\end{remark}
\begin{itemize}
    \item Clone the repository by typing
\begin{bashcode}
  git clone --depth=1000 git@github.com:ACT4E/ACT4E.git
\end{bashcode}
or (preferred option)
\begin{bashcode}
  git clone https://github.com/ACT4E/ACT4E.git
\end{bashcode}
You should now have a folder called \texttt{ACT4E} in your initial folder. In our example, you would have the folder \texttt{ACT4E} inside the folder \texttt{ACT}. If you do not, you have not pulled from the repo. Please try again.
\item Next, open navigate \textbf{with the terminal} to the folder called ACT4E (e.g. by doing the right-click thing again) or by typing in the terminal
\begin{bashcode}
  cd ACT4E
\end{bashcode}
\item Clone the solutions reposiotory by typing
\begin{bashcode}
 git clone git@github.com:ACT4E/ACT4E-solutions.git
\end{bashcode}
or preferably
\begin{bashcode}
  git clone https://github.com/ACT4E/ACT4E-solutions.git
\end{bashcode}
\end{itemize}
You should now have the \texttt{CT4E-solutions} folder inside the \texttt{ACT4E} folder. It's a bit of a mess, but you should have it somewhere in there.

\section{Quick Tour of the Repository}
\subsection{Structure of the Repository}
The repository may seem quite daunting and complicated at first. And while that very well may be the case, I'll provide you here with a basic idea of the structure of the contents.
\begin{itemize}
\item The main LaTeX files for the book are in the \texttt{volumes/vol1} directory. Within this directory, the various categories of the book are split into different subdirectories. (I don't know why they're numbered like this or the logic behind TODO). The way they are organized is as follows: the main category of topics has various subfolders, which correspond to a book \textbf{chapter}. You will recognize whether a directory is a category or a chapter by checking if it contains the \texttt{chapter.tex} file.
\item The \texttt{sag} folder contains all \texttt{.tikz} files used for all LaTex-generated diagrams in the book. Contrast this to the \texttt{pics} folder which contains regular \texttt{.png}s, e.g. for the chapter covers.
\item \texttt{ACT4E-solutions} is the repository with all the exercises, solutions, exams and past homeworks. Its basically a big folder of \texttt{.tex} files, each corresponding to a solution to an exercise. There are a few subfolders here, corresponding to the homeworks of the respective semesters.
\end{itemize}

\subsection{CircleCI}

\todo{JB: maybe mention tabs are not allowed also we should mention that the users github account needs to be correctly connected to CircleCI}

CircleCI is a continuous integration and continuous delivery (CI/CD) platform that automates the process of building, testing, and deploying code. In the context of our research group's book project, CircleCI is set up to automatically run certain checks whenever you push changes to the repository.

Specifically, when you push your LaTeX code to the repository, CircleCI will:
\begin{itemize}
\item Automatically Trigger a Build: Every time you push changes, CircleCI will start a new build process. This process typically involves setting up the environment, installing dependencies, and then running specified tasks.

\item Check if LaTeX Code Compiles: As part of the build process, CircleCI will compile your LaTeX code. This ensures that any errors in the LaTeX files are caught early before they get merged into the main branch.

\item Provide Feedback: If the LaTeX code compiles successfully, the build will pass, and CircleCI will notify you accordingly. If there are errors in the LaTeX code, the build will fail, and CircleCI will provide logs and details about what went wrong, allowing you to quickly identify and fix issues.
\end{itemize}

By integrating CircleCI with our repository, we ensure that the LaTeX code for the book is always in a working state, which helps maintain the quality and consistency of the content across the team.


\section{Compiling \& working with the book}

\todo{JB: here we could mention TexShop or for people already coding with VS Code}

To interact with the book you \textbf{must} have Docker open. Just click on the icon, and let the app open. It should say "Docker is running" once it's done. It may take a few minutes to get started. You can now \textbf{from the} \texttt{ACT4E} \textbf{folder} type into the terminal
\begin{bashcode}
    make shell
\end{bashcode}
This should modifiy your terminal a bit, and your terminal will look like figure \ref{fig:enter-label}.
\begin{remark}
    We will use the computer science terminology of 'root folder' or just 'root' to designate where the repository has been cloned. This is the folder called \texttt{ACT4E}.
\end{remark}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.5\linewidth]{make-shell.png}
    \label{fig:enter-label}
    \caption{Expected Terminal display}
\end{figure}
\subsection{Compiling the entire book}
This is not recommended, it takes over an hour, but here's the command. From the root folder, type
\begin{bashcode}
    make ACT4E-devel-slow.pdf
\end{bashcode}
\subsection{Compiling a Chapter}
This is how you \textit{should} be working. From the root, type the command
\begin{bashcode}
    make -C volumes/vol1/10_arrows/10_cats/ chapter-continuous
\end{bashcode}
and swap out the folder names to whatever chapter you are working on. If no errors are flagged, the last line of the output of the terminal should be 
\begin{bashcode}
    === Watching for updated files. Use ctrl/C to stop ...
\end{bashcode}
\begin{remark}
    There will be a lot of warnings, that's fine. It's mostly references to other chapters of the book. As long as the output is as above, you're fine.
\end{remark}
\begin{remark}
    Don't forget you need to 
    \begin{enumerate}
        \item have Docker open and running
        \item have typed \texttt{make shell} in the root repo. Working from your basic shell will not work.
    \end{enumerate}
\end{remark}
Now, \textbf{keep the terminal open} and just edit the book in your editor of choice, and when you will hit \texttt{Ctrl+S}, the changes will be automatically detected and the chapter will be recompiled. Obviously, you'll have to close your PDF viewer, wait for compilation to be done, and reopen once it's done to see the changes. 

\section{Editing the book with Git}
If you've never used Git, please watch an introductory video on how it works / what it is. Here, i'll explain how you work with the book. You should use git from \textbf{your own shell, not the one used for compilation of the book}! For that reason, i recommend simply opening two terminals, one to edit, one to use git.
\subsection{Structure of the Repository}
The \texttt{ACT4E} repo has a bit of a complex structure. Here's a quick breakdown of what is where (only relevant folders for TAs).
\begin{itemize}
    \item \texttt{volumes/vol1|} contains the files for the current version of the book. The sub-folders within are not chapters, but 'meta' chapters (or categories!). It's the folder within that is actually a chapter (which you can compile). E.g. $\texttt{30\_design/15\_poset\_bounds}$ is a chapter, as you can also find the \texttt{chapter.tex} inside of it.
    \item \texttt{sag} contains \texttt{.tikz} files and their compiled PDFs that we use for the book
\end{itemize}
The ACT4E-solutions repo is for the solutions to the homework exercises. Each \texttt{.tex} file is a solution we use for corrections. Please don't touch them unless asked. There are also folders containing the homework sheets/exams of past \& current iterations of the course.
\subsection{Editing with Git}

\todo{JB: You can do all of these things also with GitHub Desktop, for people that don't like the terminal}

The way we work is with \texttt{git}. It's a version control software, allowing us to work remotely, and clump modifications together all at once. A few important things to know before you get started are
\begin{itemize}
\item The branch \texttt{alphubel-prod}
\end{itemize}
\subsubsection{Opening your branch}
Your branch is like your desk. You work on it, and only you. Other people may look, but it would be rude to use it. If you don't have a branch yet, type
\begin{bashcode}
     git checkout -b your-new-branch-name
\end{bashcode}
and you can verify that you're on it by typing
\begin{bashcode}
    git branch
\end{bashcode}
The above will display the various branches you've opened on your computer. Not all the ones on the repo. The branch \texttt{alhubel-prod} is the publicly available version of the book, and \texttt{alphubel-stage} is where all the changes are sent to and merged into, before being double-checked and added to \texttt{alphubel-prod}. It's basically the 'final draft' branch. We do not work directly from this branch, but we 'pull' from it, to update our branch when needed.
\subsubsection{Before you start editing}
Open the terminal in the root repo, and type 
\begin{bashcode}
    git pull 
\end{bashcode}
This will just check that you have the latest version of the branch you're on. You can skip this step if you're not pulling from \texttt{alphubel-stage}. Next, check that everything is okay by typing
\begin{bashcode}
    git status
\end{bashcode} 
This will show you if any modifications or unsaved changes are on your branch.
\subsubsection{After you've edited the book}
Now, type in
\begin{bashcode}
    git add .
    git commit -m"your commit message"
\end{bashcode}
and finally, if this is your first time pushing to this branch
\begin{bashcode}
    git push --set-upstream origin your-branch-name
\end{bashcode}
or just 
\begin{bashcode}
    git push
\end{bashcode}
This will 'send' everything to the repo.
\begin{remark}
    To improve efficiency, PDF files are neither pushed nor pulled, thanks to \texttt{.gitignore} files (you don't need to worry about that, though).
\end{remark}

\section{Exercises}
Generally, in the book, there are two kinds of exercises: “regular” exercises and “graded” exercises. The regular ones have solutions that are written directly in the \texttt{.tex} files of the book, while the graded exercises have solutions written in a separate \texttt{.tex} file that is in the \texttt{ACT4E-solutions} repo. The graded exercises are used both in the book, and also for homework sheets that are created each semester for the teaching at ETH.

\subsection{Compiling the Exercises}

\todo{JB: here TexShop (does not need brew) or VS Code are also good options}

For the exercise sheets (and this document, additionally), we do not compile lie the book. Instead we use \texttt{pdflatex}. 
\subsubsection{Installing PDFLaTeX}
Open your terminal, and if you are on Mac\footnote{This assumes you have \texttt{brew} installed. If you don't, then please do?}, type 
\begin{bashcode}
    brew install --cask mactex
 \end{bashcode}
 and check that is has been installed by typing 
 \begin{bashcode}
    pdflatex --version
\end{bashcode}
\subsubsection{Compiling}
This is much more straightforward. From the directory \textbf{where you wish the .pdf to be produced}, open the terminal (or navigate there) and type the following command
\begin{bashcode}
    gpdflatex -shell-escape name-of.document.tex
\end{bashcode}
Obviously, if you are not in the directory where your file is, insert the path to the \texttt{.tex} file.
\newpage
\end{document}
