% !TEX root = ../ACT4E-devel-fast.tex

\surroundwithmdframed[
    backgroundcolor=none,
    topline=false,
    rightline=false,
    bottomline=false,
    leftmargin=-10pt,
    skipabove=0pt,
    skipbelow=0pt
]{proof}
%\surroundwithmdframed[
%  backgroundcolor=none,
%  topline=false,
%  rightline=false,
%  bottomline=false,
%  leftmargin=2pt,
%  skipabove=0pt,
%  skipbelow=0pt
%]{remark}
%\newenvironment{remark}{\textbf{Remark}}{\medskip}

\newlength{\mysep}
\setlength{\mysep}{2pt}

\newtheoremstyle{break}
{\mysep} % space above (empty=default)
{\mysep}% space below (empty=default
{}% body font
{}% Indent amount (empty = no indent, \parindent = para indent)
{\bfseries}% Thm head font
{}% Punctuation after thm head
{\newline}% Space after thm head: \newline = linebreak
{}% Thm head spec

% how to remove parentheses
%\makeatletter
%\def\thmhead@plain#1#2#3{%
%  \thmname{#1}\thmnumber{\@ifnotempty{#1}{ }\@upn{#2}}%
%  \thmnote{ {\the\thm@notefont#3}}}
%\let\thmhead\thmhead@plain
%\makeatother

\theoremstyle{definition}


\newtheorem{theorem}{Theorem}[chapter]
\newtheorem*{theorem*}{Theorem}

\newtheorem{proposition}[theorem]{Proposition}
\newtheorem*{proposition*}{Proposition}
\newtheorem{corollary}[theorem]{Corollary}

\newtheorem{lemma}[theorem]{Lemma}
\newtheorem*{lemma*}{Lemma}

\newtheorem*{problem}{Problem}
\newtheorem{remark}[theorem]{Remark}

\newtheorem{construction}[theorem]{Construction}
\newtheorem{example}[theorem]{Example}
\newtheorem{counterexample}[theorem]{Counter-example}

%\theoremstyle{remark}
\newtheorem*{warning}{Warning}
\newtheorem{homework}{Homework}[chapter]
%\newtheorem{remark}[theorem]{Remark}
%\newtheorem{warning}[theorem]{Warning}

\theoremstyle{break}

\newtheorem{definition}[theorem]{Definition}
\newtheorem*{definition*}{Definition}



\surroundwithmdframed[
    backgroundcolor=LightGray!30,
    roundcorner=4pt,
    linewidth=0pt
]{definition}

\newtheorem{ctdefinition}[theorem]{Definition}

% \newenvironment{definition}
%    {\colorlet{shadecolor}{blue!25}\begin{shaded}\begin{protodefinition}} % light blue for lemmas only
%    {\end{protodefinition}\end{shaded}}
%\newenvironment{ctdefinition}
%{\colorlet{shadecolor}{LightBlue!50}\begin{shaded*}
%                                      \begin{protodefinition}} % light blue for lemmas only
%                                      {\end{protodefinition}
%\end{shaded*}}
%


\surroundwithmdframed[
    backgroundcolor=LightBlue!30,
    roundcorner=4pt,
    linewidth=0pt
]{ctdefinition}

% This line blocks compilation
%\surroundwithmdframed[
%    backgroundcolor=red!20,
%    roundcorner=4pt,
%    linewidth=0pt
%]{exercise}


% \newtheorem{ctdefinition}[theorem]{Definition}


\newenvironment{ctdefinitionshade}
{\colorlet{shadecolor}{LightBlue!50}\begin{shaded*}
}%
{
\end{shaded*}}



\newcounter{exercise}[part]
% \newtheorem{protoexcercise}[exercise]{Exercise}
% \newcounter{exercisecounter}[part]
% \newtheorem{gradedexercise}[exercisecounter]{Graded exercise}
\newtheorem{gradedexercise}{Graded exercise}[part]


%
% \newenvironment{gradedexercise}
% {\colorlet{shadecolor}{LightGreen!50}\begin{shaded*}
%                                       \begin{protogradedexcercise}} %
%                                       {\end{protogradedexcercise}
% \end{shaded*}}


\surroundwithmdframed[
    backgroundcolor=LightGreen!30,
    roundcorner=4pt,
    linewidth=0pt
]{homework}

\surroundwithmdframed[
    backgroundcolor=LightGreen!30,
    roundcorner=4pt,
    linewidth=0pt
]{gradedexercise}


\newenvironment{body}{\par}{}
\newtheorem{codeexercise}{Code exercise}[part]

% \newtheorem{codeexercise}[exercisecounter]{Code exercise}
%
% \newenvironment{codeexercise}
% {\colorlet{shadecolor}{LightGreen!50}\begin{shaded*}
%                                       \begin{protocodeexercise}} %
%                                       {\end{protocodeexercise}
% \end{shaded*}}


\surroundwithmdframed[
    backgroundcolor=Purple!30,
    roundcorner=4pt,
    linewidth=0pt
]{codeexercise}


\newenvironment{gradedsolution}
{\colorlet{shadecolor}{LightPink!20}\begin{shaded*}}{\end{shaded*}}


% We cannot do this if we put figures inside of examples.
% \surroundwithmdframed[
%   topline=false,
%   rightline=false,
%   bottomline=false,
%   %leftmargin=\parindent,
%   %skipabove=\medskipamount,
%   %skipbelow=\medskipamount
% ]{example}

\newcommand{\classlisting}[1]{%
    \begin{longcode}
        \centering%
        \caption{The \classname{#1} interface.}%
        \vspace{-0.5cm}
        \label{lst:#1}%
        \classsource{#1}{}%
    \end{longcode}%
}

\newcommand{\solutionof}[1]{%
    \instructors{%
        \IfFileExists{\rootdir/ACT4E-solutions/CatProductPowerSet.tex}{
            \IfFileExists{\rootdir/ACT4E-solutions/#1.tex}{
                \input{\rootdir/ACT4E-solutions/#1.tex}
            }{
                \textbf{You need to create file ACT4E-solutions/#1.tex}
            }
        }{
            \textbf{You need to checkout the repo ACT4E-solutions}
        }
    }%
}


\newcommand{\linkvideo}[1]{%
    \StrSubstitute{#1}{:}{_}[\result]
    \input{\rootdir/videos/generated/\result/watch}%
}


%
\newcommand{\watch}[5]{%
    \marginnote{
        \centering
        \href{#1}{Watch: \emph{#2} (#3).}\\
        \href{#1}{\fbox{\includegraphics[height=2.5cm]{#4}}}\\%
        \vspace{-1.8cm}
        \hspace{-3.3cm}\href{#1}{\includegraphics[height=2cm]{#5}}%
    }%
}

\newcommand{\publictodomessage}{%
    \begin{publictodo}
        We are working on this section, and more content will appear.
    \end{publictodo}%
}
\newcommand{\missingsolution}{%
    \begin{publictodo}
        Solution is missing.
    \end{publictodo}%
}

\newcommand{\missingproof}{%
    \begin{publictodo}
        Proof is missing.
    \end{publictodo}%
}
\newcommand{\aligninner}[1]{
    \Ifthispageodd{%
        #1
        \hfill
    }{%
        \hfill
        #1
    }%
}

% https://ethidsc.atlassian.net/browse/ACT4EBOOK-264
\newenvironment{publictodo}
{
    \begin{marginfigure}[+5mm]
        \aligninner{%
            \includegraphics[width=0.8cm]{construction-cone}
        }
    \end{marginfigure}
    \colorlet{shadecolor}{yellow!50}
    \begin{shaded*}%
    }%
    {%
    \end{shaded*}%
}
\newcommand{\wrapit}[1]{%
    #1
% \adjustbox{scale=0.9}{#1}%
}
\DeclareRobustCommand{\todographics}[1]{\wrapit{\todo[color=green!70]{#1}}}
\DeclareRobustCommand{\todotext}[1]{\wrapit{\todo[color=blue!50]{#1}}}
\DeclareRobustCommand{\todomistake}[1]{\wrapit{\todo[color=red!30]{\color{purple}#1}}}
\DeclareRobustCommand{\todostructure}[1]{\wrapit{\todo[color=purple!50]{#1}}}

\DeclareRobustCommand{\todojira}[2]{\todo{\href{https://ethidsc.atlassian.net/jira/software/c/projects/ACT4EBOOK/issues/ACT4EBOOK-#1}{ACT4EBOOK-#1}: #2}}
\DeclareRobustCommand{\todographicsjira}[2]{\todographics{\href{https://ethidsc.atlassian.net/jira/software/c/projects/ACT4EBOOK/issues/ACT4EBOOK-#1}{ACT4EBOOK-#1}: #2}}
\DeclareRobustCommand{\todostructurejira}[2]{\todostructure{\href{https://ethidsc.atlassian.net/jira/software/c/projects/ACT4EBOOK/issues/ACT4EBOOK-#1}{ACT4EBOOK-#1}: #2}}
\DeclareRobustCommand{\todotextjira}[2]{\todotext{\href{https://ethidsc.atlassian.net/jira/software/c/projects/ACT4EBOOK/issues/ACT4EBOOK-#1}{ACT4EBOOK-#1}: #2}}
\DeclareRobustCommand{\todomistakejira}[2]{\todomistake{\href{https://ethidsc.atlassian.net/jira/software/c/projects/ACT4EBOOK/issues/ACT4EBOOK-#1}{ACT4EBOOK-#1}: #2}}

\newcommand{\todousedefinemap}{
    \todotextjira{498}{Use the proper definemap macro.}
}

\makeatletter
\newcommand{\iflabelexists}[2]{%
    \ifbool{devel}{%
        \@ifundefined{r@#1}{%
        % \todotext{label #1 not defined}%
        % #2%
        }{#2}%
    }{%
        \@ifundefined{r@#1}{}{#2}%
    }%
}
\newcommand{\iflabeldoesnotexist}[2]{%
    \@ifundefined{r@#1}{%
        #2%
    }{}%
}
\newcommand{\ifelselabeldefined}[3]{%
    \@ifundefined{r@#1}{#3}{#2}%
}
\makeatother







\newenvironment{forslides}{%
    \colorlet{shadecolor}{Pink!50}%
    \begin{shaded*}%
        \textbf{This content was created for slides. Do not erase or change the names}.\\%
        }{%
    \end{shaded*}}

%%%%%%%%%%%%%%%%%%%%
% Fail the compilation if using \XXX in non-devel
%
\AtBeginDocument{
    \ifbool{devel}{
        \newcommand{\XXX}{{\color{red}XXX}\xspace}
    }{
        \def\XXX{
            \PackageError{ACT4E}{You have included XXX in a non-devel version.}{We interrupt compilation.}
        }
    }
}
\newcommand{\citeXXX}{{\color{red}[cite]}\xspace}


% \def\parttoc{{\color{red} disabled because of kaobook}}
% \def\minitoc{{\color{red} disabled because of kaobook}}


%%%%%%%%%%%%%%%%%%%%
% Line breaks in formulas
%

% \newcommand{\lb}{\linebreak[0]} % allow linebreak in formula
\newcommand{\com}{,\linebreak[0]}% Use this as a comma that can have a line break after

% \makeatletter
% % Centered captions for all floats
%
% % Settings for paragraphs in the margins
% \renewcommand{\@margin@par}{%
%     \centering% justify text
%     \setlength{\RaggedRightParindent}{0em}% Suppress indentation
%     \setlength{\parindent}{0em}% Suppress indentation
%     \setlength{\parskip}{0.5pc}% Set the space between paragraphs
%     %\singlespacing% Set the space between lines
%     \frenchspacing% No additional space after periods
%     \normalfont% Use the default font
%     \footnotesize% Use a smaller size
% }
%
% \makeatother
% Centered contents for margintable
%
% \RenewDocumentEnvironment{margintable}{o}{%
%   \FloatBarrier
%   \marginskip{\kaomarginskipabove}%
%   \begin{lrbox}{\@sidenotes@margintablebox}%
%     \begin{minipage}{\marginparwidth}%
%       \captionsetup{type=table}%
%       \centering
% }{%
%     \end{minipage}%
%   \end{lrbox}%
%   \marginnote[#1]{\usebox{\@sidenotes@margintablebox}}%
%   \marginskip{\kaomarginskipbelow}%
% }


\AtBeginDocument{
    \renewcommand\theequation{\arabic{equation}}
    \renewcommand\thefigure{\arabic{figure}}

}


\newenvironment{hint}
{\emph{Hint:}~}{}


\newcommand{\codeboilerplate}[2]{
    \begin{codeexercise}[\exname{Test#1}]
        #2

        Implement the interface in \cref{lst:#1}.

        Test using:

        \checkexercise{#1}
    \end{codeexercise}
}

\newcommand{\checkexercise}[1]{
    \par
    \texttt{\footnotesize\ \ \ act4e-check Test#1}
}


\newcommand{\fitinmargin}[1]{%
    \maxsizebox{\marginparwidth}{!}{#1}%
}

\newcommand{\fitinline}[1]{%
    \maxsizebox{\textwidth}{!}{#1}%
}

\newcommand{\fitinpage}[1]{%
    \maxsizebox{\textwidth+\marginparwidth}{!}{#1}%
}


\newcommand{\linkifexists}[1]{
    \iflabelexists{#1}{\cref{#1}}
}



\makeatletter
\newcommand{\coloruline}[2]{%
    \newcommand\temp@reduline{\bgroup\markoverwith%
    {\textcolor{#1}{\rule[-0.1ex]{2pt}{0.4pt}}}\ULon}%
    \temp@reduline{#2}%
}

\newcommand{\coloruuline}[2]{%
    \UL@protected\def\temp@uuline{\leavevmode \bgroup%
    \UL@setULdepth%
    \ifx\UL@on\UL@onin \advance\ULdepth2.8\p@\fi%
    \markoverwith{\textcolor{#1}{\lower\ULdepth\hbox%
    {\kern-.03em\vbox{\hrule width.2em\kern1\p@\hrule}\kern-.03em}}}%
    \ULon}%
    \temp@uuline{#2}%
}

\newcommand{\coloruwave}[2]{%
    \UL@protected\def\temp@uwave{\leavevmode \bgroup%
    \ifdim \ULdepth=\maxdimen \ULdepth 3.5\p@%
    \else \advance\ULdepth2\p@%
    \fi \markoverwith{\textcolor{#1}{\lower\ULdepth\hbox{\sixly \char58}}}\ULon}%
    \font\sixly=lasy6 % does not re-load if already loaded, so no memory drain.
    \temp@uwave{#2}%
}


\definecolor{symbol-underline}{RGB}{232,235,207}

\DeclareRobustCommand{\SY}[1]{\SYN{#1}{#1}}
\DeclareRobustCommand{\SYNDEF}[1]{%
    \pgfkeysifdefined{/mydefs/#1/index}{%
        \index{\pgfkeysvalueof{/mydefs/#1/index}|textbf}
    }{%
        \typeout{SYN: Warning: cannot match the value (#1) to any existing entry.}%
    }%
}
\DeclareRobustCommand{\SYN}[2]{%
    \SYNinner{#1}{#2}\xspace%
}
\DeclareRobustCommand{\SYNindex}[1]{%
    \pgfkeysifdefined{/mydefs/#1/index}{%
        \relax\ifmmode\else%
        \index{\pgfkeysvalueof{/mydefs/#1/index}}%
        \fi%
    }{%
        \typeout{SYN: Warning: cannot match the value (#1) to any existing entry.}%
    }%
}
\DeclareRobustCommand{\SYNinner}[2]{%
    \SYNindex{#1}%
    \SYNlink{#1}{#2}%
}

\DeclareRobustCommand{\SYNlink}[2]{%
    \pgfkeysifdefined{/mydefs/#1/index}{%
        \pgfkeysifdefined{/mydefs/#1/label}{%
            \IfSubStr{\pgfkeysvalueof{/mydefs/#1/label}}{target:}{%
                 \texorpdfstring{%
                        \hypersetup{colorlinks=false}%
                        \protect\hyperlink{\pgfkeysvalueof{/mydefs/#1/label}}{%
                            \relax\ifmmode%
                            #2\else%
                            \ifbool{devel}{%
                                    {\color{blue}#2}%
                            }{%
                                #2%
                            % \coloruline{symbol-underline}{#2}%
                            }%
                            \fi%
                        }%
                    }{%
                        #2%
                    }%
            }{ %
                \ifelselabeldefined{\pgfkeysvalueof{/mydefs/#1/label}}{%
                    \texorpdfstring{%
                        \hypersetup{colorlinks=false}%
                        \protect\hyperref[\pgfkeysvalueof{/mydefs/#1/label}]{%
                            \relax\ifmmode%
                            #2\else%
                            \ifbool{devel}{%
                                    {\color{blue}#2}%
                            }{%
                                #2%
                            % \coloruline{symbol-underline}{#2}%
                            }%
                            \fi%
                        }%
                    }{%
                        #2%
                    }%
                }{%
                    \typeout{SYN: Warning: label (\pgfkeysvalueof{/mydefs/#1/label}) is not found in this document.}%
                    #2%
                }%
            }%
        }{%
            \typeout{SYN: Warning: there is no label associated to (#1).}%
            \relax\ifmmode%
            #2%
            \else%
            \ifbool{devel}{%
                    {\color{red}#2}%
            }{%
                #2%
            }%
            \fi%
        }%
    }{%
        \typeout{SYN: Warning: cannot match the value (#1) to any existing entry.}%
        #2%
    }%
}
\newcommand{\SYDEFone}[3]{%
    \ifstrempty{#2}{}{%
        \pgfkeysifdefined{/mydefs/#1/label}{%
            \typeout{SYN: Error: term (#1) already present.}%
        }{%
            \pgfkeyssetvalue{/mydefs/#1/label}{#2}%
        }%
    }%
    \pgfkeysifdefined{/mydefs/#1/index}{%
        \typeout{SYN: Error: index for (#1) already present.}%
    }{%
        \pgfkeyssetvalue{/mydefs/#1/index}{#3}%
    }%
}
\newcommand{\SYDEF}[3]{%
    \@for\@ii:=#1\do{%
        \SYDEFone{\@ii}{#2}{#3}%
        \SYDEFone{\@ii s}{#2}{#3}%
    }%
}
\newcommand{\maindef}[1]{%
    \SYNDEF{#1}\emph{#1}%
}


% https://tex.stackexchange.com/questions/466026/test-if-current-c
% olor-is-black


\ExplSyntaxOn

\NewDocumentCommand{\wrapcmd}{mm}
{
    \andreacensi_wrapcmd:Ncn #1 {andreacensi@\cs_to_str:N #1} { #2 }
}
\cs_new_protected:Nn \andreacensi_wrapcmd:NNn
{
    \NewCommandCopy #2 #1
    \renewcommand #1 {\SYNlink{#3}{#2}}
}
\cs_generate_variant:Nn \andreacensi_wrapcmd:NNn { Nc }


\NewDocumentCommand{\wrapcmdnopar}{mm}
{
    \andreacensi_wrapcmdnopar:Ncn #1 {andreacensinopar@\cs_to_str:N #1} { #2 }
}
\cs_new_protected:Nn \andreacensi_wrapcmdnopar:NNn
{
    \NewCommandCopy #2 #1
    \renewcommand #1 {\SYNlink{#3}{#2}}
}
\cs_generate_variant:Nn \andreacensi_wrapcmdnopar:NNn { Nc }

\NewDocumentCommand{\wrapcmdalsoindex}{mm}
{
    \andreacensi_wrapcmdalsoindex:Ncn #1 {andreacensialsoindex@\cs_to_str:N #1} { #2 }
}
\cs_new_protected:Nn \andreacensi_wrapcmdalsoindex:NNn
{
    \NewCommandCopy #2 #1
    \renewcommand #1 {\SYNlink{#3}{#2}}
}
\cs_generate_variant:Nn \andreacensi_wrapcmdalsoindex:NNn { Nc }

\ExplSyntaxOff
%
% \renewcommand{\wrapcmd}[2]{%
%     % \expandafter\let\csname  old#1\expandafter\endcsname\csname #1\endcsname%
%     % \expandafter\renewcommand\csname #1\endcsname{\SYNlink{#2}{{\csname old#1\endcsname}}}%
% }

% \renewcommand{\wrapcmdnopar}[2]{%
%     % \expandafter\let\csname  old#1\expandafter\endcsname\csname #1\endcsname%
%     % \expandafter\renewcommand\csname #1\endcsname{\SYNlink{#2}{\csname old#1\endcsname}}%
% }
