% !TEX root = ../ACT4E-devel-fast.tex

\pdfminorversion=7
\pdfinclusionerrorlevel=1


%%% HACKS for kaobook

\let\providelength\relax
\let\openbox\relax

%\newcommand*\flrow@error[1]{\PackageError\flrow@package{#1}\flrow@eh}
\makeatletter
\renewcommand\flrow@error[1]{}
\makeatother


\usepackage{xr}

\usepackage[dvipsnames]{xcolor}
\usepackage[capitalize]{cleveref}




%
\RedeclareSectionCommand[
  beforeskip=10pt,
  afterskip=0pt,
%  headings=normal,
  style=chapter% no part page
]{part}

%
\RedeclareSectionCommand[
  beforeskip=10pt,
  afterskip=5pt,
%  headings=normal,
  style=section% no part page
]{section}


%\usepackage{scrpage2}  %<---
\usepackage{scrlayer-scrpage}
\usepackage[usenames,dvipsnames,table]{xcolor}
%\usepackage[table,svgnames]{xcolor}


\usepackage{pdfpages}
\setlength\parindent{0pt}
\setlength\parskip{3pt}
% used for printing 400 page book
% \usepackage[width=6in, height=9in, top=1.8cm,  bottom=0.8cm,  outer=0.8cm, inner=2.0cm]{geometry}
% used for printing on feb14 (soft + hardcover)
%\usepackage[width=6in, height=9in, top=1.95cm,  bottom=0.95cm,  outer=1.1cm, inner=1.4cm]{geometry}

% trying to go 8x10
%\usepackage[width=8.125in, height=10.250in, top=1.95cm,  bottom=0.95cm,  outer=1.8cm, inner=1.6cm]{geometry}

%\usepackage[width=8.125in, height=10.250in, top=1.95cm, textwidth=10cm, bottom=0.95cm,  outer=1.8cm, inner=1.6cm]{geometry}

% showframe shows the useful margins
% I wish it to make it gray but cannot
% find the way
% https://tex.stackexchange.com/questions/164521/change-color-pitch-line-style-of-showframe-geometry-package

\pagenumbering{arabic}

\renewcommand{\thepart}{\Alph{part}}

\usepackage{marginnote}

\usepackage{fancyvrb}
\newcommand{\outsnippet}[3]{
  \UseVerbatim{#1}
}


\usepackage[backend=bibtex]{biblatex}
\addbibresource{\rootdir/dpcatbib.bib}



\usepackage{ifthen}
\usepackage{iftex}
\usepackage{ifxetex}
\ifxetex
\else
\usepackage[utf8]{inputenc}
\fi

\usepackage{subcaption}

\usepackage{blkarray, array}




\usepackage[english]{babel}
\usepackage[T1]{fontenc}
\usepackage{lipsum}
\usepackage{xspace}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb} % conflict with mathdesign
\usepackage{mathtools}
\usepackage{multirow}
\usepackage{prftree}


\setlength{\prflinepadbefore}{0.9ex}
\setlength{\prflinepadafter}{0.6ex}
\setlength{\prflinethickness}{1.5pt}
\setlength{\prfdoublelineinterspace}{0.2pt}
\usepackage{comment}
\usepackage{accents}
\usepackage[style=russian]{csquotes}


\usepackage{ebproof}
\usepackage{units}


%\usepackage[%
%  pdftitle={Applied Compositional Thinking for Engineers},
%  pdfkeywords={Applied Category Theory},
%  colorlinks = true,
%  linkcolor = black,
%  citecolor = darkblue,
%  urlcolor  = darkblue]{hyperref}
%\usepackage{framed}


%\usepackage[obeyFinal]{todonotes} % after xcolor
\presetkeys{todonotes}{inline}{}
%\presetkeys{todonotes}{noinline}{}
%\presetkeys{todonotes}{size}{\tiny}

\usepackage{pgfplots}
\pgfplotsset{compat=1.16}
% \pgfplotsset{compat=1.17}
\usepackage[framemethod=TikZ]{mdframed}
\usepackage{graphicx}
\usepackage{calc}

\providecommand{\rootdir}{.}

% Note we need to add also relative paths for the tiks in sag to compile independently .
\graphicspath{
    {\rootdir/figures/},
    {\rootdir/pics/},
    {\rootdir/slides/},
    {\rootdir/videos/generated/},
    {\rootdir/figures/reits/},
    {\rootdir/figures/firstpaper/},
    {\rootdir/figures/uncertainty/},
    {\rootdir/papers/uncertainty/},
    {},
    {../}}
\usepackage{adjustbox}

% means all figures need to be placed before next section starts


\usepackage[section]{placeins}
\usepackage{eso-pic}
\usepackage{capt-of}
\usepackage{wrapfig}
\usepackage[normalem]{ulem}
\usepackage{newclude}
\usepackage{refstyle}

% \usepackage{breqn}
%
%
%\usepackage[shortlabels]{enumitem}
%\setitemize{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}
%\setenumerate{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}

%%%% FONTS
\usepackage[notextcomp]{stix2}
\usepackage{skull} % skull
% \usepackage{fdsymbol} % heart, spades, ...
% \usepackage{txfonts}
% \usepackage{mathrsfs} % conflict with mathdesign
\usepackage{stmaryrd}
\usepackage{pifont}
% \usepackage[utopia]{mathdesign} % conflict with mathrsfs



\usepackage{relsize}
\providecommand{\tabularnewline}{\\}
\providecommand{\acronym}[1]{\textsc{#1}\xspace}


%%%%%%%%%%%%%%%%%%%%% Typography / fonts


%\usepackage[tracking=true,kerning=true,spacing=true,final,factor=1100]{microtype}

%\ifxetex
%% \usepackage{fontspec}
%% \usepackage[protrusion=true,tracking=false,kerning=false,spacing=false]{microtype}
%\usepackage[protrusion=true,tracking=false,kerning=false,spacing=false]{microtype}
%\else
%
%\usepackage[tracking=true,kerning=true,spacing=true,final,factor=1100]{microtype}
%
%% This is the most stretched...
%% \usepackage[activate={true,nocompatibility},tracking=false,kerning=true,spacing=true,stretch=30,final,babel,factor=1100]{microtype}
%\pdfprotrudechars=2
%\pdfadjustspacing=2
%% \newfontfeature{Microtype}{protrusion=default;expansion=default;}
%% \directlua{fonts.protrusions.setups.default.factor=.5}
%
%\fi

% % cache the tikz
%\usetikzlibrary{external}
%\tikzexternalize[prefix=tikz-cache/]


\usepackage{makeidx}
\makeindex



%\usepackage{minitoc}
\usepackage{import}


%\usepackage{fontawesome}
%\def\faBtc{\FA\symbol{"F15A}}
%\usepackage{eurosym}
%\let\EUR\relax



\newcommand{\pointsize}{0.06}

\newboolean{statuscolors}
\newboolean{instructors}
\newboolean{showslides} % show slides-only materials
\newboolean{debugimages}
\newboolean{cachepdf}
\newboolean{devel} % print devel stuff

\newboolean{codeexercises}
\usepackage{longtable}

%% Formatting operations %%
%\newcommand{\instructors}[1]{\ifthenelse{\boolean{instructors}}{%
%    {\color{instructors} \hfill \rule{0.3\textwidth}{1pt} \hfill  $\downarrow$ instructors only $\downarrow$ \hfill  \rule{0.3\textwidth}{1pt} \hfill  } %
%  #1%
%{\color{instructors} \hfill \rule{0.3\textwidth}{1pt} \hfill  $\uparrow$ instructors only $\uparrow$ \hfill  \rule{0.3\textwidth}{1pt} \hfill  } %
%}{}}

\newcommand{\instructors}[1]{\ifthenelse{\boolean{instructors}}{%
%    {\color[rgb]{0,0,0.3}\sffamily
  #1
%  \pagecolor{LightGreen!20}
%  \clearpage
%\pagecolor{white}
%  }
}{}}

\newcommand{\showslides}[1]{\ifthenelse{\boolean{showslides}}{#1}{}}
\newcommand{\devel}[1]{\ifthenelse{\boolean{devel}}{%
  \clearpage
  \pagecolor{yellow!7}
%  \textbf{From here is under development}
#1
%\vfill
%\textbf{To here is under development}%
  \clearpage
\pagecolor{white}
}{}
}


\newcommand{\codeexercises}[1]{%
  \ifthenelse{\boolean{codeexercises}}{%
  \clearpage
\pagecolor{blue!7}
%  \textbf{From here is under development}
#1
%\vfill
%\textbf{To here is under development}%
  \clearpage
\pagecolor{white}
  }{}%
}

% Typesetting


\newcommand*{\vcenteredhbox}[1]{\begingroup
\setbox0=\hbox{#1}\parbox{\wd0}{\box0}\endgroup}

\newcommand{\captionsideleft}[2]{
  \medskip
  \begin{minipage}{1.8cm}{
    \hfill
    \protect\captionof{figure}{#1}}\end{minipage}
  \begin{minipage}{6.6cm}
    \vcenteredhbox{{#2}}
    \hfill
  \end{minipage}
  \medskip
}



\newcommand{\chaptersecond}[4]{
  \setchapterpreamble[u]{\margintoc}
  \setchapterimage[10cm]{#2} % Optionally specify the height
  \chapter{#1}
\vfill
  \begin{quote}
    #4%
  \end{quote}%
\vfill\vfill
  % \IfFileExists{\rootdir/pics/#2.tex}{
  \blfootnote{\input{\rootdir/pics/#2.tex}}
%  \etocsetnexttocdepth{section}
  % }{#3}
}

\setcounter{margintocdepth}{\sectiontocdepth}

\newlength\tocrulewidth
\setlength{\tocrulewidth}{1.5pt}


\newcommand{\partfirstb}[4]{
%\pagelayout{fullwidthpage}
\part{#1}%
%\fullwidthpage
%\includegraphics[width=\paperwidth,height=10cm,keepaspectratio=true]{#2}
%\includegraphics[width=\paperwidth,height=10cm,keepaspectratio=true]{#2} %viewport=0 0 10cm 15cm]{#2}
\includegraphics[height=10cm]{#2}
%\setchapterimage[10cm]{#2}
%\centering
%{\begin{minipage}{0.9\textwidth}
  \blfootnote{\input{\rootdir/pics/#2.tex}}
  \smallskip%
  {\small #3}%
  #4
    \etocsettocstyle{\rule{\linewidth}{\tocrulewidth}\vskip0.5\baselineskip}{\rule{\linewidth}{\tocrulewidth}}
 \etocsetnexttocdepth{chapter}
  \localtableofcontents
%   \end{minipage}}
%\pagelayout{margin}
}

\newcommand{\tableColors}{\rowcolors{2}{green!4}{blue!4}}
\newcommand{\tableColorsTwo}{\rowcolors{3}{green!4}{blue!4}}
\newcommand{\dpiconwidth}{1.1cm}


\newcommand{\nomencsectionname}[1]{\rule{0pt}{4mm}\textbf{#1}}
\newcommand{\nomencsubsectionname}[1]{\rule{0pt}{4mm}\emph{#1}}
\newcommand{\unused}{{\color{red}unused}~}


%\captionsetup[subtable]{font={rm,md,sc,footnotesize},position=top}
%\captionsetup[figure]{font=small,position=bottom}
%\setlength{\abovecaptionskip}{0pt}
%\setlength{\belowcaptionskip}{0pt}
%
%\setlength{\columnsep}{10pt}
%\setlength{\intextsep}{2pt}
%



% just to quiet a warning
\Crefname{BackrefHyperFootnoteCounter}{-}{-}

% only make equations ref say (1) rather than Eq. (1)
\crefformat{equation}{(#2#1#3)}
% except start sentence
\Crefformat{equation}{Equation~(#2#1#3)}

\usepackage{bbding}

% make compact part-level tocs
%\renewcommand{\beforeparttoc}{\empty}
%\renewcommand{\afterparttoc}{\empty}
%\renewcommand{\ptctitle}{\empty}
% to avoid page break after part
\makeatletter
\def\@endpart{ }

\makeatother

\usepackage{multicol}

%\setlength{\textwidth}{12.5cm}

%
%\usepackage{nameref}
%\usepackage[amsmath]{ntheorem}
%\usepackage{thmtools}
%
%\makeatletter
%\newcommand{\nref}[1]{\cref{#1}\mynameref{#1}{\csname r@#1\endcsname}}
%\newcommand{\Nref}[1]{\Cref{#1}\mynameref{#1}{\csname r@#1\endcsname}}
%
%\def\mynameref#1#2{%
%  \begingroup
%    \edef\@mytxt{#2}%
%    \edef\@mytst{\expandafter\@thirdoffive\@mytxt}%
%    \ifx\@mytst\empty\else
%    \space(\nameref{#1})\fi
%  \endgroup
%}
%\makeatother

%\usepackage{morse}
%
%\usepackage[
%  % set width and height to a4 width and height + 6mm
%  width=9in, height=11in,
%  % use any combination of these options to add different cut markings
%  cam, axes, frame, cross,
%  % set the type of TeX renderer you use
%  pdftex,
%  % center the contents
%  center
%]{crop}
%


%\usepackage{pgf}
%\usepackage{pgfpages}
%
%\pgfpagesdeclarelayout{boxed}
%{
%  \edef\pgfpageoptionborder{3pt}
%}
%{
%  \pgfpagesphysicalpageoptions
%  {%
%    logical pages=1,%
%  }
%  \pgfpageslogicalpageoptions{1}
%  {
%    border code=\pgfsetlinewidth{0.5pt}\pgfstroke,%
%    border shrink=0pt,%
%    resized width=8in,%
%    resized height=10in,%
%    center=\pgfpoint{.5\pgfphysicalwidth}{.5\pgfphysicalheight}%
%  }%
%}
%\pgfpagesuselayout{boxed}


\newcommand{\partended}{
\chapter*{Solutions to selected exercises}
\printsolutions}


\usepackage{caption}
\newenvironment{longcode}{\captionsetup{type=listing,justification=centering}}{}


\usepackage[outer]{showlabels}
%
%\AtBeginDocument{
%\renewcommand{\showlabels}[1]{}
%}

\renewcommand{\showlabelfont}{%
  \footnotesize\color{gray}%
}

\usepackage{ifmtarg}

\allowdisplaybreaks[4]


\AtBeginDocument{
  \etocsetnexttocdepth{section}
  }

\usepackage{multicol}


\newcommand{\punctuate}{
\todotextjira{381}{@Gioele: punctuate equations}
}

% \usepackage{arabtex}



% \usepackage[color=blue,
%             width=3pt,
%             height=0.5\baselineskip]{overcolored}
% \overfullrule=5pt

% \usepackage{breqn}


\setitemize{leftmargin=*}
\setenumerate{leftmargin=*}
